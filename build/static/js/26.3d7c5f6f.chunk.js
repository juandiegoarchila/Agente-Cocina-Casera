"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[26],{4026:(e,a,t)=>{t.r(a),t.d(a,{default:()=>v});var n=t(5043),l=t(1283),i=t(5509),o=t(1958),s=t(5472),r=t(3360),d=t(6134),m=t(2781),c=t(2916),p=t(196),u=t(5492),b=t(9303),h=t(1173),x=t(4005),y=t(2061),f=t(2049),g=t(579);const v=()=>{const{user:e,role:a,loading:t}=(0,i.A)(),v=(0,l.Zp)(),[j,k]=(0,n.useState)([(0,x.iy)({},!0)]),[N,S]=(0,n.useState)([(0,f.ct)({isWaitress:!0})]),[A,R]=(0,n.useState)(null),[w,P]=(0,n.useState)(null),[T,M]=(0,n.useState)(!1),[$,C]=(0,n.useState)(null),[z,D]=(0,n.useState)(null),[E,I]=(0,n.useState)(null),[B,q]=(0,n.useState)(null),[O,W]=(0,n.useState)([]),[V,H]=(0,n.useState)([]),[L,F]=(0,n.useState)([]),[J,Q]=(0,n.useState)([]),[G,Z]=(0,n.useState)([]),[U,_]=(0,n.useState)([]),[K,X]=(0,n.useState)([]),[Y,ee]=(0,n.useState)([]),[ae,te]=(0,n.useState)([]),[ne,le]=(0,n.useState)([]),[ie,oe]=(0,n.useState)([]),[se,re]=(0,n.useState)([]),[de,me]=(0,n.useState)([]),[ce,pe]=(0,n.useState)([]),[ue,be]=(0,n.useState)([]),[he,xe]=(0,n.useState)([]),[ye,fe]=(0,n.useState)(!1),[ge,ve]=(0,n.useState)([]),[je,ke]=(0,n.useState)("create"),[Ne,Se]=(0,n.useState)(null),[Ae,Re]=(0,n.useState)(null),[we,Pe]=(0,n.useState)("closed"),[Te,Me]=(0,n.useState)({breakfastStart:420,breakfastEnd:631,lunchStart:632,lunchEnd:950}),[$e,Ce]=(0,n.useState)(""),ze=e=>e?"string"===typeof e?e:(e.name||e.label||e.value||"").toString():"";(0,n.useEffect)(()=>{if(!t)return e?3!==a?(R("Acceso denegado. Solo las meseras pueden acceder a esta p\xe1gina."),void setTimeout(()=>v("/staffhub"),3e3)):void 0:(R("Por favor, inicia sesi\xf3n para continuar."),void setTimeout(()=>v("/staffhub"),3e3))},[e,t,a,v]),(0,n.useEffect)(()=>{const a=[W,H,F,Q,Z,_,X,ee,te,le,oe,re,me,pe,be,xe],t=["soups","soupReplacements","principles","proteins","drinks","sides","additions","paymentMethods","breakfastEggs","breakfastBroths","breakfastRiceBread","breakfastDrinks","breakfastAdditions","breakfastTypes","breakfastProteins","breakfastTimes"].map((e,t)=>(0,s.aQ)((0,s.rJ)(o.db,e),e=>{const n=e.docs.map(e=>({id:e.id,...e.data()}));a[t](n),0===n.length&&R("Algunas opciones no est\xe1n disponibles. Intenta de nuevo m\xe1s tarde.")},e=>{R("No se pudieron cargar las opciones. Intenta de nuevo m\xe1s tarde.")})),n=(0,s.aQ)((0,s.H9)(o.db,"settings","global"),e=>{fe(e.exists()&&e.data().isOrderingDisabled||!1)},e=>{R("Error al cargar configuraci\xf3n. Intenta de nuevo m\xe1s tarde.")}),l=(0,s.aQ)((0,s.H9)(o.db,"settings","schedules"),e=>{if(e.exists()){const a=e.data();Me({breakfastStart:a.breakfastStart||420,breakfastEnd:a.breakfastEnd||631,lunchStart:a.lunchStart||632,lunchEnd:a.lunchEnd||950})}}),i=(0,s.aQ)((0,s.rJ)(o.db,"breakfastOrders"),a=>{const t=a.docs.map(e=>({id:e.id,...e.data(),type:"breakfast"})).filter(a=>a.userId===(null===e||void 0===e?void 0:e.uid)).sort((e,a)=>new Date(a.createdAt)-new Date(e.createdAt));ve(e=>[...e.filter(e=>"breakfast"!==e.type),...t])}),r=(0,s.aQ)((0,s.rJ)(o.db,"tableOrders"),a=>{const t=a.docs.map(e=>({id:e.id,...e.data(),type:"lunch"})).filter(a=>a.userId===(null===e||void 0===e?void 0:e.uid)).sort((e,a)=>new Date(a.createdAt)-new Date(e.createdAt));ve(e=>[...e.filter(e=>"lunch"!==e.type),...t])});return()=>{t.forEach(e=>e()),n(),l(),i(),r()}},[e]),(0,n.useEffect)(()=>{const e=()=>{const e=new Date,a=60*e.getHours()+e.getMinutes();let t="closed",n="";const l=e=>{const a=Math.floor(e/60),t=a>=12?"PM":"AM";return`${a%12||12}:${(e%60).toString().padStart(2,"0")} ${t}`};a>=Te.breakfastStart&&a<=Te.breakfastEnd?(t="breakfast",n=l(Te.breakfastEnd)):a>=Te.lunchStart&&a<=Te.lunchEnd&&(t="lunch",n=l(Te.lunchEnd)),Pe(t),Ce(n)};e();const a=setInterval(e,6e4);return()=>clearInterval(a)},[Te]),(0,n.useEffect)(()=>{if(A){const e=setTimeout(()=>R(null),1e4);return()=>clearTimeout(e)}},[A]),(0,n.useEffect)(()=>{if(w){const e=setTimeout(()=>P(null),1e4);return()=>clearTimeout(e)}},[w]);const De=async(e,t,n)=>{try{M(!0),console.log("Attempting to update status for orderId:",e,"to",t,"with role:",a,"type:",n);const l="breakfast"===n?"breakfastOrders":"tableOrders",i=(0,s.H9)(o.db,l,e);await(0,s.mZ)(i,{status:t,updatedAt:new Date}),R(null),P(`Estado de la orden ${e.slice(0,8)} actualizado a ${t}`),Re(null)}catch(l){console.error("Error al actualizar estado:",l),R(`Error al actualizar el estado: ${l.message}. Verifica tu rol y permisos.`)}finally{M(!1)}},Ee=(e,a,t)=>{if("lunch"===Ne.type)if("total"===a&&-1===e)Se(e=>({...e,total:parseFloat(t)||0})),console.log(`[WaiterDashboard] Updated total: ${t}`);else{const n=[...Ne.meals];"principle"===a||"sides"===a?n[e]={...n[e],[a]:t||[]}:"soup"===a||"soupReplacement"===a||"principleReplacement"===a||"protein"===a||"drink"===a||"paymentMethod"===a?(n[e]={...n[e],[a]:t||null},"soupReplacement"===a&&"Remplazo por Sopa"===(null===t||void 0===t?void 0:t.name)?n[e].showReplacementsState={...n[e].showReplacementsState,soup:!0}:"soupReplacement"!==a&&"soup"!==a||(n[e].showReplacementsState={...n[e].showReplacementsState,soup:!1},"soup"===a&&(n[e].soupReplacement=null)),"principle"===a&&null!==t&&void 0!==t&&t.some(e=>"Remplazo por Principio"===e.name)?n[e].showReplacementsState={...n[e].showReplacementsState,principle:!0}:"principle"===a&&(n[e].showReplacementsState={...n[e].showReplacementsState,principle:!1})):n[e]="additions"===a?{...n[e],additions:t}:{...n[e],[a]:t};const l=(0,y.N9)(n,3);Se(e=>({...e,meals:n,total:l}))}else if("breakfast"===Ne.type)if("total"===a&&-1===e)Se(e=>({...e,total:parseFloat(t)||0})),console.log(`[WaiterDashboard] Updated total: ${t}`);else{const n=[...Ne.breakfasts];n[e]="additions"===a?{...n[e],additions:t}:{...n[e],[a]:t||null};const l=(0,f.VC)(n,3,ce);Se(e=>({...e,breakfasts:n,total:l}))}},Ie=e=>e?"string"===typeof e?e:e.name?e.name:"N/A":"N/A",Be={Pendiente:"bg-gray-100 text-gray-800",Preparando:"bg-blue-100 text-blue-800",Completada:"bg-green-100 text-green-800",Cancelada:"bg-red-100 text-red-800"},qe=(0,n.useMemo)(()=>K.map(e=>({...e,price:"Mojarra"===e.name?8e3:e.price,requiresReplacement:e.requiresReplacement||["Prote\xedna adicional","Sopa adicional","Principio adicional","Bebida adicional"].includes(e.name)})).filter(e=>"Arroz con pollo"!==e.name&&"Arroz paisa"!==e.name&&"Arroz tres carnes"!==e.name),[K]),Oe=e=>{const a=((null===e||void 0===e?void 0:e.additions)||[]).filter(e=>e.requiresReplacement&&("Prote\xedna adicional"===e.name?!e.protein:!e.replacement));if(0===a.length)return[];const t=a[0];return"Sopa adicional"===t.name?O.filter(e=>"Solo bandeja"!==e.name&&"Remplazo por Sopa"!==e.name):"Principio adicional"===t.name?L.filter(e=>"Remplazo por Principio"!==e.name&&!["Arroz con pollo","Arroz paisa","Arroz tres carnes"].includes(e.name)):"Prote\xedna adicional"===t.name?J.filter(e=>"Mojarra"!==e.name):"Bebida adicional"===t.name?G.filter(e=>"Sin bebida"!==e.name):[]};return t?(0,g.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:"Cargando..."}):(0,g.jsxs)("div",{className:"min-h-screen bg-gray-200 flex flex-col",children:[(0,g.jsx)("header",{className:"bg-gray-800 text-white p-4",children:(0,g.jsx)("h1",{className:"text-lg font-bold",children:"Gesti\xf3n de \xd3rdenes de Mesas"})}),(0,g.jsxs)("main",{className:"p-4 flex-grow w-full max-w-4xl mx-auto",children:[(0,g.jsxs)("div",{className:"flex border-b border-gray-300 mb-4",children:[(0,g.jsx)("button",{className:"px-4 py-2 text-sm font-medium "+("create"===je?"border-b-2 border-blue-500 text-blue-500":"text-gray-600"),onClick:()=>ke("create"),children:"Crear Orden"}),(0,g.jsx)("button",{className:"px-4 py-2 text-sm font-medium "+("view"===je?"border-b-2 border-blue-500 text-blue-500":"text-gray-600"),onClick:()=>ke("view"),children:"Ver \xd3rdenes"})]}),"create"===je?ye||"closed"===we?(0,g.jsxs)("div",{className:"flex flex-col items-center justify-center text-center bg-red-50 text-red-700 p-4 rounded-lg shadow-md",children:[(0,g.jsx)("h2",{className:"text-xl font-bold",children:"\ud83d\udeab Restaurante cerrado"}),(0,g.jsx)("p",{className:"text-sm",children:"Los pedidos estar\xe1n disponibles nuevamente ma\xf1ana."})]}):"breakfast"===we?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("p",{className:"text-center text-gray-700 mb-4 text-sm bg-white p-3 rounded-lg shadow-sm",children:["Toma pedidos r\xe1pido. Desayuno disponible hasta ",$e]}),(0,g.jsx)(d.A,{breakfasts:N,setBreakfasts:S,eggs:ae,broths:ne,riceBread:ie,drinks:se,additions:de,breakfastTypes:ce,breakfastProteins:ue,times:he,paymentMethods:Y,onBreakfastChange:(e,a,t)=>(0,f.Cu)(S,e,a,t),onRemoveBreakfast:e=>(0,f.GF)(S,P,e,N),onAddBreakfast:()=>(0,f.fB)(S,P,N,(0,f.ct)({isWaitress:!0})),onDuplicateBreakfast:e=>(0,f.F5)(S,P,e,N),incompleteBreakfastIndex:E,incompleteSlideIndex:B,isOrderingDisabled:ye,userRole:a,savedAddress:{},isTableOrder:!0}),(0,g.jsx)(c.A,{items:N,onSendOrder:async()=>{let a=null,t=null,n="";if(N.forEach((e,l)=>{var i;const o=Array.isArray(ce)?ce.find(a=>{var t;return a.name===(null===(t=e.type)||void 0===t?void 0:t.name)}):null,s=o?o.steps||[]:["type","eggs","broth","riceBread","drink","protein"],r=[];if(null!==(i=e.type)&&void 0!==i&&i.name||r.push("type"),s.forEach(a=>{"tableNumber"===a?e.tableNumber||r.push("tableNumber"):"paymentMethod"===a?e.paymentMethod||e.payment||r.push("paymentMethod"):"orderType"===a?e.orderType||r.push("orderType"):e[a]||r.push(a)}),r.length>0&&null===a){a=l,n=r[0];t={type:0,broth:1,eggs:2,riceBread:3,drink:4,protein:5,tableNumber:6,paymentMethod:7,orderType:8}[n]||0}}),null!==a)return I(a),q(t),R(`Por favor, completa el campo "${n}" para el Desayuno #${a+1}.`),void setTimeout(()=>{const e=document.getElementById(`breakfast-item-${N[a].id}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlight-incomplete"),setTimeout(()=>e.classList.remove("highlight-incomplete"),3e3))},100);R(null),M(!0);try{const a={};N.forEach(e=>{const t=ze(e.paymentMethod||e.payment);if(!t)return;const n=Number((0,f.x8)(e,3)||0);a[t]=(a[t]||0)+n});const t=Object.entries(a).map(e=>{let[a,t]=e;return{method:a,amount:Math.floor(t)}}),n={userId:e.uid,userEmail:e.email||`waiter_${e.uid}@example.com`,breakfasts:N.map(e=>{var a;return{type:e.type?{name:e.type.name}:null,broth:e.broth?{name:e.broth.name}:null,eggs:e.eggs?{name:e.eggs.name}:null,riceBread:e.riceBread?{name:e.riceBread.name}:null,drink:e.drink?{name:e.drink.name}:null,protein:e.protein?{name:e.protein.name}:null,additions:(null===(a=e.additions)||void 0===a?void 0:a.map(e=>({name:e.name,quantity:e.quantity||1})))||[],tableNumber:e.tableNumber||"",paymentMethod:e.paymentMethod||e.payment?{name:ze(e.paymentMethod||e.payment)}:null,payment:e.payment||e.paymentMethod?{name:ze(e.payment||e.paymentMethod)}:null,orderType:e.orderType||"",notes:e.notes||""}}),total:(0,f.VC)(N,3,ce),payments:t,status:"Pendiente",createdAt:new Date,updatedAt:new Date};0,await(0,s.gS)((0,s.rJ)(o.db,"breakfastOrders"),n),P("\xa1Orden de desayuno guardada con \xe9xito!"),S([(0,f.ct)({isWaitress:!0})])}catch(l){0,R("Error al guardar la orden de desayuno. Intenta de nuevo.")}finally{M(!1)}},user:{role:3},breakfastTypes:ce})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("p",{className:"text-center text-gray-700 mb-4 text-sm bg-white p-3 rounded-lg shadow-sm",children:["Toma pedidos r\xe1pido. Almuerzo disponible hasta ",$e]}),(0,g.jsx)(r.A,{meals:j,soups:O,soupReplacements:V,principles:L,proteins:J,drinks:G,sides:U,additions:K,paymentMethods:Y,times:[],isTableOrder:!0,userRole:a,onMealChange:(e,a,t)=>(0,x.Wy)(k,e,a,t),onRemoveMeal:e=>(0,x.gG)(k,P,e,j),onAddMeal:()=>(0,x.Hg)(k,P,j,(0,x.iy)({},!0)),onDuplicateMeal:e=>(0,x.Ln)(k,P,e,j),incompleteMealIndex:$,incompleteSlideIndex:z,isOrderingDisabled:ye}),(0,g.jsx)(m.A,{meals:j,onSendOrder:async()=>{let a=null,t=null,n="";for(let e=0;e<j.length;e++){const l=j[e],i=Array.isArray(null===l||void 0===l?void 0:l.principle)&&l.principle.some(e=>["Arroz con pollo","Arroz paisa","Arroz tres carnes"].includes(e.name)),o=[],s={"Sopa o reemplazo de sopa":0,Principio:1,"Prote\xedna":2,Bebida:3,"Acompa\xf1amientos":4,Mesa:5,"M\xe9todo de pago":6,"Tipo de pedido":7};if(null!==l&&void 0!==l&&l.soup||null!==l&&void 0!==l&&l.soupReplacement||o.push("Sopa o reemplazo de sopa"),null!==l&&void 0!==l&&l.principle||null!==l&&void 0!==l&&l.principleReplacement||o.push("Principio"),i||null!==l&&void 0!==l&&l.protein||o.push("Prote\xedna"),null!==l&&void 0!==l&&l.drink||o.push("Bebida"),i||null!==l&&void 0!==l&&l.sides&&0!==l.sides.length||o.push("Acompa\xf1amientos"),null!==l&&void 0!==l&&l.tableNumber||o.push("Mesa"),null!==l&&void 0!==l&&l.paymentMethod||o.push("M\xe9todo de pago"),null!==l&&void 0!==l&&l.orderType||o.push("Tipo de pedido"),o.length>0){0,a=e,n=o[0],t=s[n]||0;break}}if(null!==a)return C(a),D(t),R(`Por favor, completa el campo "${n}" para el Almuerzo #${a+1}.`),void setTimeout(()=>{const e=document.getElementById(`meal-item-${a}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlight-incomplete"),setTimeout(()=>e.classList.remove("highlight-incomplete"),3e3),e.dispatchEvent(new CustomEvent("updateSlide",{detail:{slideIndex:t}})))},100);R(null),M(!0);try{const a={userId:e.uid,userEmail:e.email||`waiter_${e.uid}@example.com`,meals:j.map(e=>{var a;return{soup:e.soup?{name:e.soup.name}:null,soupReplacement:e.soupReplacement?{name:e.soupReplacement.name,replacement:e.soupReplacement.replacement||""}:null,principle:Array.isArray(e.principle)?e.principle.map(e=>({name:e.name,replacement:e.replacement||""})):[],principleReplacement:e.principleReplacement?{name:e.principleReplacement.name}:null,protein:e.protein?{name:e.protein.name}:null,drink:e.drink?{name:e.drink.name}:null,sides:Array.isArray(e.sides)?e.sides.map(e=>({name:e.name})):[],additions:(null===(a=e.additions)||void 0===a?void 0:a.map(e=>({id:e.id,name:e.name,protein:e.protein||"",replacement:e.replacement||"",quantity:e.quantity||1,price:e.price||0})))||[],tableNumber:e.tableNumber||"",paymentMethod:e.paymentMethod?{name:e.paymentMethod.name}:null,orderType:e.orderType||"",notes:e.notes||""}}),total:(0,y.N9)(j,3),status:"Pendiente",createdAt:new Date,updatedAt:new Date};console.log("[WaiterDashboard] Saving order with meals:",a.meals),await(0,s.gS)((0,s.rJ)(o.db,"tableOrders"),a),P("\xa1Orden de mesa guardada con \xe9xito!"),k([(0,x.iy)({},!0)])}catch(l){0,R("Error al guardar la orden. Intenta de nuevo.")}finally{M(!1)}},calculateTotal:()=>(0,y.N9)(j,3),isTableOrder:!0,isWaiterView:!1,userRole:3})]}):(0,g.jsx)("div",{className:"space-y-4",children:0===ge.length?(0,g.jsx)("p",{className:"text-center text-gray-700",children:"No has registrado \xf3rdenes de mesas."}):ge.map(e=>{var a,t,n,l;return(0,g.jsxs)("div",{className:`p-4 rounded-lg shadow-md ${Be[e.status]||"bg-white"}`,children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsxs)("h2",{className:"text-sm font-semibold text-gray-800",children:["breakfast"===e.type?"Desayuno":"Almuerzo"," - Mesa ",Ie((null===(a=e.meals)||void 0===a||null===(t=a[0])||void 0===t?void 0:t.tableNumber)||(null===(n=e.breakfasts)||void 0===n||null===(l=n[0])||void 0===l?void 0:l.tableNumber))," - #",e.id.slice(-4)]}),(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)("button",{onClick:()=>Re(Ae===e.id?null:e.id),className:"text-gray-600 hover:text-gray-800 focus:outline-none",children:"\u22ee"}),Ae===e.id&&(0,g.jsxs)("div",{className:"absolute right-0 mt-2 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:[(0,g.jsx)("button",{onClick:()=>De(e.id,"Pendiente",e.type),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:bg-gray-200",disabled:"Pendiente"===e.status,children:"Pendiente"}),(0,g.jsx)("button",{onClick:()=>De(e.id,"Preparando",e.type),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:bg-gray-200",disabled:"Preparando"===e.status,children:"Preparando"}),(0,g.jsx)("button",{onClick:()=>De(e.id,"Completada",e.type),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:bg-gray-200",disabled:"Completada"===e.status,children:"Completada"}),(0,g.jsx)("button",{onClick:()=>De(e.id,"Cancelada",e.type),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:bg-gray-200",disabled:"Cancelada"===e.status,children:"Cancelada"}),(0,g.jsx)("button",{onClick:()=>(e=>{if("lunch"===e.type){const a={...e,meals:e.meals.map(e=>{var a,t,n;return{soup:e.soup||null,soupReplacement:e.soupReplacement?{...e.soupReplacement,replacement:e.soupReplacement.replacement||""}:null,principle:Array.isArray(e.principle)?e.principle.map(e=>({...e,replacement:e.replacement||""})):[],principleReplacement:e.principleReplacement||null,protein:e.protein||null,drink:e.drink||null,sides:e.sides||[],additions:Array.isArray(e.additions)?e.additions:[],paymentMethod:e.paymentMethod||null,tableNumber:e.tableNumber||"",orderType:e.orderType||"",notes:e.notes||"",showReplacementsState:{soup:"Remplazo por Sopa"===(null===(a=e.soupReplacement)||void 0===a?void 0:a.name)&&!(null===(t=e.soupReplacement)||void 0===t||!t.replacement),principle:(null===(n=e.principle)||void 0===n?void 0:n.some(e=>"Remplazo por Principio"===e.name&&!!e.replacement))||!1}}})};Se(a)}else if("breakfast"===e.type){const a={...e,breakfasts:e.breakfasts.map(e=>({type:e.type||null,broth:e.broth||null,eggs:e.eggs||null,riceBread:e.riceBread||null,drink:e.drink||null,protein:e.protein||null,additions:Array.isArray(e.additions)?e.additions:[],tableNumber:e.tableNumber||"",paymentMethod:e.paymentMethod||e.payment||null,orderType:e.orderType||"",notes:e.notes||""}))};Se(a)}Re(null)})(e),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Editar"})]})]})]}),"breakfast"===e.type?(0,g.jsx)(c.A,{items:e.breakfasts,user:{role:3},breakfastTypes:ce,statusClass:Be[e.status]||""}):(0,g.jsx)(m.A,{meals:e.meals,isTableOrder:!0,calculateTotal:()=>e.total,isWaiterView:!0,statusClass:Be[e.status]||"",userRole:3})]},e.id)})}),Ne&&(0,g.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,g.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-lg max-w-md w-full mx-4 overflow-y-auto",style:{maxHeight:"80vh"},children:[(0,g.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["Editar Orden #",Ne.id.slice(-4)]}),"lunch"===Ne.type?Ne.meals.map((e,a)=>{var t,n,l,i,o,s,r;return(0,g.jsxs)("div",{className:"mb-4",children:[(0,g.jsxs)("h3",{className:"text-sm font-medium mb-2",children:["Almuerzo #",a+1]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Sopa o Reemplazo"}),(0,g.jsx)(h.A,{title:"Sopa",emoji:"\ud83e\udd63",options:O,selected:e.soup||e.soupReplacement,showReplacements:(null===(t=e.showReplacementsState)||void 0===t?void 0:t.soup)||!1,replacements:V.filter(e=>"Remplazo por Sopa"!==e.name&&"Solo bandeja"!==e.name),selectedReplacement:null!==(n=e.soupReplacement)&&void 0!==n&&n.replacement?{name:e.soupReplacement.replacement}:null,multiple:!1,onImmediateSelect:e=>{console.log(`[WaiterDashboard] Sopa selected for meal ${a+1}:`,e),Ee(a,"Remplazo por Sopa"===(null===e||void 0===e?void 0:e.name)?"soupReplacement":"soup",e)},onImmediateReplacementSelect:e=>{console.log(`[WaiterDashboard] Sopa replacement selected for meal ${a+1}:`,e);const t=[...Ne.meals];t[a]={...t[a],soupReplacement:{...t[a].soupReplacement,name:"Remplazo por Sopa",replacement:(null===e||void 0===e?void 0:e.name)||""}},Se(e=>({...e,meals:t}))}})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Principio o Reemplazo"}),(0,g.jsx)(h.A,{title:"Principio",emoji:"\ud83c\udf5a",options:L,selected:e.principle||e.principleReplacement,showReplacements:(null===(l=e.showReplacementsState)||void 0===l?void 0:l.principle)||!1,replacements:V.filter(e=>"Remplazo por Sopa"!==e.name&&"Solo bandeja"!==e.name),selectedReplacement:null!==(i=e.principle)&&void 0!==i&&null!==(o=i.find(e=>"Remplazo por Principio"===e.name))&&void 0!==o&&o.replacement?{name:e.principle.find(e=>"Remplazo por Principio"===e.name).replacement}:null,multiple:!0,showConfirmButton:!0,onImmediateSelect:e=>{console.log(`[WaiterDashboard] Principio selected for meal ${a+1}:`,e),Ee(a,"principle",e)},onImmediateReplacementSelect:e=>{var t;console.log(`[WaiterDashboard] Principio replacement selected for meal ${a+1}:`,e);const n=[...Ne.meals];n[a]={...n[a],principle:null===(t=n[a].principle)||void 0===t?void 0:t.map(a=>({...a,replacement:"Remplazo por Principio"===a.name?(null===e||void 0===e?void 0:e.name)||"":a.replacement}))},Se(e=>({...e,meals:n}))},onConfirm:e=>{let{selection:t}=e;return Ee(a,"principle",t)}})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Prote\xedna"}),(0,g.jsx)(h.A,{title:"Prote\xedna",emoji:"\ud83c\udf56",options:J,selected:e.protein,multiple:!1,onImmediateSelect:e=>Ee(a,"protein",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Bebida"}),(0,g.jsx)(h.A,{title:"Bebida",emoji:"\ud83e\udd64",options:G,selected:e.drink,multiple:!1,onImmediateSelect:e=>Ee(a,"drink",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Acompa\xf1amientos"}),(0,g.jsx)(h.A,{title:"Acompa\xf1amiento",emoji:"\ud83e\udd57",options:U,selected:e.sides,multiple:!0,onImmediateSelect:e=>Ee(a,"sides",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"M\xe9todo de Pago"}),(0,g.jsx)(h.A,{title:"M\xe9todo de Pago",emoji:"\ud83d\udcb3",options:Y,selected:e.paymentMethod,multiple:!1,onImmediateSelect:e=>Ee(a,"paymentMethod",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"N\xfamero de Mesa"}),(0,g.jsx)("input",{type:"text",value:e.tableNumber||"",onChange:e=>Ee(a,"tableNumber",e.target.value),placeholder:"N\xfamero de mesa",className:"w-full p-2 border rounded text-sm"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Tipo de Pedido"}),(0,g.jsxs)("select",{value:e.orderType||"",onChange:e=>Ee(a,"orderType",e.target.value),className:"w-full p-2 border rounded text-sm",children:[(0,g.jsx)("option",{value:"",children:"Seleccionar"}),(0,g.jsx)("option",{value:"table",children:"Para mesa"}),(0,g.jsx)("option",{value:"takeaway",children:"Para llevar"})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Notas"}),(0,g.jsx)("textarea",{value:e.notes||"",onChange:e=>Ee(a,"notes",e.target.value),placeholder:"Notas",className:"w-full p-2 border rounded text-sm"})]}),(0,g.jsxs)("div",{children:[(0,g.jsxs)("h4",{className:"text-xs font-medium text-gray-700 mb-1",children:["\u2795 Adiciones para Almuerzo #",a+1," (opcional)"]}),(0,g.jsx)(h.A,{title:"Adiciones (por almuerzo)",emoji:"\u2795",options:qe,selected:(null===e||void 0===e?void 0:e.additions)||[],multiple:!0,showReplacements:null===e||void 0===e||null===(s=e.additions)||void 0===s?void 0:s.some(e=>e.requiresReplacement&&("Prote\xedna adicional"===e.name&&!e.protein||["Sopa adicional","Principio adicional","Bebida adicional"].includes(e.name)&&!e.replacement)),replacements:Oe(e),onImmediateSelect:e=>{console.log(`[WaiterDashboard] Additions selected for meal ${a+1}:`,e),Ee(a,"additions",e.map(e=>({...e,quantity:e.quantity||1,price:e.price||0,protein:(e.name,e.protein||""),replacement:(["Sopa adicional","Principio adicional","Bebida adicional"].includes(e.name),e.replacement||"")})))},onImmediateReplacementSelect:t=>{let{id:n,replacement:l}=t;console.log(`[WaiterDashboard] Replacement selected for meal ${a+1}, addition ${n}:`,l);const i=((null===e||void 0===e?void 0:e.additions)||[]).map(e=>e.id===n?{...e,protein:"Prote\xedna adicional"===e.name&&(null===l||void 0===l?void 0:l.name)||e.protein,replacement:["Sopa adicional","Principio adicional","Bebida adicional"].includes(e.name)&&(null===l||void 0===l?void 0:l.name)||e.replacement}:e);Ee(a,"additions",i)},onAdd:t=>{var n;console.log(`[WaiterDashboard] Adding addition for meal ${a+1}:`,t);const l=(null===e||void 0===e||null===(n=e.additions)||void 0===n?void 0:n.find(e=>e.id===t.id))?e.additions.map(e=>e.id===t.id?{...e,quantity:(e.quantity||1)+1}:e):[...e.additions||[],{...t,quantity:1,price:t.price||0}];Ee(a,"additions",l)},onRemove:t=>{console.log(`[WaiterDashboard] Removing addition ${t} for meal ${a+1}`);const n=e.additions.map(e=>e.id===t?{...e,quantity:(e.quantity||1)-1}:e).filter(e=>e.quantity>0);Ee(a,"additions",n)},onIncrease:t=>{console.log(`[WaiterDashboard] Increasing addition ${t} for meal ${a+1}`);const n=e.additions.map(e=>e.id===t?{...e,quantity:(e.quantity||1)+1}:e);Ee(a,"additions",n)}}),(null===e||void 0===e||null===(r=e.additions)||void 0===r?void 0:r.length)>0&&(0,g.jsxs)("div",{className:"mt-2 text-sm font-semibold text-gray-700",children:["Total Adiciones de este almuerzo: $",e.additions.reduce((e,a)=>e+((null===a||void 0===a?void 0:a.price)||0)*((null===a||void 0===a?void 0:a.quantity)||1),0).toLocaleString("es-CO")]})]})]})]},a)}):Ne.breakfasts.map((e,a)=>{var t;return(0,g.jsxs)("div",{className:"mb-4",children:[(0,g.jsxs)("h3",{className:"text-sm font-medium mb-2",children:["Desayuno #",a+1]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Tipo de Desayuno"}),(0,g.jsx)(h.A,{title:"Tipo",emoji:"\ud83e\udd5e",options:ce,selected:e.type,multiple:!1,onImmediateSelect:e=>Ee(a,"type",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Caldo"}),(0,g.jsx)(h.A,{title:"Caldo",emoji:"\ud83e\udd63",options:ne,selected:e.broth,multiple:!1,onImmediateSelect:e=>Ee(a,"broth",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Huevos"}),(0,g.jsx)(h.A,{title:"Huevos",emoji:"\ud83e\udd5a",options:ae,selected:e.eggs,multiple:!1,onImmediateSelect:e=>Ee(a,"eggs",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Arroz/Pan"}),(0,g.jsx)(h.A,{title:"Arroz/Pan",emoji:"\ud83c\udf5e",options:ie,selected:e.riceBread,multiple:!1,onImmediateSelect:e=>Ee(a,"riceBread",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Bebida"}),(0,g.jsx)(h.A,{title:"Bebida",emoji:"\ud83e\udd64",options:se,selected:e.drink,multiple:!1,onImmediateSelect:e=>Ee(a,"drink",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Prote\xedna"}),(0,g.jsx)(h.A,{title:"Prote\xedna",emoji:"\ud83c\udf56",options:ue,selected:e.protein,multiple:!1,onImmediateSelect:e=>Ee(a,"protein",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"M\xe9todo de Pago"}),(0,g.jsx)(h.A,{title:"M\xe9todo de Pago",emoji:"\ud83d\udcb3",options:Y,selected:e.paymentMethod,multiple:!1,onImmediateSelect:e=>Ee(a,"paymentMethod",e)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"N\xfamero de Mesa"}),(0,g.jsx)("input",{type:"text",value:e.tableNumber||"",onChange:e=>Ee(a,"tableNumber",e.target.value),placeholder:"N\xfamero de mesa",className:"w-full p-2 border rounded text-sm"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Tipo de Pedido"}),(0,g.jsxs)("select",{value:e.orderType||"",onChange:e=>Ee(a,"orderType",e.target.value),className:"w-full p-2 border rounded text-sm",children:[(0,g.jsx)("option",{value:"",children:"Seleccionar"}),(0,g.jsx)("option",{value:"table",children:"Para mesa"}),(0,g.jsx)("option",{value:"takeaway",children:"Para llevar"})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Notas"}),(0,g.jsx)("textarea",{value:e.notes||"",onChange:e=>Ee(a,"notes",e.target.value),placeholder:"Notas",className:"w-full p-2 border rounded text-sm"})]}),(0,g.jsxs)("div",{children:[(0,g.jsxs)("h4",{className:"text-xs font-medium text-gray-700 mb-1",children:["\u2795 Adiciones para Desayuno #",a+1," (opcional)"]}),(0,g.jsx)(h.A,{title:"Adiciones (por desayuno)",emoji:"\u2795",options:de,selected:(null===e||void 0===e?void 0:e.additions)||[],multiple:!0,onImmediateSelect:e=>{console.log(`[WaiterDashboard] Additions selected for breakfast ${a+1}:`,e),Ee(a,"additions",e.map(e=>({name:e.name,quantity:e.quantity||1})))},onAdd:t=>{var n;console.log(`[WaiterDashboard] Adding addition for breakfast ${a+1}:`,t);const l=(null===e||void 0===e||null===(n=e.additions)||void 0===n?void 0:n.find(e=>e.name===t.name))?e.additions.map(e=>e.name===t.name?{...e,quantity:(e.quantity||1)+1}:e):[...e.additions||[],{name:t.name,quantity:1}];Ee(a,"additions",l)},onRemove:t=>{console.log(`[WaiterDashboard] Removing addition ${t} for breakfast ${a+1}`);const n=e.additions.map(e=>e.name===t?{...e,quantity:(e.quantity||1)-1}:e).filter(e=>e.quantity>0);Ee(a,"additions",n)},onIncrease:t=>{console.log(`[WaiterDashboard] Increasing addition ${t} for breakfast ${a+1}`);const n=e.additions.map(e=>e.name===t?{...e,quantity:(e.quantity||1)+1}:e);Ee(a,"additions",n)}}),(null===e||void 0===e||null===(t=e.additions)||void 0===t?void 0:t.length)>0&&(0,g.jsxs)("div",{className:"mt-2 text-sm font-semibold text-gray-700",children:["Total Adiciones de este desayuno: $",e.additions.reduce((e,a)=>{const t=de.find(e=>e.name===a.name);return e+((null===t||void 0===t?void 0:t.price)||0)*((null===a||void 0===a?void 0:a.quantity)||1)},0).toLocaleString("es-CO")]})]})]})]},a)}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-xs block mb-1 font-medium",children:"Total (editable)"}),(0,g.jsx)("input",{type:"number",value:void 0!==Ne.total?Ne.total:"lunch"===Ne.type?(0,y.N9)(Ne.meals,3):(0,f.VC)(Ne.breakfasts,3,ce),onChange:e=>Ee(-1,"total",e.target.value),placeholder:"Total",className:"w-full p-2 border rounded text-sm"})]}),(0,g.jsxs)("div",{className:"flex justify-end space-x-2 mt-4 sticky bottom-4 bg-white py-2",children:[(0,g.jsx)("button",{onClick:async()=>{if("lunch"===Ne.type){for(const[a,t]of Ne.meals.entries()){var e;const n=(null===(e=t.additions)||void 0===e?void 0:e.filter(e=>e.requiresReplacement&&("Prote\xedna adicional"===e.name&&!e.protein||["Sopa adicional","Principio adicional","Bebida adicional"].includes(e.name)&&!e.replacement)))||[];if(n.length>0)return void R(`Por favor, selecciona una opci\xf3n para "${n[0].name}" en Almuerzo #${a+1}.`);if(!t.orderType)return void R(`El tipo de pedido es obligatorio para el Almuerzo #${a+1}.`);if(!t.tableNumber&&"table"===t.orderType)return void R(`El n\xfamero de mesa es obligatorio para pedidos "Para mesa" en Almuerzo #${a+1}.`)}try{M(!0),console.log("[WaiterDashboard] Saving edited lunch order:",Ne);const e=(0,s.H9)(o.db,"tableOrders",Ne.id);await(0,s.mZ)(e,{meals:Ne.meals.map(e=>({soup:e.soup?{name:e.soup.name}:null,soupReplacement:e.soupReplacement?{name:e.soupReplacement.name,replacement:e.soupReplacement.replacement||""}:null,principle:Array.isArray(e.principle)?e.principle.map(e=>({name:e.name,replacement:e.replacement||""})):[],principleReplacement:e.principleReplacement?{name:e.principleReplacement.name}:null,protein:e.protein?{name:e.protein.name}:null,drink:e.drink?{name:e.drink.name}:null,sides:Array.isArray(e.sides)?e.sides.map(e=>({name:e.name})):[],additions:e.additions?e.additions.map(e=>({id:e.id,name:e.name,protein:e.protein||"",replacement:e.replacement||"",quantity:e.quantity||1,price:e.price||0})):[],tableNumber:e.tableNumber||"",paymentMethod:e.paymentMethod?{name:e.paymentMethod.name}:null,orderType:e.orderType||"",notes:e.notes||""})),total:void 0!==Ne.total?Ne.total:(0,y.N9)(Ne.meals,3),updatedAt:new Date}),Se(null),P(`Orden ${Ne.id.slice(0,8)} actualizada con \xe9xito`)}catch(t){console.error("Error al guardar edici\xf3n:",t),R(`Error al guardar los cambios: ${t.message}. Verifica tu rol y permisos.`)}finally{M(!1)}}else if("breakfast"===Ne.type){for(const[e,t]of Ne.breakfasts.entries()){var a;const n=(ce.find(e=>{var a;return e.name===(null===(a=t.type)||void 0===a?void 0:a.name)})||{steps:["type","eggs","broth","riceBread","drink","protein"]}).steps||[],l=[];if(null!==(a=t.type)&&void 0!==a&&a.name||l.push("type"),n.forEach(e=>{"tableNumber"!==e||t.tableNumber?"paymentMethod"!==e||t.paymentMethod||t.payment?"orderType"!==e||t.orderType?t[e]||l.push(e):l.push("orderType"):l.push("paymentMethod"):l.push("tableNumber")}),l.length>0)return void R(`Por favor, completa el campo "${l[0]}" para el Desayuno #${e+1}.`);if(!t.orderType)return void R(`El tipo de pedido es obligatorio para el Desayuno #${e+1}.`);if(!t.tableNumber&&"table"===t.orderType)return void R(`El n\xfamero de mesa es obligatorio para pedidos "Para mesa" en Desayuno #${e+1}.`)}try{M(!0),console.log("[WaiterDashboard] Saving edited breakfast order:",Ne);const e=(0,s.H9)(o.db,"breakfastOrders",Ne.id);await(0,s.mZ)(e,{breakfasts:Ne.breakfasts.map(e=>{var a;return{type:e.type?{name:e.type.name}:null,broth:e.broth?{name:e.broth.name}:null,eggs:e.eggs?{name:e.eggs.name}:null,riceBread:e.riceBread?{name:e.riceBread.name}:null,drink:e.drink?{name:e.drink.name}:null,protein:e.protein?{name:e.protein.name}:null,additions:(null===(a=e.additions)||void 0===a?void 0:a.map(e=>({name:e.name,quantity:e.quantity||1})))||[],tableNumber:e.tableNumber||"",paymentMethod:e.paymentMethod||e.payment?{name:ze(e.paymentMethod||e.payment)}:null,orderType:e.orderType||"",notes:e.notes||""}}),total:void 0!==Ne.total?Ne.total:(0,f.VC)(Ne.breakfasts,3,ce),updatedAt:new Date}),Se(null),P(`Orden ${Ne.id.slice(0,8)} actualizada con \xe9xito`)}catch(t){console.error("Error al guardar edici\xf3n:",t),R(`Error al guardar los cambios: ${t.message}. Verifica tu rol y permisos.`)}finally{M(!1)}}},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",children:"Guardar"}),(0,g.jsx)("button",{onClick:()=>Se(null),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",children:"Cancelar"})]})]})})]}),(0,g.jsxs)("div",{className:"fixed top-16 right-4 z-[10002] space-y-2 w-80 max-w-xs",children:[T&&(0,g.jsx)(p.A,{}),A&&(0,g.jsx)(u.A,{message:A,onClose:()=>R(null)}),w&&(0,g.jsx)(b.A,{message:w,onClose:()=>P(null)})]})]})}}}]);
//# sourceMappingURL=26.3d7c5f6f.chunk.js.map