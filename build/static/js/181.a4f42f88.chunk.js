"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[181],{5172:(e,t,a)=>{a.d(t,{A:()=>d});var s=a(5043),l=a(6568),r=a(579);const o=e=>{const t=Math.floor(Number(e||0));return Number.isFinite(t)?t:0},n=e=>(e||"").toString().trim().toLowerCase(),i=e=>{if(Array.isArray(e)&&e.length){const t=e.map(e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.label)||"").filter(Boolean);return Array.from(new Set(t))}return["Efectivo","Nequi","Daviplata"]};function d(e){let{theme:t="light",total:a=0,value:d=[],onChange:c,catalogMethods:m=[],disabled:u=!1}=e;const p=(0,s.useMemo)(()=>i(m),[m]),[x,b]=(0,s.useState)(()=>{const e=Array.isArray(d)?d:[];return e.length?e.map(e=>{var t;return{method:"string"===typeof e.method?e.method:(null===e||void 0===e||null===(t=e.method)||void 0===t?void 0:t.name)||"",amount:o(e.amount),note:e.note||""}}):[{method:"Efectivo",amount:o(a),note:""}]});(0,s.useEffect)(()=>{const e=Array.isArray(d)?d:[];e.length&&b(e.map(e=>{var t;return{method:"string"===typeof e.method?e.method:(null===e||void 0===e||null===(t=e.method)||void 0===t?void 0:t.name)||"",amount:o(e.amount),note:e.note||""}}))},[d]);const h=x.reduce((e,t)=>e+o(t.amount),0),g=o(a)-h,v=0===g,y=e=>{b(e),c&&c(e.map(e=>({method:e.method,amount:o(e.amount),note:e.note||""})))},f=(e,t,a)=>{const s=x.map((s,l)=>l===e?{...s,[t]:"amount"===t?o(a):a}:s);y(s)};return(0,r.jsxs)("div",{className:(0,l.x)("p-3 rounded-lg border","dark"===t?"border-gray-600 bg-gray-800":"border-gray-200 bg-gray-50"),children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-2",children:[(0,r.jsx)("h5",{className:"font-semibold text-sm",children:"Dividir pago"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)("button",{type:"button",disabled:u,onClick:()=>{if(p.length<2)return;const e=Math.floor(o(a)/2),t=o(a)-e;y([{method:p[0],amount:e,note:""},{method:p[1],amount:t,note:""}])},className:(0,l.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"50 / 50"}),(0,r.jsx)("button",{type:"button",disabled:u,onClick:()=>{const e=Math.floor(o(a)/3),t=Math.floor((o(a)-e)/2),s=o(a)-e-t;y([{method:p[0]||"Efectivo",amount:e,note:""},{method:p[1]||"Nequi",amount:t,note:""},{method:p[2]||"Daviplata",amount:s,note:""}])},className:(0,l.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"1/3 cada uno"}),p.map(e=>(0,r.jsxs)("button",{type:"button",disabled:u,onClick:()=>(e=>{y([{method:e,amount:o(a),note:""}])})(e),className:(0,l.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:["Todo ",e]},e))]})]}),(0,r.jsx)("div",{className:"space-y-2",children:x.map((e,s)=>(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-2 items-center",children:[(0,r.jsx)("select",{disabled:u,value:e.method,onChange:e=>f(s,"method",e.target.value),className:(0,l.x)("sm:col-span-4 p-2 rounded border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white"),children:p.map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),(0,r.jsx)("input",{disabled:u,type:"number",min:"0",step:"1",value:e.amount,onChange:e=>f(s,"amount",e.target.value),className:(0,l.x)("sm:col-span-4 p-2 rounded border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white"),placeholder:"Monto en COP"}),(0,r.jsx)("input",{disabled:u,type:"text",value:e.note||"",onChange:e=>f(s,"note",e.target.value),className:(0,l.x)("sm:col-span-3 p-2 rounded border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white"),placeholder:"Nota (opcional)"}),(0,r.jsx)("div",{className:"sm:col-span-1 flex justify-end",children:(0,r.jsx)("button",{type:"button",disabled:u,onClick:()=>(e=>{const t=x.filter((t,a)=>a!==e);y(t.length?t:[{method:"Efectivo",amount:o(a),note:""}])})(s),className:(0,l.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"\u2715"})})]},s))}),(0,r.jsxs)("div",{className:"mt-3 flex items-center justify-between text-sm",children:[(0,r.jsx)("button",{type:"button",disabled:u,onClick:()=>{const e=p.find(e=>!x.some(t=>n(t.method)===n(e)))||p[0],t=[...x,{method:e,amount:Math.max(0,g),note:""}];y(t)},className:(0,l.x)("px-3 py-1 rounded border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"+ A\xf1adir l\xednea"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"Total pedido:"}),(0,r.jsxs)("strong",{children:["$",o(a).toLocaleString("es-CO")]})]})]}),(0,r.jsx)("div",{className:"mt-2",children:v?(0,r.jsx)("span",{className:(0,l.x)("inline-block text-xs px-2 py-1 rounded","dark"===t?"bg-green-700 text-white":"bg-green-100 text-green-800"),children:"\u2714 Suma exacta"}):g>0?(0,r.jsxs)("span",{className:(0,l.x)("inline-block text-xs px-2 py-1 rounded","dark"===t?"bg-yellow-700 text-white":"bg-yellow-100 text-yellow-800"),children:["Falta asignar $",g.toLocaleString("es-CO")]}):(0,r.jsxs)("span",{className:(0,l.x)("inline-block text-xs px-2 py-1 rounded","dark"===t?"bg-red-700 text-white":"bg-red-100 text-red-800"),children:["Sobran $",Math.abs(g).toLocaleString("es-CO")]})})]})}},5343:(e,t,a)=>{a.d(t,{XF:()=>n,Zd:()=>d,_s:()=>i,fz:()=>u});const s=e=>(null!==e&&void 0!==e?e:"").toString().trim().toLowerCase(),l=e=>{const t="string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.label)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.method)||(null===e||void 0===e?void 0:e.type)||(null===e||void 0===e?void 0:e.payment)||"",a=s(t);return a.includes("efect")||a.includes("cash")?"cash":a.includes("nequi")?"nequi":a.includes("davi")?"daviplata":"other"},r=e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.label)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.method)||(null===e||void 0===e?void 0:e.type)||(null===e||void 0===e?void 0:e.payment)||"Otro",o=e=>{var t,a,s,o,n,i,d,c,m,u,p;const x=Math.floor(Number((null===e||void 0===e?void 0:e.total)||0))||0;if(Array.isArray(null===e||void 0===e?void 0:e.payments)&&e.payments.length)return e.payments.map(e=>{const t=Math.floor(Number((null===e||void 0===e?void 0:e.amount)||0))||0;return{methodKey:l(null===e||void 0===e?void 0:e.method),amount:t,rawLabel:r(null===e||void 0===e?void 0:e.method)}});const b=[null!==(t=null===e||void 0===e||null===(a=e.meals)||void 0===a||null===(s=a[0])||void 0===s?void 0:s.paymentMethod)&&void 0!==t?t:null===e||void 0===e||null===(o=e.meals)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.payment,null!==(i=null===e||void 0===e||null===(d=e.breakfasts)||void 0===d||null===(c=d[0])||void 0===c?void 0:c.payment)&&void 0!==i?i:null===e||void 0===e||null===(m=e.breakfasts)||void 0===m||null===(u=m[0])||void 0===u?void 0:u.paymentMethod,null!==(p=null===e||void 0===e?void 0:e.paymentMethod)&&void 0!==p?p:null===e||void 0===e?void 0:e.payment].filter(Boolean);if(b.length){const e=r(b[0]);return[{methodKey:l(b[0]),amount:x,rawLabel:e}]}return[{methodKey:"other",amount:x,rawLabel:"Otro"}]},n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||!e.length)return"Sin pago";const t=e.reduce((e,t)=>{const a=t.methodKey||l(null===t||void 0===t?void 0:t.method);return e[a]=(e[a]||0)+(Math.floor(Number(t.amount||0))||0),e},{}),a=[];return t.cash&&a.push(`Efectivo $${t.cash.toLocaleString("es-CO")}`),t.nequi&&a.push(`Nequi $${t.nequi.toLocaleString("es-CO")}`),t.daviplata&&a.push(`Daviplata $${t.daviplata.toLocaleString("es-CO")}`),t.other&&!a.length&&a.push(`Otro $${t.other.toLocaleString("es-CO")}`),a.join(" + ")||"Sin pago"},i=e=>{const t=o(e);if(null!==t&&void 0!==t&&t.length)return t.map(e=>{let{methodKey:t,amount:a}=e;return{method:t,amount:a}});return[{method:"cash",amount:Math.floor(Number((null===e||void 0===e?void 0:e.total)||0))||0}]},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t={cash:0,nequi:0,daviplata:0,other:0,total:0};for(const a of e){const e=o(a);for(const a of e){const e=Math.floor(Number(a.amount||0))||0;t[a.methodKey]=(t[a.methodKey]||0)+e,t.total+=e}}return t},c=e=>{var t,a;if(((null===e||void 0===e?void 0:e.__collection)||"").toLowerCase().includes("table"))return!0;const l=s((null===e||void 0===e?void 0:e.orderType)||(null===e||void 0===e||null===(t=e.breakfasts)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.orderType)||"");return!(!Array.isArray(null===e||void 0===e?void 0:e.breakfasts)||!(l.includes("table")||l.includes("takeaway")||l.includes("para llevar")||l.includes("llevar")))},m=e=>{var t;return!(null===e||void 0===e||null===(t=e.settlement)||void 0===t||!t.status||"liquidated"!==s(e.settlement.status))||(!0===(null===e||void 0===e?void 0:e.liquidated)||(!0===(null===e||void 0===e?void 0:e.cashSettled)||!(null===e||void 0===e||!e.settledAt)))},u=function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const a={nequiTotal:0,daviplataTotal:0,cashSalon:0,cashClientesSettled:0,cashClientesPendiente:0},s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const t of e){const e=o(t);let s=0,l=0,r=0;for(const t of e){const e=Math.floor(Number((null===t||void 0===t?void 0:t.amount)||0))||0;"cash"===t.methodKey?s+=e:"nequi"===t.methodKey?l+=e:"daviplata"===t.methodKey&&(r+=e)}a.nequiTotal+=l,a.daviplataTotal+=r,s>0&&(c(t)?a.cashSalon+=s:m(t)?a.cashClientesSettled+=s:a.cashClientesPendiente+=s)}};return s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]),s(e),s(t),{...a,cashCaja:a.cashSalon+a.cashClientesSettled}}},6568:(e,t,a)=>{function s(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}a.d(t,{x:()=>s})},8181:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var s=a(5043),l=a(1283),r=a(5509),o=a(1958),n=a(5472),i=a(6568),d=a(2315),c=a(4791),m=a(1252),u=a(2811),p=a(9248),x=a(8224),b=a(6365),h=a(196),g=a(5492),v=a(2781),y=a(1173),f=a(1238),j=a(7762),N=(a(557),a(2061)),k=a(2049),w=a(1535),A=a(5172),C=a(5343),S=a(579);const $=e=>(e||"").replace(/\s*NUEVO\s*$/i,"").trim(),M=(e,t)=>{if(!t)return null;const a="string"===typeof t?t:null===t||void 0===t?void 0:t.name;return e.find(e=>$(e.name)===$(a))||null},P=(e,t)=>Array.isArray(t)?t.map(t=>M(e,t)).filter(Boolean):[],T=function(){var e,t,a,s,l,r,o,n,i,d,c,m;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{address:null!==(e=null!==(t=u.address)&&void 0!==t?t:p.address)&&void 0!==e?e:"",phoneNumber:null!==(a=null!==(s=u.phoneNumber)&&void 0!==s?s:p.phoneNumber)&&void 0!==a?a:"",addressType:null!==(l=null!==(r=u.addressType)&&void 0!==r?r:p.addressType)&&void 0!==l?l:"",localName:null!==(o=null!==(n=u.localName)&&void 0!==n?n:p.localName)&&void 0!==o?o:"",unitDetails:null!==(i=null!==(d=u.unitDetails)&&void 0!==d?d:p.unitDetails)&&void 0!==i?i:"",recipientName:null!==(c=null!==(m=u.recipientName)&&void 0!==m?m:p.recipientName)&&void 0!==c?c:""}},E=e=>{var t,a,s,l;if(!e)return"N/A";if("string"===typeof e)return e;return[e.name,e.label,e.title,e.method,e.type,e.payment,e.value,null===e||void 0===e||null===(t=e.method)||void 0===t?void 0:t.name,null===e||void 0===e||null===(a=e.payment)||void 0===a?void 0:a.name,null===e||void 0===e||null===(s=e.value)||void 0===s?void 0:s.name,null===e||void 0===e||null===(l=e.type)||void 0===l?void 0:l.name].filter(e=>"string"===typeof e&&e.trim())[0]||"N/A"},O=e=>E((e=>{var t,a,s,l,r,o,n,i,d,c,m;return null!==(t=null!==(a=null!==(s=null!==(l=null!==(r=null===e||void 0===e||null===(o=e.meals)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.paymentMethod)&&void 0!==r?r:null===e||void 0===e||null===(i=e.breakfasts)||void 0===i||null===(d=i[0])||void 0===d?void 0:d.payment)&&void 0!==l?l:null===e||void 0===e||null===(c=e.breakfasts)||void 0===c||null===(m=c[0])||void 0===m?void 0:m.paymentMethod)&&void 0!==s?s:null===e||void 0===e?void 0:e.payment)&&void 0!==a?a:null===e||void 0===e?void 0:e.paymentMethod)&&void 0!==t?t:null})(e)),L=e=>("string"===typeof e?e:E(e)).toLowerCase().trim(),D=e=>{var t,a,$,D,B,q;let{theme:z="light"}=e;const{user:I,role:_,loading:R}=(0,r.A)(),H=(0,l.Zp)(),[K,F]=(0,s.useState)([]),[V,G]=(0,s.useState)(""),[X,Z]=(0,s.useState)(!1),[J,Q]=(0,s.useState)(null),[U,W]=(0,s.useState)(1),[Y,ee]=(0,s.useState)(10),[te,ae]=(0,s.useState)("createdAt"),[se,le]=(0,s.useState)("desc"),[re,oe]=(0,s.useState)(!1),[ne,ie]=(0,s.useState)(null),[de,ce]=(0,s.useState)(null),[me,ue]=(0,s.useState)("all"),[pe,xe]=(0,s.useState)([]),be=(0,s.useRef)(null),[he,ge]=(0,s.useState)([]),[ve,ye]=(0,s.useState)([]),[fe,je]=(0,s.useState)([]),[Ne,ke]=(0,s.useState)([]),[we,Ae]=(0,s.useState)([]),[Ce,Se]=(0,s.useState)([]),[$e,Me]=(0,s.useState)([]),[Pe,Te]=(0,s.useState)([]),[Ee,Oe]=(0,s.useState)([]),[Le,De]=(0,s.useState)([]),[Be,qe]=(0,s.useState)([]),[ze,Ie]=(0,s.useState)([]),[_e,Re]=(0,s.useState)([]),[He,Ke]=(0,s.useState)([]);(0,s.useEffect)(()=>{if(R)return;if(!I||2!==_)return Q("Acceso denegado. Solo los administradores pueden acceder a esta p\xe1gina."),void setTimeout(()=>H("/login"),3e3);Z(!0);const e=(0,n.aQ)((0,n.rJ)(o.db,"breakfastTypes"),e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));xe(t)},e=>{console.error("Error al escuchar breakfastTypes:",e),Q("Error al cargar tipos de desayuno. Intenta de nuevo.")}),t=(0,n.aQ)((0,n.rJ)(o.db,"breakfastOrders"),e=>{const t=e.docs.map(e=>({id:e.id,...e.data(),type:"breakfast",__collection:"breakfastOrders"}));F(e=>[...e.filter(e=>"breakfast"!==e.type),...t]),Z(!1)},e=>{console.error("Error al escuchar breakfastOrders:",e),Q("Error al cargar \xf3rdenes de desayunos. Intenta de nuevo."),Z(!1)}),a=(0,n.aQ)((0,n.rJ)(o.db,"tableOrders"),e=>{const t=e.docs.map(e=>({id:e.id,...e.data(),type:"lunch",__collection:"tableOrders"}));F(e=>[...e.filter(e=>"lunch"!==e.type),...t]),Z(!1)},e=>{console.error("Error al escuchar tableOrders:",e),Q("Error al cargar \xf3rdenes de mesas. Intenta de nuevo."),Z(!1)});return()=>{e(),t(),a()}},[I,R,_,H]),(0,s.useEffect)(()=>{const e=[],t=(t,a)=>{const s=(0,n.aQ)((0,n.rJ)(o.db,t),e=>{a(e.docs.map(e=>({id:e.id,...e.data()})))});e.push(s)};return t("soups",ge),t("soupReplacements",ye),t("principles",je),t("proteins",ke),t("drinks",Ae),t("sides",Se),t("additions",Me),t("paymentMethods",Te),t("breakfastEggs",Oe),t("breakfastBroths",De),t("breakfastRiceBread",qe),t("breakfastDrinks",Ie),t("breakfastAdditions",Re),t("breakfastProteins",Ke),()=>e.forEach(e=>e&&e())},[]),(0,s.useEffect)(()=>{function e(e){be.current&&!be.current.contains(e.target)&&oe(!1)}return re&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[re]);const Fe=(0,C.Zd)(K),Ve=K.filter(e=>{var t,a;const s=V.toLowerCase();return(e.id.toLowerCase().includes(s)||(null===(t=e.meals)||void 0===t?void 0:t.some(e=>{var t,a,l;const r=L(null!==(t=e.paymentMethod)&&void 0!==t?t:"");return(null===(a=e.tableNumber)||void 0===a?void 0:a.toString().toLowerCase().includes(s))||r.includes(s)||(null===(l=e.notes)||void 0===l?void 0:l.toLowerCase().includes(s))}))||(null===(a=e.breakfasts)||void 0===a?void 0:a.some(e=>{var t,a,l,r;const o=L(null!==(t=null!==(a=e.payment)&&void 0!==a?a:e.paymentMethod)&&void 0!==t?t:"");return(null===(l=e.tableNumber)||void 0===l?void 0:l.toString().toLowerCase().includes(s))||o.includes(s)||(null===(r=e.notes)||void 0===r?void 0:r.toLowerCase().includes(s))}))||Array.isArray(e.payments)&&e.payments.some(e=>L(e.method).includes(s)))&&("all"===me||e.type===me)}),Ge=[...Ve].sort((e,t)=>{const a="orderNumber"===te?"id":te,s="id"===a?e.id:e[a]||"",l="id"===a?t.id:t[a]||"";return"asc"===se?s>l?1:-1:s<l?1:-1}),Xe=Math.ceil(Ge.length/Y),Ze=Ge.slice((U-1)*Y,U*Y),Je=e=>{te===e?le("asc"===se?"desc":"asc"):(ae(e),le("asc"))},Qe=e=>te===e?"asc"===se?"\u2191":"\u2193":"",Ue=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!de)return void(Ue.current=null);if(!(he.length||fe.length||Ne.length||we.length||Ce.length||$e.length||pe.length||Le.length||Ee.length||Be.length||ze.length||_e.length||He.length||Pe.length))return;if(Ue.current===de.id)return;const e=Array.isArray(de.breakfasts),t=de.address||{};if(e){const e=(de.breakfasts||[]).map(e=>{var a;return{type:M(pe,e.type),broth:M(Le,e.broth),eggs:M(Ee,e.eggs),riceBread:M(Be,e.riceBread),drink:M(ze,e.drink),protein:M(He,e.protein),additions:Array.isArray(e.additions)?e.additions.map(e=>{var t,a;const s=M(_e,e);return s?{...s,quantity:e.quantity||1,price:null!==(t=null!==(a=s.price)&&void 0!==a?a:e.price)&&void 0!==t?t:0}:null}).filter(Boolean):[],cutlery:!!e.cutlery,time:"string"===typeof e.time?e.time:(null===(a=e.time)||void 0===a?void 0:a.name)||"",address:T(e.address,t),notes:e.notes||"",paymentMethod:M(Pe,e.payment||e.paymentMethod),orderType:e.orderType||"",tableNumber:e.tableNumber||""}});ce(t=>({...t,type:"breakfast",breakfasts:e}))}else{const e=(de.meals||[]).map(e=>{var a;return{soup:M(he,e.soup),soupReplacement:M(ve,e.soupReplacement),principle:P(fe,e.principle),protein:M(Ne,e.protein),drink:M(we,e.drink),sides:P(Ce,e.sides),additions:Array.isArray(e.additions)?e.additions.map(e=>{var t,a;const s=M($e,e);return s?{...s,quantity:e.quantity||1,price:null!==(t=null!==(a=e.price)&&void 0!==a?a:s.price)&&void 0!==t?t:0}:null}).filter(Boolean):[],cutlery:!!e.cutlery,time:"string"===typeof e.time?e.time:(null===(a=e.time)||void 0===a?void 0:a.name)||"",address:T(e.address,t),notes:e.notes||"",paymentMethod:e.paymentMethod?M(Pe,e.paymentMethod):null,orderType:e.orderType||"",tableNumber:e.tableNumber||""}});ce(t=>({...t,type:"lunch",meals:e}))}Ue.current=de.id},[de,he,ve,fe,Ne,we,Ce,$e,Pe,pe,Le,Ee,Be,ze,_e,He]),(0,s.useEffect)(()=>{if(de)if(Array.isArray(de.meals)){const e=Number((0,N.N9)(de.meals,_)||0);(de.total||0)!==e&&ce(t=>({...t,total:e}))}else if(Array.isArray(de.breakfasts)){const e=Number((0,k.VC)(de.breakfasts,_,pe)||0);(de.total||0)!==e&&ce(t=>({...t,total:e}))}},[null===de||void 0===de?void 0:de.meals,null===de||void 0===de?void 0:de.breakfasts,_,pe]);const We=(e,t,a)=>{ce(s=>{const l=[...s.meals||[]],r={...l[e]||{}};if("soup"===t)r.soup=a||null,r.soupReplacement=null;else if("soupReplacement"===t)r.soupReplacement=a||null,r.soup=null;else if(t.includes(".")){const[e,s]=t.split(".");r[e]={...r[e]||{},[s]:a}}else r[t]=a;return l[e]=r,{...s,meals:l}})},Ye=(e,t,a)=>{ce(s=>{const l=[...s.breakfasts||[]],r={...l[e]||{}};if(t.includes(".")){const[e,s]=t.split(".");r[e]={...r[e]||{},[s]:a}}else r[t]=a;return l[e]=r,{...s,breakfasts:l}})},et=()=>{const e=Ve.map(e=>{var t,a,s,l,r;const o=Array.isArray(e.payments)&&e.payments.length?(0,C.XF)(e.payments):O(e);return{"N\xba Orden":e.id.slice(0,8),Tipo:"breakfast"===e.type?"Desayuno":"Almuerzo",Mesa:E((null===(t=e.meals)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.tableNumber)||(null===(s=e.breakfasts)||void 0===s||null===(l=s[0])||void 0===l?void 0:l.tableNumber)),Estado:e.status,Total:`$${(null===(r=e.total)||void 0===r?void 0:r.toLocaleString("es-CO"))||"N/A"}`,"M\xe9todo de Pago":o,Detalles:"lunch"===e.type?e.meals.map((e,t)=>`Almuerzo #${t+1}: Sopa: ${E(e.soup||e.soupReplacement)}, Principio: ${E(e.principle)}, Prote\xedna: ${E(e.protein)}, Bebida: ${E(e.drink)}, Acompa\xf1amientos: ${E(e.sides)}, Notas: ${e.notes||"Ninguna"}`).join("; "):e.breakfasts.map((e,t)=>`Desayuno #${t+1}: Tipo: ${E(e.type)}, Caldo: ${E(e.broth)}, Huevos: ${E(e.eggs)}, Arroz/Pan: ${E(e.riceBread)}, Bebida: ${E(e.drink)}, Prote\xedna: ${E(e.protein)}, Adiciones: ${E(e.additions)}, Notas: ${e.notes||"Ninguna"}`).join("; ")}}),t=f.Wp.json_to_sheet(e),a=f.Wp.book_new();f.Wp.book_append_sheet(a,t,"\xd3rdenes"),f._h(a,`ordenes_${me}_${(0,w.GP)(new Date,"yyyy-MM-dd_HH-mm-ss")}.xlsx`)},tt=()=>{const e=new j.default;e.text("\xd3rdenes",14,10),e.autoTable({head:[["N\xba Orden","Tipo","Mesa","Estado","Total","M\xe9todo de Pago","Detalles"]],body:Ve.map(e=>{var t,a,s,l,r;const o=Array.isArray(e.payments)&&e.payments.length?(0,C.XF)(e.payments):O(e);return[e.id.slice(0,8),"breakfast"===e.type?"Desayuno":"Almuerzo",E((null===(t=e.meals)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.tableNumber)||(null===(s=e.breakfasts)||void 0===s||null===(l=s[0])||void 0===l?void 0:l.tableNumber)),e.status,`$${(null===(r=e.total)||void 0===r?void 0:r.toLocaleString("es-CO"))||"N/A"}`,o,"lunch"===e.type?e.meals.map((e,t)=>`Almuerzo #${t+1}: Sopa: ${E(e.soup||e.soupReplacement)}, Principio: ${E(e.principle)}, Prote\xedna: ${E(e.protein)}, Bebida: ${E(e.drink)}, Acompa\xf1amientos: ${E(e.sides)}`).join("; "):e.breakfasts.map((e,t)=>`Desayuno #${t+1}: Tipo: ${E(e.type)}, Caldo: ${E(e.broth)}, Huevos: ${E(e.eggs)}, Arroz/Pan: ${E(e.riceBread)}, Bebida: ${E(e.drink)}, Prote\xedna: ${E(e.protein)}, Adiciones: ${E(e.additions)}`).join("; ")]})}),e.save(`ordenes_${me}_${(0,w.GP)(new Date,"yyyy-MM-dd_HH-mm-ss")}.pdf`)},at=()=>{const e=[["N\xba Orden","Tipo","Mesa","Estado","Total","M\xe9todo de Pago","Detalles"],...Ve.map(e=>{var t,a,s,l,r;const o=Array.isArray(e.payments)&&e.payments.length?(0,C.XF)(e.payments):O(e);return[e.id.slice(0,8),"breakfast"===e.type?"Desayuno":"Almuerzo",E((null===(t=e.meals)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.tableNumber)||(null===(s=e.breakfasts)||void 0===s||null===(l=s[0])||void 0===l?void 0:l.tableNumber)),e.status,`$${(null===(r=e.total)||void 0===r?void 0:r.toLocaleString("es-CO"))||"N/A"}`,o,`${"lunch"===e.type?e.meals.map((e,t)=>`Almuerzo #${t+1}: Sopa: ${E(e.soup||e.soupReplacement)}, Principio: ${E(e.principle)}, Prote\xedna: ${E(e.protein)}, Bebida: ${E(e.drink)}, Acompa\xf1amientos: ${E(e.sides)}, Notas: ${e.notes||"Ninguna"}`).join("; "):e.breakfasts.map((e,t)=>`Desayuno #${t+1}: Tipo: ${E(e.type)}, Caldo: ${E(e.broth)}, Huevos: ${E(e.eggs)}, Arroz/Pan: ${E(e.riceBread)}, Bebida: ${E(e.drink)}, Prote\xedna: ${E(e.protein)}, Adiciones: ${E(e.additions)}, Notas: ${e.notes||"Ninguna"}`).join("; ")}`]})].map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=`ordenes_${me}_${(0,w.GP)(new Date,"yyyy-MM-dd_HH-mm-ss")}.csv`,a.click()},st=e=>{e(),Q(null)};return R?(0,S.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:"Cargando..."}):(0,S.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,S.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6",children:"Gesti\xf3n de pedidos Mesas"}),(0,S.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 text-sm text-gray-700 dark:text-gray-300",children:[(0,S.jsxs)("div",{className:(0,i.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===z?"bg-gray-700":"bg-gray-100"),children:[(0,S.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total Efectivo"}),(0,S.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor(Fe.cash).toLocaleString("es-CO")]})]}),(0,S.jsxs)("div",{className:(0,i.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===z?"bg-gray-700":"bg-gray-100"),children:[(0,S.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total Daviplata"}),(0,S.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor(Fe.daviplata).toLocaleString("es-CO")]})]}),(0,S.jsxs)("div",{className:(0,i.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===z?"bg-gray-700":"bg-gray-100"),children:[(0,S.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total Nequi"}),(0,S.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor(Fe.nequi).toLocaleString("es-CO")]})]}),(0,S.jsxs)("div",{className:(0,i.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===z?"bg-gray-700":"bg-gray-100"),children:[(0,S.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total General"}),(0,S.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor(Fe.cash+Fe.daviplata+Fe.nequi).toLocaleString("es-CO")]})]})]}),(0,S.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-6 gap-3 sm:gap-4",children:[(0,S.jsx)("input",{type:"text",value:V,onChange:e=>G(e.target.value),placeholder:"Buscar \xf3rdenes por ID, mesa o m\xe9todo de pago...",className:(0,i.x)("p-2 sm:p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:max-w-xs shadow-sm text-sm sm:text-base transition-all duration-200","dark"===z?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white text-gray-900")}),(0,S.jsxs)("div",{className:"relative z-50 flex-shrink-0",ref:be,children:[(0,S.jsx)("button",{onClick:()=>oe(!re),className:(0,i.x)("flex items-center justify-center p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-blue-500"),"aria-label":"Opciones de men\xfa",children:(0,S.jsx)(d.A,{className:(0,i.x)("w-6 h-6","dark"===z?"text-gray-200 hover:text-white":"text-gray-700 hover:text-gray-900")})}),re&&(0,S.jsx)("div",{className:(0,i.x)("absolute right-0 mt-2 w-48 rounded-lg shadow-xl z-50","dark"===z?"bg-gray-700 text-gray-200":"bg-white text-gray-900"),children:(0,S.jsxs)("div",{className:"py-1",children:[(0,S.jsx)("button",{onClick:()=>{ue("breakfast"),oe(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Ver Desayunos"}),(0,S.jsx)("button",{onClick:()=>{ue("lunch"),oe(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Ver Almuerzos"}),(0,S.jsx)("button",{onClick:()=>{ue("all"),oe(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Ver Todos"}),(0,S.jsxs)("button",{onClick:()=>{st(et),oe(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 flex items-center",children:[(0,S.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Exportar Excel"]}),(0,S.jsxs)("button",{onClick:()=>{st(tt),oe(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 flex items-center",children:[(0,S.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Exportar PDF"]}),(0,S.jsxs)("button",{onClick:()=>{st(at),oe(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 flex items-center",children:[(0,S.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})]})})]})]}),(0,S.jsx)("div",{className:(0,i.x)("p-3 sm:p-4 rounded-2xl shadow-xl max-h-[70vh] overflow-y-auto custom-scrollbar transition-all duration-300","dark"===z?"bg-gray-800":"bg-white"),children:X?(0,S.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,S.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500"})}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"overflow-x-auto",children:(0,S.jsxs)("table",{className:"min-w-full text-left border-collapse text-sm",children:[(0,S.jsx)("thead",{children:(0,S.jsxs)("tr",{className:(0,i.x)("font-semibold sticky top-0 z-10 shadow-sm","dark"===z?"bg-gray-700 text-gray-200":"bg-gray-100 text-gray-700"),children:[(0,S.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>Je("orderNumber"),children:["N\xba ",Qe("orderNumber")]}),(0,S.jsx)("th",{className:"p-2 sm:p-3 border-b whitespace-nowrap",children:"Detalles"}),(0,S.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>Je("meals.0.tableNumber"),children:["Mesa ",Qe("meals.0.tableNumber")]}),(0,S.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>Je("meals.0.paymentMethod.name"),children:["Pago ",Qe("meals.0.paymentMethod.name")]}),(0,S.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>Je("total"),children:["Total ",Qe("total")]}),(0,S.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>Je("status"),children:["Estado ",Qe("status")]}),(0,S.jsx)("th",{className:"p-2 sm:p-3 border-b whitespace-nowrap",children:"Acciones"})]})}),(0,S.jsx)("tbody",{children:0===Ze.length?(0,S.jsx)("tr",{children:(0,S.jsx)("td",{colSpan:"7",className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"No se encontraron \xf3rdenes de mesas. Intenta ajustar tu b\xfasqueda."})}):Ze.map((e,t)=>{var a,s,l,r,d;const c="asc"===se?(U-1)*Y+t+1:Ze.length-((U-1)*Y+t),x=Array.isArray(e.payments)&&e.payments.length?(0,C.XF)(e.payments):O(e),b="Pendiente"===e.status?"bg-yellow-500 text-black":"Preparando"===e.status?"bg-blue-500 text-white":"Completada"===e.status?"bg-green-500 text-white":"Cancelada"===e.status?"bg-red-500 text-white":"";return(0,S.jsxs)("tr",{className:(0,i.x)("border-b transition-colors.duration-150","dark"===z?"border-gray-700 hover:bg-gray-700":"border-gray-200 hover:bg-gray-50",t%2===0?"dark"===z?"bg-gray-750":"bg-gray-50":""),children:[(0,S.jsx)("td",{className:"p-2 sm:p-3 text-gray-300",children:c}),(0,S.jsx)("td",{className:"p-2 sm:p-3 text-gray-300",children:(0,S.jsxs)("button",{onClick:()=>ie(e),className:"text-blue-400 hover:text-blue-300 text-xs sm:text-sm flex items-center",title:"Ver detalles de la orden",children:[(0,S.jsx)(m.A,{className:"w-4 h-4 mr-1"}),"Ver"]})}),(0,S.jsx)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:E((null===(a=e.meals)||void 0===a||null===(s=a[0])||void 0===s?void 0:s.tableNumber)||(null===(l=e.breakfasts)||void 0===l||null===(r=l[0])||void 0===r?void 0:r.tableNumber))}),(0,S.jsx)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:x}),(0,S.jsxs)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:["$",(null===(d=e.total)||void 0===d?void 0:d.toLocaleString("es-CO"))||"N/A"]}),(0,S.jsx)("td",{className:"p-2 sm:p-3 whitespace-nowrap",children:(0,S.jsxs)("select",{value:e.status||"Pendiente",onChange:t=>(async(e,t)=>{try{Z(!0);const a="breakfast"===K.find(t=>t.id===e).type?"breakfastOrders":"tableOrders",s=(0,n.H9)(o.db,a,e);await(0,n.mZ)(s,{status:t,updatedAt:new Date}),Q(null)}catch(a){console.error("Error al actualizar estado:",a),Q("Error al actualizar el estado de la orden. Intenta de nuevo.")}finally{Z(!1)}})(e.id,t.target.value),className:(0,i.x)("px-2 py-1 rounded-full text-xs font-semibold appearance-none cursor-pointer",b,"dark"===z?"bg-opacity-70":"bg-opacity-90","focus:outline-none focus:ring-2 focus:ring-blue-500"),children:[(0,S.jsx)("option",{value:"Pendiente",children:"Pendiente"}),(0,S.jsx)("option",{value:"Preparando",children:"Preparando"}),(0,S.jsx)("option",{value:"Completada",children:"Completada"}),(0,S.jsx)("option",{value:"Cancelada",children:"Cancelada"})]})}),(0,S.jsxs)("td",{className:"p-2 sm:p-3 whitespace-nowrap",children:[(0,S.jsx)("button",{onClick:()=>(e=>{ce(e)})(e),className:"text-blue-500 hover:text-blue-400 transition-colors duration-150 p-1 rounded-md mr-2",title:"Editar orden","aria-label":`Editar orden ${c}`,children:(0,S.jsx)(u.A,{className:"w-5 h-5"})}),(0,S.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xbfEst\xe1s seguro de que deseas eliminar esta orden?"))try{Z(!0);const t="breakfast"===K.find(t=>t.id===e).type?"breakfastOrders":"tableOrders";await(0,n.kd)((0,n.H9)(o.db,t,e)),Q(null)}catch(t){console.error("Error al eliminar orden:",t),Q("Error al eliminar la orden. Intenta de nuevo.")}finally{Z(!1)}})(e.id),className:"text-red-500 hover:text-red-400 transition-colors duration-150 p-1 rounded-md",title:"Eliminar orden","aria-label":`Eliminar orden ${c}`,children:(0,S.jsx)(p.A,{className:"w-5 h-5"})})]})]},e.id)})})]})}),(0,S.jsxs)("div",{className:"flex flex-wrap justify-between items-center mt-6 gap-3",children:[(0,S.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[(0,S.jsx)("span",{children:"\xd3rdenes por p\xe1gina:"}),(0,S.jsxs)("select",{value:Y,onChange:e=>{ee(Number(e.target.value)),W(1)},className:(0,i.x)("p-2 rounded-md border text-sm","dark"===z?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white text-gray-900"),children:[(0,S.jsx)("option",{value:"10",children:"10"}),(0,S.jsx)("option",{value:"20",children:"20"}),(0,S.jsx)("option",{value:"30",children:"30"}),(0,S.jsx)("option",{value:"50",children:"50"})]})]}),(0,S.jsxs)("div",{className:"flex.items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[(0,S.jsx)("button",{onClick:()=>W(e=>Math.max(e-1,1)),disabled:1===U,className:(0,i.x)("p-2 rounded-md transition-colors duration-200",1===U?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"dark"===z?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-100 text-gray-700"),children:(0,S.jsx)(x.A,{className:"w-5 h-5"})}),(0,S.jsxs)("span",{children:["P\xe1gina ",U," de ",Xe]}),(0,S.jsx)("button",{onClick:()=>W(e=>Math.min(e+1,Xe)),disabled:U===Xe,className:(0,i.x)("p-2 rounded-md transition-colors duration-200",U===Xe?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"dark"===z?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-100 text-gray-700"),children:(0,S.jsx)(b.A,{className:"w-5 h-5"})})]})]}),ne&&(0,S.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10001]",children:(0,S.jsxs)("div",{className:(0,i.x)("p-4 sm:p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto","dark"===z?"bg-gray-800 text-gray-200":"bg-white text-gray-900"),children:[(0,S.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Detalles de la Orden #",ne.id.slice(0,8)]}),(0,S.jsxs)("p",{className:"text-sm mb-2",children:["Mesa: ",(null===(t=ne.meals)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.tableNumber)||(null===($=ne.breakfasts)||void 0===$||null===(D=$[0])||void 0===D?void 0:D.tableNumber)||"N/A"]}),(0,S.jsxs)("p",{className:"text-sm mb-2",children:["Estado: ",ne.status]}),(0,S.jsxs)("p",{className:"text-sm mb-4",children:["Total: $",(null===(B=ne.total)||void 0===B?void 0:B.toLocaleString("es-CO"))||"N/A"]}),(0,S.jsx)(v.A,{meals:ne.meals||ne.breakfasts,isTableOrder:!0,calculateTotal:()=>ne.total}),(0,S.jsx)("button",{onClick:()=>ie(null),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:"Cerrar"})]})}),de&&(0,S.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10001]",children:(0,S.jsxs)("div",{className:(0,i.x)("p-4 sm:p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto","dark"===z?"bg-gray-800 text-gray-200":"bg-white text-gray-900"),children:[(0,S.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Editar Orden #",de.id.slice(0,8)]}),Array.isArray(de.breakfasts)?de.breakfasts.map((e,t)=>(0,S.jsxs)("div",{className:"mb-6 p-4 border rounded-md border-gray-200 dark:border-gray-700",children:[(0,S.jsxs)("h4",{className:"text-sm font-medium mb-2",children:["Desayuno #",t+1]}),(0,S.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Tipo"}),(0,S.jsx)(y.A,{title:"Tipo",emoji:"\ud83e\udd5e",options:pe,selected:e.type||null,multiple:!1,onImmediateSelect:e=>Ye(t,"type",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Caldo"}),(0,S.jsx)(y.A,{title:"Caldo",emoji:"\ud83e\udd63",options:Le,selected:e.broth||null,multiple:!1,onImmediateSelect:e=>Ye(t,"broth",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium.mb-1",children:"Huevos"}),(0,S.jsx)(y.A,{title:"Huevos",emoji:"\ud83e\udd5a",options:Ee,selected:e.eggs||null,multiple:!1,onImmediateSelect:e=>Ye(t,"eggs",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Arroz/Pan"}),(0,S.jsx)(y.A,{title:"Arroz/Pan",emoji:"\ud83c\udf5e",options:Be,selected:e.riceBread||null,multiple:!1,onImmediateSelect:e=>Ye(t,"riceBread",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Bebida"}),(0,S.jsx)(y.A,{title:"Bebida",emoji:"\ud83e\udd64",options:ze,selected:e.drink||null,multiple:!1,onImmediateSelect:e=>Ye(t,"drink",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Prote\xedna"}),(0,S.jsx)(y.A,{title:"Prote\xedna",emoji:"\ud83c\udf56",options:He,selected:e.protein||null,multiple:!1,onImmediateSelect:e=>Ye(t,"protein",e)})]}),(0,S.jsxs)("div",{className:"sm:col-span-2",children:[(0,S.jsx)("label",{className:"block.text-xs font-medium mb-1",children:"Adiciones"}),(0,S.jsx)(y.A,{title:"Adiciones",emoji:"\u2795",options:_e,selected:e.additions||[],multiple:!0,onImmediateSelect:e=>Ye(t,"additions",e.map(e=>({name:e.name,quantity:e.quantity||1,price:e.price||0})))})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"M\xe9todo de Pago"}),(0,S.jsx)(y.A,{title:"M\xe9todo de Pago",emoji:"\ud83d\udcb3",options:Pe,selected:e.paymentMethod||null,multiple:!1,onImmediateSelect:e=>Ye(t,"paymentMethod",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"N\xfamero de Mesa"}),(0,S.jsx)("input",{type:"text",value:e.tableNumber||"",onChange:e=>Ye(t,"tableNumber",e.target.value),className:(0,i.x)("w-full p-2 rounded-md border text-sm","dark"===z?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Tipo de Pedido"}),(0,S.jsxs)("select",{value:e.orderType||"",onChange:e=>Ye(t,"orderType",e.target.value),className:(0,i.x)("w-full p-2 rounded-md border text-sm","dark"===z?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,S.jsx)("option",{value:"",children:"Seleccionar"}),(0,S.jsx)("option",{value:"table",children:"Para mesa"}),(0,S.jsx)("option",{value:"takeaway",children:"Para llevar"})]})]}),(0,S.jsxs)("div",{className:"sm:col-span-2",children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Notas"}),(0,S.jsx)("input",{type:"text",value:e.notes||"",onChange:e=>Ye(t,"notes",e.target.value),className:(0,i.x)("w-full p-2 rounded-md border text-sm","dark"===z?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]})]})]},t)):null===(q=de.meals)||void 0===q?void 0:q.map((e,t)=>(0,S.jsxs)("div",{className:"mb-6 p-4 border rounded-md border-gray-200 dark:border-gray-700",children:[(0,S.jsxs)("h4",{className:"text-sm font-medium mb-2",children:["Almuerzo #",t+1]}),(0,S.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Sopa (excluyente con Reemplazo)"}),(0,S.jsx)(y.A,{title:"Sopa",emoji:"\ud83e\udd63",options:he,selected:e.soup||null,multiple:!1,onImmediateSelect:e=>We(t,"soup",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Reemplazo (ej: Solo bandeja)"}),(0,S.jsx)(y.A,{title:"Reemplazo",emoji:"\ud83d\udeab",options:ve,selected:e.soupReplacement||null,multiple:!1,onImmediateSelect:e=>We(t,"soupReplacement",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Principio"}),(0,S.jsx)(y.A,{title:"Principio",emoji:"\ud83c\udf5a",options:fe,selected:e.principle||[],multiple:!0,showConfirmButton:!0,onImmediateSelect:e=>We(t,"principle",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Prote\xedna"}),(0,S.jsx)(y.A,{title:"Prote\xedna",emoji:"\ud83c\udf56",options:Ne,selected:e.protein||null,multiple:!1,onImmediateSelect:e=>We(t,"protein",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Bebida"}),(0,S.jsx)(y.A,{title:"Bebida",emoji:"\ud83e\udd64",options:we,selected:e.drink||null,multiple:!1,onImmediateSelect:e=>We(t,"drink",e)})]}),(0,S.jsxs)("div",{className:"sm:col-span-2",children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Acompa\xf1amientos"}),(0,S.jsx)(y.A,{title:"Acompa\xf1amientos",emoji:"\ud83e\udd57",options:Ce,selected:e.sides||[],multiple:!0,onImmediateSelect:e=>We(t,"sides",e)})]}),(0,S.jsxs)("div",{className:"sm:col-span-2",children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Adiciones"}),(0,S.jsx)(y.A,{title:"Adiciones",emoji:"\u2795",options:$e,selected:e.additions||[],multiple:!0,onImmediateSelect:e=>We(t,"additions",e.map(e=>({id:e.id,name:e.name,price:e.price||0,protein:e.protein||"",replacement:e.replacement||"",quantity:e.quantity||1})))})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"M\xe9todo de Pago (legacy)"}),(0,S.jsx)(y.A,{title:"M\xe9todo de Pago",emoji:"\ud83d\udcb3",options:Pe,selected:e.paymentMethod||null,multiple:!1,onImmediateSelect:e=>We(t,"paymentMethod",e)})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"N\xfamero de Mesa"}),(0,S.jsx)("input",{type:"text",value:e.tableNumber||"",onChange:e=>We(t,"tableNumber",e.target.value),className:(0,i.x)("w-full p-2 rounded-md border text-sm","dark"===z?"border-gray-600 bg-gray-700 text.white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Tipo de Pedido"}),(0,S.jsxs)("select",{value:e.orderType||"",onChange:e=>We(t,"orderType",e.target.value),className:(0,i.x)("w-full p-2 rounded-md border text-sm","dark"===z?"border-gray-600 bg-gray-700 text.white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,S.jsx)("option",{value:"",children:"Seleccionar"}),(0,S.jsx)("option",{value:"table",children:"Para mesa"}),(0,S.jsx)("option",{value:"takeaway",children:"Para llevar"})]})]}),(0,S.jsxs)("div",{className:"sm:col-span-2",children:[(0,S.jsx)("label",{className:"block text-xs font-medium mb-1",children:"Notas"}),(0,S.jsx)("input",{type:"text",value:e.notes||"",onChange:e=>We(t,"notes",e.target.value),className:(0,i.x)("w-full p-2 rounded-md border text-sm","dark"===z?"border-gray-600 bg-gray-700 text.white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]})]})]},t)),(0,S.jsxs)("div",{children:[(0,S.jsx)("label",{className:"text-xs block mb-1",children:"Total (se recalcula autom\xe1ticamente)"}),(0,S.jsx)("input",{type:"number",value:de.total||0,onChange:e=>{return t=e.target.value,void ce(e=>({...e,total:Number(t)||0}));var t},placeholder:"Total",className:(0,i.x)("w-full p-2 mt-1 border rounded text-sm","dark"===z?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900")})]}),(0,S.jsx)("div",{className:"mt-4",children:(0,S.jsx)(A.A,{theme:z,total:de.total||0,value:Array.isArray(de.payments)&&de.payments.length?de.payments:(0,C._s)(de),catalogMethods:Pe,onChange:e=>{ce(t=>({...t,payments:e}))}})}),(0,S.jsxs)("div",{className:"mt-4 flex space-x-2",children:[(0,S.jsx)("button",{onClick:async()=>{try{Z(!0);const e=Array.isArray(de.breakfasts),t=e?"breakfastOrders":"tableOrders",a=(0,n.H9)(o.db,t,de.id),s=Number(e?(0,k.VC)(de.breakfasts,_,pe)||0:(0,N.N9)(de.meals,_)||0),l=Array.isArray(de.payments)&&de.payments.length?de.payments.map(e=>{var t;return{method:"string"===typeof e.method?e.method:(null===e||void 0===e||null===(t=e.method)||void 0===t?void 0:t.name)||"",amount:Math.floor(Number(e.amount||0))||0,note:e.note||""}}):(0,C._s)({...de,total:s}),r=l.reduce((e,t)=>e+(t.amount||0),0);if(r!==s)return alert(`La suma de pagos (${r.toLocaleString("es-CO")}) no coincide con el total (${s.toLocaleString("es-CO")}). Aj\xfastala antes de guardar.`),void Z(!1);const i=e?{breakfasts:de.breakfasts}:{meals:de.meals};await(0,n.mZ)(a,{...i,payments:l,total:s,updatedAt:new Date}),ce(null),Q(null)}catch(e){console.error("Error al guardar edici\xf3n:",e),Q("Error al guardar los cambios. Intenta de nuevo.")}finally{Z(!1)}},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",children:"Guardar"}),(0,S.jsx)("button",{onClick:()=>ce(null),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",children:"Cancelar"})]})]})})]})}),(0,S.jsxs)("div",{className:"fixed top-16 right-4 z-[10002] space-y-2 w-80 max-w-xs",children:[X&&(0,S.jsx)(h.A,{}),J&&(0,S.jsx)(g.A,{message:J,onClose:()=>Q(null)})]})]})}}}]);
//# sourceMappingURL=181.a4f42f88.chunk.js.map