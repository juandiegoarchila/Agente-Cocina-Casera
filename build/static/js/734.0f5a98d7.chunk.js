"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[734],{5172:(e,t,a)=>{a.d(t,{A:()=>d});var r=a(5043),n=a(6568),l=a(579);const i=e=>{const t=Math.floor(Number(e||0));return Number.isFinite(t)?t:0},o=e=>(e||"").toString().trim().toLowerCase(),s=e=>{if(Array.isArray(e)&&e.length){const t=e.map(e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.label)||"").filter(Boolean);return Array.from(new Set(t))}return["Efectivo","Nequi","Daviplata"]};function d(e){let{theme:t="light",total:a=0,value:d=[],onChange:c,catalogMethods:m=[],disabled:u=!1}=e;const p=(0,r.useMemo)(()=>s(m),[m]),[g,h]=(0,r.useState)(()=>{const e=Array.isArray(d)?d:[];return e.length?e.map(e=>{var t;return{method:"string"===typeof e.method?e.method:(null===e||void 0===e||null===(t=e.method)||void 0===t?void 0:t.name)||"",amount:i(e.amount),note:e.note||""}}):[{method:"Efectivo",amount:i(a),note:""}]});(0,r.useEffect)(()=>{const e=Array.isArray(d)?d:[];e.length&&h(e.map(e=>{var t;return{method:"string"===typeof e.method?e.method:(null===e||void 0===e||null===(t=e.method)||void 0===t?void 0:t.name)||"",amount:i(e.amount),note:e.note||""}}))},[d]);const x=g.reduce((e,t)=>e+i(t.amount),0),y=i(a)-x,b=0===y,v=e=>{h(e),c&&c(e.map(e=>({method:e.method,amount:i(e.amount),note:e.note||""})))},f=(e,t,a)=>{const r=g.map((r,n)=>n===e?{...r,[t]:"amount"===t?i(a):a}:r);v(r)};return(0,l.jsxs)("div",{className:(0,n.x)("p-3 rounded-lg border","dark"===t?"border-gray-600 bg-gray-800":"border-gray-200 bg-gray-50"),children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-2",children:[(0,l.jsx)("h5",{className:"font-semibold text-sm",children:"Dividir pago"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)("button",{type:"button",disabled:u,onClick:()=>{if(p.length<2)return;const e=Math.floor(i(a)/2),t=i(a)-e;v([{method:p[0],amount:e,note:""},{method:p[1],amount:t,note:""}])},className:(0,n.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"50 / 50"}),(0,l.jsx)("button",{type:"button",disabled:u,onClick:()=>{const e=Math.floor(i(a)/3),t=Math.floor((i(a)-e)/2),r=i(a)-e-t;v([{method:p[0]||"Efectivo",amount:e,note:""},{method:p[1]||"Nequi",amount:t,note:""},{method:p[2]||"Daviplata",amount:r,note:""}])},className:(0,n.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"1/3 cada uno"}),p.map(e=>(0,l.jsxs)("button",{type:"button",disabled:u,onClick:()=>(e=>{v([{method:e,amount:i(a),note:""}])})(e),className:(0,n.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:["Todo ",e]},e))]})]}),(0,l.jsx)("div",{className:"space-y-2",children:g.map((e,r)=>(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-2 items-center",children:[(0,l.jsx)("select",{disabled:u,value:e.method,onChange:e=>f(r,"method",e.target.value),className:(0,n.x)("sm:col-span-4 p-2 rounded border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white"),children:p.map(e=>(0,l.jsx)("option",{value:e,children:e},e))}),(0,l.jsx)("input",{disabled:u,type:"number",min:"0",step:"1",value:e.amount,onChange:e=>f(r,"amount",e.target.value),className:(0,n.x)("sm:col-span-4 p-2 rounded border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white"),placeholder:"Monto en COP"}),(0,l.jsx)("input",{disabled:u,type:"text",value:e.note||"",onChange:e=>f(r,"note",e.target.value),className:(0,n.x)("sm:col-span-3 p-2 rounded border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white"),placeholder:"Nota (opcional)"}),(0,l.jsx)("div",{className:"sm:col-span-1 flex justify-end",children:(0,l.jsx)("button",{type:"button",disabled:u,onClick:()=>(e=>{const t=g.filter((t,a)=>a!==e);v(t.length?t:[{method:"Efectivo",amount:i(a),note:""}])})(r),className:(0,n.x)("px-2 py-1 rounded text-xs border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"\u2715"})})]},r))}),(0,l.jsxs)("div",{className:"mt-3 flex items-center justify-between text-sm",children:[(0,l.jsx)("button",{type:"button",disabled:u,onClick:()=>{const e=p.find(e=>!g.some(t=>o(t.method)===o(e)))||p[0],t=[...g,{method:e,amount:Math.max(0,y),note:""}];v(t)},className:(0,n.x)("px-3 py-1 rounded border","dark"===t?"border-gray-500 hover:bg-gray-700":"border-gray-300 hover:bg-white"),children:"+ A\xf1adir l\xednea"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{children:"Total pedido:"}),(0,l.jsxs)("strong",{children:["$",i(a).toLocaleString("es-CO")]})]})]}),(0,l.jsx)("div",{className:"mt-2",children:b?(0,l.jsx)("span",{className:(0,n.x)("inline-block text-xs px-2 py-1 rounded","dark"===t?"bg-green-700 text-white":"bg-green-100 text-green-800"),children:"\u2714 Suma exacta"}):y>0?(0,l.jsxs)("span",{className:(0,n.x)("inline-block text-xs px-2 py-1 rounded","dark"===t?"bg-yellow-700 text-white":"bg-yellow-100 text-yellow-800"),children:["Falta asignar $",y.toLocaleString("es-CO")]}):(0,l.jsxs)("span",{className:(0,n.x)("inline-block text-xs px-2 py-1 rounded","dark"===t?"bg-red-700 text-white":"bg-red-100 text-red-800"),children:["Sobran $",Math.abs(y).toLocaleString("es-CO")]})})]})}},5343:(e,t,a)=>{a.d(t,{XF:()=>o,Zd:()=>d,_s:()=>s,fz:()=>m});const r=e=>(null!==e&&void 0!==e?e:"").toString().trim().toLowerCase(),n=e=>{const t="string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.label)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.method)||(null===e||void 0===e?void 0:e.type)||(null===e||void 0===e?void 0:e.payment)||"",a=r(t);return a.includes("efect")||a.includes("cash")?"cash":a.includes("nequi")?"nequi":a.includes("davi")?"daviplata":"other"},l=e=>"string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.label)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.method)||(null===e||void 0===e?void 0:e.type)||(null===e||void 0===e?void 0:e.payment)||"Otro",i=e=>{var t,a,r,i,o,s,d,c,m,u,p;const g=Math.floor(Number((null===e||void 0===e?void 0:e.total)||0))||0;if(Array.isArray(null===e||void 0===e?void 0:e.payments)&&e.payments.length)return e.payments.map(e=>{const t=Math.floor(Number((null===e||void 0===e?void 0:e.amount)||0))||0;return{methodKey:n(null===e||void 0===e?void 0:e.method),amount:t,rawLabel:l(null===e||void 0===e?void 0:e.method)}});const h=[null!==(t=null===e||void 0===e||null===(a=e.meals)||void 0===a||null===(r=a[0])||void 0===r?void 0:r.paymentMethod)&&void 0!==t?t:null===e||void 0===e||null===(i=e.meals)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.payment,null!==(s=null===e||void 0===e||null===(d=e.breakfasts)||void 0===d||null===(c=d[0])||void 0===c?void 0:c.payment)&&void 0!==s?s:null===e||void 0===e||null===(m=e.breakfasts)||void 0===m||null===(u=m[0])||void 0===u?void 0:u.paymentMethod,null!==(p=null===e||void 0===e?void 0:e.paymentMethod)&&void 0!==p?p:null===e||void 0===e?void 0:e.payment].filter(Boolean);if(h.length){const e=l(h[0]);return[{methodKey:n(h[0]),amount:g,rawLabel:e}]}return[{methodKey:"other",amount:g,rawLabel:"Otro"}]},o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||!e.length)return"Sin pago";const t=e.reduce((e,t)=>{const a=t.methodKey||n(null===t||void 0===t?void 0:t.method);return e[a]=(e[a]||0)+(Math.floor(Number(t.amount||0))||0),e},{}),a=[];return t.cash&&a.push(`Efectivo $${t.cash.toLocaleString("es-CO")}`),t.nequi&&a.push(`Nequi $${t.nequi.toLocaleString("es-CO")}`),t.daviplata&&a.push(`Daviplata $${t.daviplata.toLocaleString("es-CO")}`),t.other&&!a.length&&a.push(`Otro $${t.other.toLocaleString("es-CO")}`),a.join(" + ")||"Sin pago"},s=e=>{const t=i(e);if(null!==t&&void 0!==t&&t.length)return t.map(e=>{let{methodKey:t,amount:a}=e;return{method:t,amount:a}});return[{method:"cash",amount:Math.floor(Number((null===e||void 0===e?void 0:e.total)||0))||0}]},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t={cash:0,nequi:0,daviplata:0,other:0,total:0};for(const a of e){const e=i(a);for(const a of e){const e=Math.floor(Number(a.amount||0))||0;t[a.methodKey]=(t[a.methodKey]||0)+e,t.total+=e}}return t},c=e=>{var t,a;if(((null===e||void 0===e?void 0:e.__collection)||"").toLowerCase().includes("table"))return!0;const n=r((null===e||void 0===e?void 0:e.orderType)||(null===e||void 0===e||null===(t=e.breakfasts)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.orderType)||"");return!(!Array.isArray(null===e||void 0===e?void 0:e.breakfasts)||!(n.includes("table")||n.includes("takeaway")||n.includes("para llevar")||n.includes("llevar")))},m=function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const a={nequiTotal:0,daviplataTotal:0,nequiPendiente:0,daviplatasPendiente:0,cashSalon:0,cashClientesSettled:0,cashClientesPendiente:0,totalLiquidado:0,totalPendiente:0,totalDomicilios:0,totalSalon:0},r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const l of e){const e=i(l),o=c(l);for(const i of e){const e=Math.floor(Number((null===i||void 0===i?void 0:i.amount)||0))||0;var t;if(!(e<=0))if(o)a.totalSalon+=e,"cash"===i.methodKey?a.cashSalon+=e:"nequi"===i.methodKey?a.nequiTotal+=e:"daviplata"===i.methodKey&&(a.daviplataTotal+=e),a.totalLiquidado+=e;else if(a.totalDomicilios+=e,"cash"===i.methodKey)null!==l&&void 0!==l&&l.settled||null!==l&&void 0!==l&&null!==(t=l.paymentSettled)&&void 0!==t&&t.cash?(a.cashClientesSettled+=e,a.totalLiquidado+=e):(a.cashClientesPendiente+=e,a.totalPendiente+=e);else if("nequi"===i.methodKey){var r;null!==l&&void 0!==l&&l.settled||null!==l&&void 0!==l&&null!==(r=l.paymentSettled)&&void 0!==r&&r.nequi?(a.nequiTotal+=e,a.totalLiquidado+=e):(a.nequiPendiente+=e,a.totalPendiente+=e)}else if("daviplata"===i.methodKey){var n;null!==l&&void 0!==l&&l.settled||null!==l&&void 0!==l&&null!==(n=l.paymentSettled)&&void 0!==n&&n.daviplata?(a.daviplataTotal+=e,a.totalLiquidado+=e):(a.daviplatasPendiente+=e,a.totalPendiente+=e)}}}};return r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]),r(e),r(t),a.cashCaja=a.cashSalon+a.cashClientesSettled,a}},5353:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var r=a(5043),n=a(1958),l=a(5472),i=a(9223),o=a.n(i);const s=async(e,t,a,r,n)=>{try{var l,i,s,d;const c=new(o().Workbook),m=c.addWorksheet("Gesti\xf3n de Pedidos"),u=e=>null==e||void 0===e?"":"string"===typeof e?e.replace(" NUEVO","").trim():"boolean"===typeof e?e.toString():"object"===typeof e&&null!==e&&"name"in e&&"string"===typeof e.name?e.name.replace(" NUEVO","").trim():String(e).replace(" NUEVO","").trim(),p=e=>{e.border={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}};m.addRow(["","PROTE\xcdNAS DEL D\xcdA"]);const g=m.lastRow.number;m.mergeCells(g,2,g,3);const h=m.getCell(`B${g}`);h.font={bold:!0,color:{argb:"FFFFFFFF"}},h.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF0066CC"}},h.alignment={horizontal:"center"},m.getRow(g+1).values=["","Prote\xedna","Unidades","",""];m.getRow(g+1).eachCell((e,t)=>{2!==t&&3!==t||(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF28A745"}},e.font={color:{argb:"FFFFFFFF"},bold:!0},e.alignment={horizontal:"center"},p(e)),4!==t&&5!==t||(e.value="")});const x=0===n.length?[{name:"-",quantity:"-",extra:"",extraValue:""}]:[...n.slice(0,-2),{name:(null===(l=n[n.length-2])||void 0===l?void 0:l.name)||"-",quantity:(null===(i=n[n.length-2])||void 0===i?void 0:i.quantity)||"-",extra:"TOTAL PROTE\xcdNAS:",extraValue:r.toLocaleString("es-CO")},{name:(null===(s=n[n.length-1])||void 0===s?void 0:s.name)||"-",quantity:(null===(d=n[n.length-1])||void 0===d?void 0:d.quantity)||"-",extra:"Fecha actual:",extraValue:`${String((new Date).getDate()).padStart(2,"0")}/${String((new Date).getMonth()+1).padStart(2,"0")}/${(new Date).getFullYear()}`}];x.forEach((e,t)=>{m.addRow(["",u(e.name),e.quantity,e.extra,e.extraValue]).eachCell((e,a)=>{a>=2&&((t>=x.length-2||2===a||3===a)&&p(e),3===a&&(e.numFmt="#,##0",e.alignment={horizontal:"right"}),4===a&&(e.alignment={horizontal:"left"}),5===a&&(e.alignment={horizontal:"right"}))})}),m.addRow({}),m.addRow({});let y=0;const b=e.map((e,t)=>{var a,r,n,l;y+=1;const i=(null===(a=e.meals)||void 0===a?void 0:a[0])||{},o=e.payment||"object"===typeof i.payment&&(null===(r=i.payment)||void 0===r?void 0:r.name)||i.payment||"Efectivo";return o&&("object"!==typeof o||"name"in o)||console.warn(`Invalid payment data in order ${e.id||t}:`,{order:e,paymentValue:o}),{N:y,"Direcci\xf3n":u(null===(n=i.address)||void 0===n?void 0:n.address),"Tel\xe9fono":u(null===(l=i.address)||void 0===l?void 0:l.phoneNumber),Total:e.total||0,"M\xe9todoDePago":u(o),Domiciliario:u(e.deliveryPerson||"Sin asignar")}});0===b.length&&b.push({N:"-","Direcci\xf3n":"-","Tel\xe9fono":"-",Total:"-","M\xe9todoDePago":"-",Domiciliario:"-"}),m.columns=[{key:"N",width:10},{key:"Direcci\xf3n",width:30},{key:"Tel\xe9fono",width:15},{key:"Total",width:15},{key:"M\xe9todoDePago",width:15},{key:"Domiciliario",width:25}];const v=x.length+4,f=m.getRow(v);f.values=["N","Direcci\xf3n","Tel\xe9fono","Total","M\xe9todo de Pago","Domiciliario"],f.eachCell(e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF0066CC"}},e.font={color:{argb:"FFFFFFFF"},bold:!0},e.alignment={horizontal:"center"},p(e)}),b.forEach(e=>{m.addRow(e).eachCell(e=>p(e))}),m.addRow({}),m.addRow({}),m.addRow([]);const j=m.lastRow.number;m.getCell(`C${j}`).value="Resumen de Totales",m.mergeCells(`C${j}:D${j}`);const N=m.getCell(`C${j}`);N.font={bold:!0,color:{argb:"FFFFFFFF"}},N.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF0066CC"}},N.alignment={horizontal:"center"},p(N),p(m.getCell(`D${j}`));[["Total Efectivo",t.cash||0],["Total Daviplata",t.daviplata||0],["Total Nequi",t.nequi||0],["Total General",(t.cash||0)+(t.daviplata||0)+(t.nequi||0)]].forEach(e=>{let[t,a]=e;const r=m.addRow(["","",t,a]);r.getCell(3).alignment={horizontal:"left"},r.getCell(4).alignment={horizontal:"right"},r.getCell(4).numFmt="$#,##0",r.getCell(4).font={bold:!0},p(r.getCell(3)),p(r.getCell(4))}),m.addRow({}),m.addRow({}),m.addRow(["","Resumen por Domiciliarios"]);const w=m.lastRow.number;m.mergeCells(w,2,w,6);const k=m.getCell(`B${w}`);k.font={bold:!0,color:{argb:"FFFFFFFF"}},k.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF0066CC"}},k.alignment={horizontal:"center"};for(let e=2;e<=6;e++)p(m.getCell(w,e));m.addRow(["","Domiciliario","Efectivo","Daviplata","Nequi","Total"]);m.lastRow.eachCell((e,t)=>{t>=2&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF28A745"}},e.font={color:{argb:"FFFFFFFF"},bold:!0},e.alignment={horizontal:"center"},p(e))}),Object.entries(a).forEach(e=>{let[t,a]=e;m.addRow(["",u(t),a.cash||0,a.daviplata||0,a.nequi||0,a.total||0]).eachCell((e,t)=>{t>=2&&(t>=3&&(e.numFmt="$#,##0",e.alignment={horizontal:"right"}),p(e))})});const C=await c.xlsx.writeBuffer(),S=new Blob([C],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),P=document.createElement("a");P.href=window.URL.createObjectURL(S),P.download=`pedidos_${(new Date).toISOString().slice(0,10)}.xlsx`,document.body.appendChild(P),P.click(),document.body.removeChild(P)}catch(c){console.error("Error al exportar Excel:",c),alert("Error al generar el archivo Excel: "+c.message)}};var d=a(7762),c=a(557),m=a.n(c);const u=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{var r,n,l;const o=new d.default,s="/logo.png";try{o.addImage(s,"PNG",160,10,30,20)}catch(i){console.warn("No se pudo cargar el logo para el PDF:",i)}o.setFontSize(16),o.text("Gesti\xf3n de Pedidos",14,20),o.setFontSize(12);const c=new Date,u=c.toLocaleDateString("es-CO"),p=c.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!0});o.text(`Fecha: ${u} ${p}`,14,30);let g=0;const h=e.map(e=>{var t,a,r,n,l,i;g+=1;const o=(null===(t=e.meals)||void 0===t?void 0:t[0])||{},s=(null===(a=e.payment)||void 0===a?void 0:a.name)||e.payment||(null===(r=o.payment)||void 0===r?void 0:r.name)||o.payment||"Efectivo";return[g,(null===(n=o.address)||void 0===n?void 0:n.address)||"",(null===(l=o.address)||void 0===l?void 0:l.phoneNumber)||"",`$${(null===(i=e.total)||void 0===i?void 0:i.toLocaleString("es-CO"))||"0"}`,s,(null===e||void 0===e?void 0:e.deliveryPerson)||""]});0===h.length&&h.push(Array(6).fill("-")),0===h.length&&h.push(Array(5).fill("-")),m()(o,{startY:40,head:[["N","Direcci\xf3n","Tel\xe9fono","Total","Domiciliario"]],body:h,styles:{fontSize:8,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[0,102,204],textColor:255,fontStyle:"bold",lineWidth:.2,lineColor:[0,0,0]},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{1:{cellWidth:"wrap"},3:{halign:"right"}},tableLineColor:[0,0,0],tableLineWidth:.2,didDrawPage:e=>{o.setFontSize(10),o.text(`P\xe1gina ${e.pageNumber}`,180,287)}});const x=o.lastAutoTable.finalY+10;o.setFontSize(14),o.text("Resumen de Totales",14,x),m()(o,{startY:x+5,head:[["Concepto","Monto"]],body:[["Total Efectivo",`$${(null===(r=t.cash)||void 0===r?void 0:r.toLocaleString("es-CO"))||"0"}`],["Total Daviplata",`$${(null===(n=t.daviplata)||void 0===n?void 0:n.toLocaleString("es-CO"))||"0"}`],["Total Nequi",`$${(null===(l=t.nequi)||void 0===l?void 0:l.toLocaleString("es-CO"))||"0"}`],["Total General",`$${(t.cash+t.daviplata+t.nequi||0).toLocaleString("es-CO")}`]],styles:{fontSize:10,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[0,102,204],textColor:255,fontStyle:"bold",lineWidth:.2,lineColor:[0,0,0]},columnStyles:{1:{halign:"right"}},tableLineColor:[0,0,0],tableLineWidth:.2});const y=o.lastAutoTable.finalY+10;o.setFontSize(14),o.text("Resumen por Domiciliarios",14,y);const b=Object.entries(a).map(e=>{var t,a,r,n;let[l,i]=e;return[l||"",`$${(null===(t=i.cash)||void 0===t?void 0:t.toLocaleString("es-CO"))||"0"}`,`$${(null===(a=i.daviplata)||void 0===a?void 0:a.toLocaleString("es-CO"))||"0"}`,`$${(null===(r=i.nequi)||void 0===r?void 0:r.toLocaleString("es-CO"))||"0"}`,`$${(null===(n=i.total)||void 0===n?void 0:n.toLocaleString("es-CO"))||"0"}`]});m()(o,{startY:y+5,head:[["Domiciliario","Efectivo","Daviplata","Nequi","Total"]],body:b.length>0?b:[["-","-","-","-","-"]],styles:{fontSize:8,cellPadding:2,overflow:"linebreak"},headStyles:{fillColor:[0,102,204],textColor:255,fontStyle:"bold",lineWidth:.2,lineColor:[0,0,0]},columnStyles:{1:{halign:"right"},2:{halign:"right"},3:{halign:"right"},4:{halign:"right"}},tableLineColor:[0,0,0],tableLineWidth:.2}),o.save(`pedidos_${(new Date).toISOString().split("T")[0]}.pdf`)}catch(o){console.error("Error al generar el PDF:",o),alert("Error al generar el PDF: "+o.message)}},p=(e,t,a,r)=>{const n=e.flatMap(e=>e.meals.map((t,a)=>{var r,n,l,i,o,s,d,c,m,u,p,g,h,x,y,b;return[e.id,a+1,(null===(r=t.soup)||void 0===r?void 0:r.name)||t.soup||"Sin sopa",Array.isArray(t.principle)?t.principle.map(e=>e.name||e).join(", "):(null===(n=t.principle)||void 0===n?void 0:n.name)||t.principle||"Sin principio",(null===(l=t.protein)||void 0===l?void 0:l.name)||t.protein||"Sin prote\xedna",(null===(i=t.drink)||void 0===i?void 0:i.name)||t.drink||"Sin bebida",(null===(o=t.cutlery)||void 0===o?void 0:o.name)||t.cutlery||"No",(null===(s=t.sides)||void 0===s?void 0:s.map(e=>e.name||e).join(", "))||"Ninguno",(null===(d=t.additions)||void 0===d?void 0:d.map(e=>`${e.name||""}${e.protein||e.replacement?` (${e.protein||e.replacement})`:""} (${e.quantity||1})`).join(", "))||"Ninguna",t.notes||"Ninguna",(null===(c=t.time)||void 0===c?void 0:c.name)||t.time||"No especificada",(null===(m=t.address)||void 0===m?void 0:m.address)||"Sin direcci\xf3n",(null===(u=t.address)||void 0===u?void 0:u.addressType)||"No especificado",(null===(p=t.address)||void 0===p?void 0:p.localName)||"",(null===(g=t.address)||void 0===g?void 0:g.recipientName)||"",(null===(h=t.address)||void 0===h?void 0:h.unitDetails)||"",(null===(x=t.address)||void 0===x?void 0:x.phoneNumber)||"No especificado",(null===(y=t.payment)||void 0===y?void 0:y.name)||t.payment||"Efectivo",`$${(null===(b=e.total)||void 0===b?void 0:b.toLocaleString("es-CO"))||"0"}`,e.payment||"Efectivo",e.deliveryPerson||"Sin asignar",e.status||"Pendiente",e.createdAt?new Date(1e3*e.createdAt.seconds).toLocaleString("es-CO"):"N/A",e.updatedAt?new Date(1e3*e.updatedAt.seconds).toLocaleString("es-CO"):"N/A"].map(e=>`"${String(e||"").replace(/"/g,'""')}"`)})),l=[["Total Efectivo",`$${t.cash.toLocaleString("es-CO")}`],["Total Daviplata",`$${t.daviplata.toLocaleString("es-CO")}`],["Total Nequi",`$${t.nequi.toLocaleString("es-CO")}`],["Total General",`$${(t.cash+t.daviplata+t.nequi).toLocaleString("es-CO")}`]].map(e=>e.map(e=>`"${String(e||"").replace(/"/g,'""')}"`)),i=Object.entries(a).map(e=>{let[t,a]=e;return[t,`$${a.cash.toLocaleString("es-CO")}`,`$${a.daviplata.toLocaleString("es-CO")}`,`$${a.nequi.toLocaleString("es-CO")}`,`$${a.total.toLocaleString("es-CO")}`].map(e=>`"${String(e||"").replace(/"/g,'""')}"`)}),o=[["ID Pedido","N\xba Bandeja","Sopa","Principio","Prote\xedna","Bebida","Cubiertos","Acompa\xf1amientos","Adiciones","Notas","Hora de Entrega","Direcci\xf3n","Tipo de Lugar","Nombre del Local","Nombre del Destinatario","Detalles de Unidad","Tel\xe9fono","Pago (Bandeja)","Total (COP)","Pago (General)","Domiciliario","Estado","Fecha de Creaci\xf3n","\xdaltima Actualizaci\xf3n"].join(","),...n,"",'"Resumen de Totales"','"Concepto","Monto (COP)"',...l,'"Resumen por Domiciliarios"','"Domiciliario","Efectivo (COP)","Daviplata (COP)","Nequi (COP)","Total (COP)"',...i].join("\n"),s=new Blob([o],{type:"text/csv;charset=utf-8;"}),d=window.URL.createObjectURL(s),c=document.createElement("a");c.href=d,c.download=`pedidos_${(new Date).toISOString().split("T")[0]}.csv`,c.click(),window.URL.revokeObjectURL(d),r("Pedidos exportados a CSV.")},g=e=>null==e?"":"string"===typeof e?e.replace(" NUEVO","").trim():"boolean"===typeof e?e.toString():"object"===typeof e&&null!==e&&void 0!==e&&e.name?e.name.replace(" NUEVO","").trim():String(e).replace(" NUEVO","").trim(),h=e=>{if(null===e||void 0===e||!e.address)return"Sin direcci\xf3n";let t=e.address;switch(e.addressType){case"school":e.recipientName&&(t+=` (Recibe: ${g(e.recipientName)})`);break;case"complex":e.unitDetails&&(t+=` (${g(e.unitDetails)})`);break;case"shop":e.localName&&(t+=` (${g(e.localName)})`)}return t};var x=a(6568),y=a(2061),b=a(8662),v=a(2315),f=a(4791),j=a(1252),N=a(2811),w=a(9248),k=a(8224),C=a(6365),S=a(5172),P=a(5343),A=a(579);const E=e=>{const t=(("string"===typeof e?e:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.label)||(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.method)||(null===e||void 0===e?void 0:e.type)||"")||"").toString().trim().toLowerCase();return t.includes("efect")||t.includes("cash")?"cash":t.includes("nequi")?"nequi":t.includes("davi")?"daviplata":"other"},$=(e,t)=>{const a=Math.floor(Number((null===e||void 0===e?void 0:e.total)||0))||0;if(Array.isArray(null===e||void 0===e?void 0:e.payments)&&e.payments.length)return e.payments.map(e=>({methodKey:E(e.method),amount:Math.floor(Number(e.amount||0))||0}));const r="function"===typeof t&&t(e)||[];return r.length?r.map(e=>({methodKey:E(e.method),amount:Math.floor(Number(e.amount||0))||0})):[{methodKey:"other",amount:a}]},D=e=>`$${Math.floor(e||0).toLocaleString("es-CO")}`,O=e=>{let{theme:t,orders:a,searchTerm:i,setSearchTerm:o,totals:s,isLoading:d,paginatedOrders:c,currentPage:m,totalPages:u,setCurrentPage:p,itemsPerPage:y,setItemsPerPage:O,deliveryPersons:T,handleEditOrder:F,handleDeleteOrder:q,handleStatusChange:L,handleSort:M,getSortIcon:R,setShowMealDetails:z,editingDeliveryId:B,setEditingDeliveryId:I,editForm:G,setEditForm:V,handleDeliveryChange:_,sortOrder:K,showProteinModal:U,setShowProteinModal:H,isMenuOpen:W,setIsMenuOpen:J,handleOpenPreview:Z,handleOpenExcelPreview:Y,handleExport:Q,handleDeleteAllOrders:X,setShowConfirmDeleteAll:ee,exportToExcel:te,exportToPDF:ae,exportToCSV:re,setShowAddOrderModal:ne,orderTypeFilter:le,setOrderTypeFilter:ie,uniqueDeliveryPersons:oe}=e;const se=(new Date).toLocaleDateString("es-CO",{weekday:"long",month:"long",day:"numeric"}),de=(0,r.useRef)(null),[ce,me]=(0,r.useState)(""),ue=(0,r.useRef)("");(0,r.useEffect)(()=>{function e(e){de.current&&!de.current.contains(e.target)&&J(!1)}return W&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[W,J]);const[pe,ge]=(0,r.useState)(null),he=(0,r.useRef)(null),xe=(e,t)=>{ge({type:e,text:t}),he.current&&clearTimeout(he.current),he.current=setTimeout(()=>ge(null),2600)};(0,r.useEffect)(()=>()=>he.current&&clearTimeout(he.current),[]);const[ye,be]=(0,r.useState)(null),ve=["orders","deliveryOrders","tableOrders","deliveryBreakfastOrders","breakfastOrders","domicilioOrders"],fe=async e=>{const t=null===e||void 0===e?void 0:e.id;if(!t)throw new Error("Order sin id");const a=[];null!==e&&void 0!==e&&e.__collection&&a.push(e.__collection),null!==e&&void 0!==e&&e.collectionName&&(null===e||void 0===e?void 0:e.collectionName)!==(null===e||void 0===e?void 0:e.__collection)&&a.push(e.collectionName);const r=(e=>null!==e&&void 0!==e&&e.__collection?e.__collection:null!==e&&void 0!==e&&e.collectionName?e.collectionName:"breakfast"===(null===e||void 0===e?void 0:e.type)||Array.isArray(null===e||void 0===e?void 0:e.breakfasts)?"deliveryBreakfastOrders":"orders")(e),i=[r,...["orders","deliveryOrders","tableOrders","deliveryBreakfastOrders","breakfastOrders"].filter(e=>e!==r)],o=[...a.filter(Boolean),...i,...ve].filter((e,t,a)=>!!e&&a.indexOf(e)===t);for(const s of o){const e=(0,l.H9)(n.db,s,t);if((await(0,l.x7)(e)).exists())return e}return null},je=(0,r.useMemo)(()=>{const e={cash:0,nequi:0,daviplata:0,other:0,total:0};return(a||[]).forEach(t=>{if(t.payments&&Array.isArray(t.payments))t.payments.forEach(t=>{const a=E(t.method),r=Math.floor(Number(t.amount||0))||0;r<=0||(e[a]=(e[a]||0)+r,e.total+=r)});else{const a=E(t.payment||t.paymentMethod),r=Math.floor(Number(t.total||0))||0;if(r<=0)return;e[a]=(e[a]||0)+r,e.total+=r}}),e},[a]),Ne=(0,r.useMemo)(()=>function(e){let{fallbackBuilder:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={},r=(e,t)=>(a[e]=a[e]||{},a[e][t]=a[e][t]||{cash:0,nequi:0,daviplata:0,other:0,total:0},a[e][t]),n=(e,t,a)=>{a&&(e[t]=(e[t]||0)+a,e.total+=a)};return(e||[]).forEach(e=>{const a=String((null===e||void 0===e?void 0:e.deliveryPerson)||"JUAN").trim(),l=Array.isArray(null===e||void 0===e?void 0:e.breakfasts)||"breakfast"===(null===e||void 0===e?void 0:e.type)?"breakfast":"lunch",i=$(e,t),o=r(a,l),s=r(a,"total");i.forEach(e=>{let{methodKey:t,amount:a}=e;n(o,t,a),n(s,t,a)})}),a}(a||[],{fallbackBuilder:P._s,filter:e=>!e.settled}),[a]),we=(0,r.useMemo)(()=>Object.keys(Ne).sort((e,t)=>e.localeCompare(t,"es")),[Ne]);return(0,A.jsxs)(A.Fragment,{children:[pe&&(0,A.jsx)("div",{className:"fixed right-4 top-4 z-[10002]",children:(0,A.jsx)("div",{className:(0,x.x)("rounded-xl px-4 py-3 shadow-lg border","success"===pe.type&&"bg-green-600 text-white border-green-500","warning"===pe.type&&"bg-yellow-400 text-black border-yellow-300","error"===pe.type&&"bg-red-600 text-white border-red-500"),children:(0,A.jsx)("span",{className:"font-semibold",children:pe.text})})}),(0,A.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,A.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6",children:"Gesti\xf3n de Pedidos Domicilios"}),(0,A.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 text-sm text-gray-700 dark:text-gray-300",children:[(0,A.jsxs)("div",{className:(0,x.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===t?"bg-gray-700":"bg-gray-100"),children:[(0,A.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total Efectivo"}),(0,A.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor(je.cash||0).toLocaleString("es-CO")]})]}),(0,A.jsxs)("div",{className:(0,x.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===t?"bg-gray-700":"bg-gray-100"),children:[(0,A.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total Daviplata"}),(0,A.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor(je.daviplata||0).toLocaleString("es-CO")]})]}),(0,A.jsxs)("div",{className:(0,x.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===t?"bg-gray-700":"bg-gray-100"),children:[(0,A.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total Nequi"}),(0,A.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor(je.nequi||0).toLocaleString("es-CO")]})]}),(0,A.jsxs)("div",{className:(0,x.x)("p-3 sm:p-4 rounded-lg shadow-sm","dark"===t?"bg-gray-700":"bg-gray-100"),children:[(0,A.jsx)("p",{className:"font-semibold text-sm sm:text-base",children:"Total General"}),(0,A.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["$",Math.floor((je.cash||0)+(je.daviplata||0)+(je.nequi||0)).toLocaleString("es-CO")]})]})]}),(0,A.jsxs)("div",{className:"flex flex-wrap justify-center sm:justify-between items-center mb-6 gap-3 sm:gap-4",children:[(0,A.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"Buscar pedidos...",className:(0,x.x)("p-2 sm:p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:max-w-xs shadow-sm text-sm sm:text-base transition-all duration-200","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white text-gray-900")}),(0,A.jsxs)("div",{className:"flex flex-wrap items-center justify-center sm:justify-end gap-2",children:[(0,A.jsxs)("button",{onClick:()=>H(!0),className:(0,x.x)("flex items-center justify-center gap-2 px-3 py-2 sm:px-5 sm:py-3 rounded-lg text-xs sm:text-sm font-semibold transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-shrink-0","dark"===t?"bg-gray-600 hover:bg-gray-500 text-white border border-gray-500":"bg-gray-200 hover:bg-gray-300 text-gray-900 border border-gray-400"),children:[(0,A.jsx)(b.A,{className:"w-4 h-4"}),(0,A.jsx)("span",{className:"hidden md:inline",children:"Prote\xednas del D\xeda"})]}),(0,A.jsx)("div",{className:(0,x.x)("flex items-center justify-center gap-2 px-3 py-2 sm:px-5 sm:py-3 rounded-lg text-xs sm:text-sm font-semibold shadow-sm border transition-colors duration-200 flex-shrink-0","dark"===t?"bg-gray-700 text-white border-gray-500":"bg-gray-200 text-gray-900 border-gray-400"),children:se}),(0,A.jsxs)("div",{className:"relative flex-shrink-0",ref:de,children:[(0,A.jsx)("button",{onClick:()=>J(!W),className:(0,x.x)("flex items-center justify-center p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-blue-500"),"aria-label":"Opciones de men\xfa",children:(0,A.jsx)(v.A,{className:(0,x.x)("w-6 h-6","dark"===t?"text-gray-200 hover:text-white":"text-gray-700 hover:text-gray-900")})}),W&&(0,A.jsx)("div",{className:(0,x.x)("absolute right-0 mt-2 w-48 rounded-lg shadow-xl z-50","dark"===t?"bg-gray-700 text-gray-200":"bg-white text-gray-900"),children:(0,A.jsxs)("div",{className:"py-1",children:[(0,A.jsx)("button",{onClick:()=>{ie("breakfast"),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Ver Desayunos"}),(0,A.jsx)("button",{onClick:()=>{ie("lunch"),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Ver Almuerzos"}),(0,A.jsx)("button",{onClick:()=>{ie("all"),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Ver Todos"}),(0,A.jsx)("button",{onClick:()=>{ne(!0),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Generar Orden"}),(0,A.jsx)("button",{onClick:()=>{Z(),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Vista Previa PDF"}),(0,A.jsx)("button",{onClick:()=>{Y(),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200",children:"Vista Previa Excel"}),(0,A.jsxs)("button",{onClick:()=>{Q(te,"Excel"),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 flex items-center",children:[(0,A.jsx)(f.A,{className:"w-4 h-4 mr-2"})," Exportar Excel"]}),(0,A.jsxs)("button",{onClick:()=>{Q(ae,"PDF"),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 flex items-center",children:[(0,A.jsx)(f.A,{className:"w-4 h-4 mr-2"})," Exportar PDF"]}),(0,A.jsxs)("button",{onClick:()=>{Q(re,"CSV"),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 flex items-center",children:[(0,A.jsx)(f.A,{className:"w-4 h-4 mr-2"})," Exportar CSV"]}),(0,A.jsx)("button",{onClick:()=>{ee(!0),J(!1)},className:"block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 text-red-500",children:"Eliminar Todos"})]})})]})]})]}),(0,A.jsx)("div",{className:(0,x.x)("p-3 sm:p-4 rounded-2xl shadow-xl max-h-[70vh] overflow-y-auto custom-scrollbar transition-all duration-300","dark"===t?"bg-gray-800":"bg-white"),children:d?(0,A.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,A.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500"})}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{className:"overflow-x-auto",children:(0,A.jsxs)("table",{className:"min-w-full text-left border-collapse text-sm",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{className:(0,x.x)("font-semibold sticky top-0 z-10 shadow-sm","dark"===t?"bg-gray-700 text-gray-200":"bg-gray-100 text-gray-700"),children:[(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("orderNumber"),children:["N\xba ",R("orderNumber")]}),(0,A.jsx)("th",{className:"p-2 sm:p-3 border-b whitespace-nowrap",children:"Detalles"}),(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("address"),children:["Direcci\xf3n ",R("address")]}),(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("phone"),children:["Tel\xe9fono ",R("phone")]}),(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("time"),children:["Hora ",R("time")]}),(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("payment"),children:["Pago ",R("payment")]}),(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("total"),children:["Total ",R("total")]}),(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("deliveryPerson"),children:["Domiciliario ",R("deliveryPerson")]}),(0,A.jsxs)("th",{className:"p-2 sm:p-3 border-b cursor-pointer whitespace-nowrap",onClick:()=>M("status"),children:["Estado ",R("status")]}),(0,A.jsx)("th",{className:"p-2 sm:p-3 border-b whitespace-nowrap",children:"Acciones"})]})}),(0,A.jsx)("tbody",{children:0===c.length?(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:"10",className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"No se encontraron pedidos. Intenta ajustar tu b\xfasqueda o filtros."})}):c.map((e,a)=>{var r,n,l,i,o,s,d,u,p,b,v,f,k,C,S,E,D,O,T,M,R;const G="asc"===K?(m-1)*y+a+1:c.length-((m-1)*y+a),V=h((null===(r=e.meals)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.address)||(null===(l=e.breakfasts)||void 0===l||null===(i=l[0])||void 0===i?void 0:i.address)),U=(g(e.payment||(null===(o=e.meals)||void 0===o||null===(s=o[0])||void 0===s||null===(d=s.payment)||void 0===d?void 0:d.name)||(null===(u=e.breakfasts)||void 0===u||null===(p=u[0])||void 0===p||null===(b=p.payment)||void 0===b?void 0:b.name)||"Sin pago"),(e=>{var t,a,r,n,l,i,o,s,d,c;const m=$(e,P._s),u=[...new Set(m.map(e=>{return"cash"===(t=e.methodKey)?"Efectivo":"nequi"===t?"Nequi":"daviplata"===t?"Daviplata":"";var t}).filter(Boolean))];if(u.length)return u.join(" + ");const p=(null===e||void 0===e?void 0:e.payment)||(null===e||void 0===e?void 0:e.paymentMethod)||(null===e||void 0===e||null===(t=e.meals)||void 0===t||null===(a=t[0])||void 0===a||null===(r=a.payment)||void 0===r?void 0:r.name)||(null===e||void 0===e||null===(n=e.meals)||void 0===n||null===(l=n[0])||void 0===l?void 0:l.paymentMethod)||(null===e||void 0===e||null===(i=e.breakfasts)||void 0===i||null===(o=i[0])||void 0===o||null===(s=o.payment)||void 0===s?void 0:s.name)||(null===e||void 0===e||null===(d=e.breakfasts)||void 0===d||null===(c=d[0])||void 0===c?void 0:c.paymentMethod)||"";return String(p).trim()||"Sin pago"})(e)),H="Pendiente"===e.status?"bg-yellow-500 text-black":"Entregado"===e.status?"bg-green-500 text-white":"Cancelado"===e.status?"bg-red-500 text-white":"",W=(null===(v=e.meals)||void 0===v||null===(f=v[0])||void 0===f?void 0:f.time)||(null===(k=e.breakfasts)||void 0===k||null===(C=k[0])||void 0===C?void 0:C.time);let J="N/A";return"string"===typeof W?J=W:"object"===typeof W&&null!==W&&(J=W.name||"N/A"),(0,A.jsxs)("tr",{className:(0,x.x)("border-b transition-colors duration-150","dark"===t?"border-gray-700 hover:bg-gray-700":"border-gray-200 hover:bg-gray-50",a%2===0?"dark"===t?"bg-gray-750":"bg-gray-50":""),children:[(0,A.jsx)("td",{className:"p-2 sm:p-3 text-gray-300",children:G}),(0,A.jsx)("td",{className:"p-2 sm:p-3 text-gray-300",children:(0,A.jsxs)("button",{onClick:()=>z(e),className:"text-blue-400 hover:text-blue-300 text-xs sm:text-sm flex items-center",title:"Ver detalles de la bandeja",children:[(0,A.jsx)(j.A,{className:"w-4 h-4 mr-1"}),"Ver"]})}),(0,A.jsx)("td",{className:"p-2 sm:p-3 text-gray-300 max-w-[150px] sm:max-w-xs overflow-hidden text-ellipsis whitespace-nowrap",children:V}),(0,A.jsx)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:(null===(S=e.meals)||void 0===S||null===(E=S[0])||void 0===E||null===(D=E.address)||void 0===D?void 0:D.phoneNumber)||(null===(O=e.breakfasts)||void 0===O||null===(T=O[0])||void 0===T||null===(M=T.address)||void 0===M?void 0:M.phoneNumber)||"N/A"}),(0,A.jsx)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:J}),(0,A.jsx)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:U}),(0,A.jsxs)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:["$",(null===(R=e.total)||void 0===R?void 0:R.toLocaleString("es-CO"))||"0"]}),(0,A.jsx)("td",{className:"p-2 sm:p-3 text-gray-300 whitespace-nowrap",children:B===e.id?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("input",{list:`delivery-list-${e.id}`,value:ce,onChange:e=>me(e.target.value),onKeyDown:t=>{if("Enter"===t.key){const t=(ce||"").trim()||"Sin asignar";_(e.id,t),"Sin asignar"!==t&&(ue.current=t),I(null)}else"Escape"===t.key&&I(null)},onBlur:()=>{const t=(ce||"").trim()||"Sin asignar";_(e.id,t),"Sin asignar"!==t&&(ue.current=t),I(null)},placeholder:"Escribe y Enter\u2026",className:(0,x.x)("w-40 p-1 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),autoFocus:!0}),(0,A.jsxs)("datalist",{id:`delivery-list-${e.id}`,children:[(0,A.jsx)("option",{value:"Sin asignar"}),oe.map(e=>(0,A.jsx)("option",{value:e},e))]})]}):(0,A.jsx)("span",{onClick:()=>{const t=e.deliveryPerson||ue.current||"";me(t),I(e.id)},className:"cursor-pointer hover:text-blue-400",title:"Click para editar; Enter para guardar",children:e.deliveryPerson||"Sin asignar"})}),(0,A.jsx)("td",{className:"p-2 sm:p-3 whitespace-nowrap",children:(0,A.jsxs)("select",{value:e.status||"Pendiente",onChange:async t=>{const a=t.target.value;try{const t=L(e.id,a);t&&"function"===typeof t.then&&await t,xe("success","Estado actualizado correctamente.")}catch(r){console.error("[Estado] error al actualizar",r),xe("error","No se pudo actualizar el estado.")}},className:(0,x.x)("px-2 py-1 rounded-full text-xs font-semibold appearance-none cursor-pointer",H,"dark"===t?"bg-opacity-70":"bg-opacity-90","focus:outline-none focus:ring-2 focus:ring-blue-500"),children:[(0,A.jsx)("option",{value:"Pendiente",children:"Pendiente"}),(0,A.jsx)("option",{value:"En Preparaci\xf3n",children:"En Preparaci\xf3n"}),(0,A.jsx)("option",{value:"En Camino",children:"En Camino"}),(0,A.jsx)("option",{value:"Entregado",children:"Entregado"}),(0,A.jsx)("option",{value:"Cancelado",children:"Cancelado"})]})}),(0,A.jsx)("td",{className:"p-2 sm:p-3 whitespace-nowrap",children:(0,A.jsxs)("div",{className:"flex gap-2",children:[(0,A.jsx)("button",{onClick:()=>F(e),className:"text-blue-500 hover:text-blue-400 transition-colors duration-150 p-1 rounded-md",title:"Editar pedido","aria-label":`Editar pedido ${G}`,children:(0,A.jsx)(N.A,{className:"w-5 h-5"})}),(0,A.jsx)("button",{onClick:()=>be(e),className:"text-indigo-500 hover:text-indigo-400 transition-colors duration-150 p-1 rounded-md",title:"Editar pagos (split)","aria-label":`Editar pagos del pedido ${G}`,children:"\ud83d\udcb3"}),(0,A.jsx)("button",{onClick:()=>q(e.id),className:"text-red-500 hover:text-red-400 transition-colors duration-150 p-1 rounded-md",title:"Eliminar pedido","aria-label":`Eliminar pedido ${G}`,children:(0,A.jsx)(w.A,{className:"w-5 h-5"})})]})})]},e.id)})})]})}),(0,A.jsxs)("div",{className:"flex flex-wrap justify-between items-center mt-6 gap-3",children:[(0,A.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[(0,A.jsx)("span",{children:"Pedidos por p\xe1gina:"}),(0,A.jsxs)("select",{value:y,onChange:e=>{O(Number(e.target.value)),p(1)},className:(0,x.x)("p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-300 bg-white text-gray-900"),children:[(0,A.jsx)("option",{value:"10",children:"10"}),(0,A.jsx)("option",{value:"20",children:"20"}),(0,A.jsx)("option",{value:"30",children:"30"}),(0,A.jsx)("option",{value:"50",children:"50"})]})]}),(0,A.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[(0,A.jsx)("button",{onClick:()=>p(e=>Math.max(e-1,1)),disabled:1===m,className:(0,x.x)("p-2 rounded-md transition-colors duration-200",1===m?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"dark"===t?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-100 text-gray-700"),children:(0,A.jsx)(k.A,{className:"w-5 h-5"})}),(0,A.jsxs)("span",{children:["P\xe1gina ",m," de ",u]}),(0,A.jsx)("button",{onClick:()=>p(e=>Math.min(e+1,u)),disabled:m===u,className:(0,x.x)("p-2 rounded-md transition-colors duration-200",m===u?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"dark"===t?"hover:bg-gray-700 text-gray-200":"hover:bg-gray-100 text-gray-700"),children:(0,A.jsx)(C.A,{className:"w-5 h-5"})})]})]})]})}),(0,A.jsxs)("div",{className:"mt-8 space-y-6",children:[(0,A.jsx)("h2",{className:"text-xl sm:text-2xl font-bold",children:"Resumen por Domiciliarios"}),0===we.length?(0,A.jsx)("div",{className:(0,x.x)("rounded-2xl p-6 text-center","dark"===t?"bg-gray-800 text-gray-300":"bg-white text-gray-700"),children:"No hay datos para el resumen de domiciliarios."}):(0,A.jsx)("div",{className:"grid grid-cols-1 gap-6",children:we.map(e=>{const r=Ne[e]||{},n=r.lunch||{cash:0,nequi:0,daviplata:0,other:0,total:0},i=r.breakfast||{cash:0,nequi:0,daviplata:0,other:0,total:0},o=r.total||{cash:0,nequi:0,daviplata:0,other:0,total:0};return(0,A.jsxs)("div",{className:(0,x.x)("rounded-2xl p-4 sm:p-5 shadow-sm","dark"===t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"),children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,A.jsx)("h3",{className:"text-base sm:text-lg font-semibold",children:e}),(0,A.jsx)("button",{onClick:()=>(async e=>{try{const o=String(e||"").trim(),s=(a||[]).filter(e=>{const t=String((null===e||void 0===e?void 0:e.deliveryPerson)||"JUAN").trim();return!(null!==e&&void 0!==e&&e.settled)&&t===o});if(!s.length)return void xe("warning",`No hay pedidos pendientes para liquidar de ${o}.`);const d={cash:0,nequi:0,daviplata:0};s.forEach(e=>{(e.payments||[]).forEach(e=>{const t=E(e.method);t in d&&(d[t]+=Math.floor(Number(e.amount||0)))})});let c=0,m=0;for(const e of s){const a=await fe(e);if(a)try{var t,r,n;const i=e.payments||[],o=e=>i.some(t=>E(t.method)===e),s=o("nequi"),d=o("daviplata"),m=o("cash"),u={settledAt:(new Date).toISOString(),settled:!0};u.paymentSettled={...e.paymentSettled||{},nequi:!!s||(null===(t=e.paymentSettled)||void 0===t?void 0:t.nequi)||!1,daviplata:!!d||(null===(r=e.paymentSettled)||void 0===r?void 0:r.daviplata)||!1,cash:!!m||(null===(n=e.paymentSettled)||void 0===n?void 0:n.cash)||!1},await(0,l.mZ)(a,u),c++}catch(i){console.error("[Liquidar] updateDoc error",i),m++}else m++}0===m?xe("success",`Domiciliario liquidado: ${o} (${c} \xf3rdenes).`):xe("warning",`Liquidado con advertencias: ${o}. OK: ${c}, errores: ${m}.`)}catch(i){console.error("[Liquidar] error general",i),xe("error","Ocurri\xf3 un error al liquidar.")}})(e),className:"text-xs px-3 py-1.5 rounded-md bg-indigo-600 hover:bg-indigo-700 text-white",children:"Liquidar \u25b8"})]}),(0,A.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{className:"text-sm font-medium mb-2",children:"Almuerzo"}),(0,A.jsxs)("div",{className:(0,x.x)("rounded-lg p-3 sm:p-4 border","dark"===t?"bg-gray-800/60 border-gray-700":"bg-gray-50 border-gray-200"),children:[(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Efectivo"}),(0,A.jsx)("span",{className:"font-semibold",children:D(n.cash)})]}),(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Daviplata"}),(0,A.jsx)("span",{className:"font-semibold",children:D(n.daviplata)})]}),(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Nequi"}),(0,A.jsx)("span",{className:"font-semibold",children:D(n.nequi)})]}),n.other>0&&(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Otros"}),(0,A.jsx)("span",{className:"font-semibold",children:D(n.other)})]}),(0,A.jsx)("div",{className:"h-px my-2 bg-gray-200 dark:bg-gray-700"}),(0,A.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,A.jsx)("span",{className:"font-medium",children:"Total"}),(0,A.jsx)("span",{className:"font-bold",children:D(n.total)})]})]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{className:"text-sm font-medium mb-2",children:"Desayuno"}),(0,A.jsxs)("div",{className:(0,x.x)("rounded-lg p-3 sm:p-4 border","dark"===t?"bg-gray-800/60 border-gray-700":"bg-gray-50 border-gray-200"),children:[(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Efectivo"}),(0,A.jsx)("span",{className:"font-semibold",children:D(i.cash)})]}),(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Daviplata"}),(0,A.jsx)("span",{className:"font-semibold",children:D(i.daviplata)})]}),(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Nequi"}),(0,A.jsx)("span",{className:"font-semibold",children:D(i.nequi)})]}),i.other>0&&(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Otros"}),(0,A.jsx)("span",{className:"font-semibold",children:D(i.other)})]}),(0,A.jsx)("div",{className:"h-px my-2 bg-gray-200 dark:bg-gray-700"}),(0,A.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,A.jsx)("span",{className:"font-medium",children:"Total"}),(0,A.jsx)("span",{className:"font-bold",children:D(i.total)})]})]})]})]}),(0,A.jsxs)("div",{className:"mt-4",children:[(0,A.jsx)("div",{className:"text-sm font-medium mb-2",children:"Total general"}),(0,A.jsxs)("div",{className:(0,x.x)("rounded-lg p-3 sm:p-4 border","dark"===t?"bg-gray-800/60 border-gray-700":"bg-gray-50 border-gray-200"),children:[(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Efectivo"}),(0,A.jsx)("span",{className:"font-semibold",children:D(o.cash)})]}),(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Daviplata"}),(0,A.jsx)("span",{className:"font-semibold",children:D(o.daviplata)})]}),(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Nequi"}),(0,A.jsx)("span",{className:"font-semibold",children:D(o.nequi)})]}),o.other>0&&(0,A.jsxs)("div",{className:"flex justify-between text-sm my-0.5",children:[(0,A.jsx)("span",{children:"Otros"}),(0,A.jsx)("span",{className:"font-semibold",children:D(o.other)})]}),(0,A.jsx)("div",{className:"h-px my-2 bg-gray-200 dark:bg-gray-700"}),(0,A.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,A.jsx)("span",{className:"font-medium",children:"Total"}),(0,A.jsx)("span",{className:"font-bold",children:D(o.total)})]})]})]})]},e)})})]})]}),ye&&(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10001]",children:(0,A.jsxs)("div",{className:(0,x.x)("p-4 sm:p-6 rounded-lg max-w-xl w-full max-h-[80vh] overflow-y-auto","dark"===t?"bg-gray-800 text-gray-200":"bg-white text-gray-900"),children:[(0,A.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Editar pagos \u2014 Orden #",ye.id.slice(0,8)]}),(0,A.jsx)(S.A,{theme:t,total:ye.total||0,value:Array.isArray(ye.payments)&&ye.payments.length?ye.payments:(0,P._s)(ye),onChange:e=>{be(t=>({...t,payments:e}))}}),(0,A.jsxs)("div",{className:"mt-4 flex gap-2 justify-end",children:[(0,A.jsx)("button",{onClick:()=>be(null),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",children:"Cancelar"}),(0,A.jsx)("button",{onClick:async()=>{const e=await(async(e,t)=>{const a=(t||[]).reduce((e,t)=>e+(Math.floor(Number(t.amount||0))||0),0),r=Math.floor(Number(e.total||0))||0;if(a!==r)return xe("warning",`La suma de pagos (${a.toLocaleString("es-CO")}) no coincide con el total (${r.toLocaleString("es-CO")}).`),!1;const n=await fe(e);if(!n)return xe("error","No se pudo guardar los pagos: la orden no existe en una colecci\xf3n conocida."),!1;const i={payments:(t||[]).map(e=>{var t;return{method:"string"===typeof e.method?e.method:(null===e||void 0===e||null===(t=e.method)||void 0===t?void 0:t.name)||"",amount:Math.floor(Number(e.amount||0))||0,note:e.note||""}}),updatedAt:new Date};try{return await(0,l.mZ)(n,i),xe("success","Pagos actualizados correctamente."),!0}catch(o){console.error("[Pagos] updateDoc error",o);const e=(null===o||void 0===o?void 0:o.code)||"";return xe("error","permission-denied"===e?"Permisos insuficientes para guardar pagos.":"No se pudo guardar los pagos."),!1}})(ye,ye.payments||[]);e&&be(null)},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",children:"Guardar"})]})]})})]})};var T=a(7015),F=a(9795),q=a(7591),L=a(2781),M=a(2916),R=a(1173),z=a(4489);const B=e=>(e||"").replace(/\s*NUEVO\s*$/i,"").trim(),I=(e,t)=>{if(!t)return null;const a="string"===typeof t?t:null===t||void 0===t?void 0:t.name;return e.find(e=>B(e.name)===B(a))||null},G=function(){var e,t,a,r,n,l,i,o,s,d,c,m;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{address:null!==(e=null!==(t=u.address)&&void 0!==t?t:p.address)&&void 0!==e?e:"",phoneNumber:null!==(a=null!==(r=u.phoneNumber)&&void 0!==r?r:p.phoneNumber)&&void 0!==a?a:"",addressType:null!==(n=null!==(l=u.addressType)&&void 0!==l?l:p.addressType)&&void 0!==n?n:"",localName:null!==(i=null!==(o=u.localName)&&void 0!==o?o:p.localName)&&void 0!==i?i:"",unitDetails:null!==(s=null!==(d=u.unitDetails)&&void 0!==d?d:p.unitDetails)&&void 0!==s?s:"",recipientName:null!==(c=null!==(m=u.recipientName)&&void 0!==m?m:p.recipientName)&&void 0!==c?c:""}},V=e=>{let{theme:t,showProteinModal:a,setShowProteinModal:i,newProtein:o,setNewProtein:s,handleAddProtein:d,proteins:c,totalProteinUnits:m,isLoading:u,showMealDetails:p,setShowMealDetails:g,editingOrder:h,setEditingOrder:b,editForm:v,handleMealFormFieldChange:f,handleEditFormFieldChange:j,handleSaveEdit:k,showConfirmDeleteAll:C,setShowConfirmDeleteAll:S,confirmText:P,setConfirmText:E,handleDeleteAllOrders:$,setError:D,setSuccess:O,showAddOrderModal:B,setShowAddOrderModal:V,newOrderForm:_,handleNewOrderMealFormFieldChange:K,handleNewOrderFieldChange:U,handleAddOrderSubmit:H,uniqueDeliveryPersons:W}=e;const[J,Z]=(0,r.useState)([]),[Y,Q]=(0,r.useState)([]),[X,ee]=(0,r.useState)([]),[te,ae]=(0,r.useState)([]),[re,ne]=(0,r.useState)([]),[le,ie]=(0,r.useState)([]),[oe,se]=(0,r.useState)([]),[de,ce]=(0,r.useState)([]),[me,ue]=(0,r.useState)([]),[pe,ge]=(0,r.useState)([]),[he,xe]=(0,r.useState)([]),[ye,be]=(0,r.useState)([]),[ve,fe]=(0,r.useState)([]),[je,Ne]=(0,r.useState)([]),[we,ke]=(0,r.useState)([]),[Ce,Se]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e={soups:Z,soupReplacements:Q,principles:ee,proteins:ae,drinks:ne,sides:ie,additions:se,paymentMethods:ce,breakfastEggs:ue,breakfastBroths:ge,breakfastRiceBread:xe,breakfastDrinks:be,breakfastAdditions:fe,breakfastTypes:Ne,breakfastProteins:ke},t=t=>(0,l.aQ)((0,l.rJ)(n.db,t),a=>e[t](a.docs.map(e=>({id:e.id,...e.data()})))),a=[t("soups"),t("soupReplacements"),t("principles"),t("proteins"),t("drinks"),t("sides"),t("additions"),t("paymentMethods"),t("breakfastEggs"),t("breakfastBroths"),t("breakfastRiceBread"),t("breakfastDrinks"),t("breakfastAdditions"),t("breakfastTypes"),t("breakfastProteins")];return()=>a.forEach(e=>e&&e())},[]);const Pe=(e,t,a)=>{const r=Array.isArray(v.breakfasts)?[...v.breakfasts]:[];if(r[e]||(r[e]={}),t.includes(".")){const[n,l]=t.split(".");r[e]={...r[e],[n]:{...r[e][n]||{},[l]:a}}}else r[e]={...r[e],[t]:a};j("breakfasts",r)},Ae=(e,t,a)=>{Pe(e,t,a)},Ee=r.useRef(null);(0,r.useEffect)(()=>{h||(Ee.current=null)},[h]),(0,r.useEffect)(()=>{if(!h)return;if(!(J.length||X.length||te.length||re.length||le.length||oe.length||je.length||pe.length||me.length||he.length||ye.length||ve.length||we.length))return;if(Ee.current===h.id)return;const e=h.address||{},t="number"===typeof h.total?h.total:"breakfast"===h.type?h.total||0:Array.isArray(h.meals)?Number((0,y.N9)(h.meals)||0):0;if(j("total",t),j("payment",h.payment||""),j("status",h.status||"Pendiente"),j("deliveryPerson",h.deliveryPerson||""),"breakfast"===h.type){const t=(h.breakfasts||[]).map(t=>{var a;return{type:I(je,t.type),broth:I(pe,t.broth),eggs:I(me,t.eggs),riceBread:I(he,t.riceBread),drink:I(ye,t.drink),protein:I(we,t.protein),additions:Array.isArray(t.additions)?t.additions.map(e=>{const t=I(ve,e);return t?{...t,quantity:e.quantity||1}:null}).filter(Boolean):[],cutlery:!!t.cutlery,time:"string"===typeof t.time?t.time:(null===(a=t.time)||void 0===a?void 0:a.name)||"",address:G(t.address,e),notes:t.notes||""}});j("breakfasts",t)}else{const t=(h.meals||[]).map(t=>{var a,r,n,l,i;return{soup:I(J,t.soup),soupReplacement:"string"===typeof t.soupReplacement?t.soupReplacement:(null===(a=t.soupReplacement)||void 0===a?void 0:a.replacement)||"",principle:Array.isArray(t.principle)?t.principle.map(e=>I(X,e)).filter(Boolean):[],principleReplacement:"string"===typeof t.principleReplacement?t.principleReplacement:(null===(r=t.principleReplacement)||void 0===r?void 0:r.replacement)||"",protein:I(te,t.protein),drink:I(re,t.drink),sides:(l=le,i=t.sides,Array.isArray(i)?i.map(e=>I(l,e)).filter(Boolean):[]),additions:Array.isArray(t.additions)?t.additions.map(e=>{var t,a;const r=I(oe,e);return r?{...r,quantity:e.quantity||1,price:null!==(t=null!==(a=e.price)&&void 0!==a?a:r.price)&&void 0!==t?t:0}:null}).filter(Boolean):[],cutlery:!!t.cutlery,time:"string"===typeof t.time?t.time:(null===(n=t.time)||void 0===n?void 0:n.name)||"",address:G(t.address,e),notes:t.notes||""}});j("meals",t)}Ee.current=h.id},[h,J,X,te,re,le,oe,je,pe,me,he,ye,ve,we,j]),(0,r.useEffect)(()=>{if(!h||"breakfast"===h.type)return;const e=Number((0,y.N9)(v.meals||[]))||0;e!==(v.total||0)&&j("total",e)},[h,v.meals,j,y.N9]);const $e=Array.isArray(null===p||void 0===p?void 0:p.meals)?p.meals:Array.isArray(null===p||void 0===p?void 0:p.breakfasts)?p.breakfasts:[];(0,r.useEffect)(()=>{if(!h||"breakfast"!==h.type)return;const e=(v.breakfasts||[]).reduce((e,t)=>e+Number((0,z.x8)(t,3,je)||0),0);e!==(v.total||0)&&j("total",e)},[h,v.breakfasts,je,j]);return(0,A.jsxs)("div",{children:[(0,A.jsx)(T.e,{show:a,as:r.Fragment,children:(0,A.jsxs)(F.lG,{as:"div",className:"relative z-50",onClose:()=>{i(!1),Se(null)},children:[(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50"})}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,A.jsxs)(F.lG.Panel,{className:(0,x.x)("w-full max-w-md p-6 rounded-lg shadow-md","dark"===t?"bg-gray-800 text-gray-200":"bg-gray-50 text-gray-900"),children:[(0,A.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,A.jsx)(F.lG.Title,{className:"text-lg font-medium",children:Ce?"Editar Prote\xedna":"Gestionar Prote\xednas"}),(0,A.jsx)("button",{onClick:()=>{i(!1),Se(null)},className:"text-gray-500 hover:text-gray-400","aria-label":"Cerrar modal",children:(0,A.jsx)(q.A,{className:"w-5 h-5"})})]}),(0,A.jsx)("div",{className:"space-y-4",children:Ce?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nombre"}),(0,A.jsx)("input",{type:"text",value:Ce.name,onChange:e=>Se({...Ce,name:e.target.value}),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),placeholder:"Ej: Pollo"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cantidad"}),(0,A.jsx)("input",{type:"number",value:Ce.quantity,onChange:e=>Se({...Ce,quantity:e.target.value}),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),placeholder:"Ej: 50",min:"0"})]}),(0,A.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,A.jsx)("button",{onClick:()=>{Se(null)},className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium","dark"===t?"bg-gray-600 hover:bg-gray-700 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-900"),children:"Cancelar"}),(0,A.jsx)("button",{onClick:async()=>{if(!Ce.name||!Ce.quantity||isNaN(Ce.quantity)||Number(Ce.quantity)<=0)D("Por favor, ingrese un nombre de prote\xedna v\xe1lido y una cantidad mayor a 0.");else try{await(0,l.mZ)((0,l.H9)(n.db,"dailyProteins",Ce.id),{name:Ce.name.trim(),quantity:Number(Ce.quantity)}),O("Prote\xedna actualizada correctamente."),Se(null)}catch(e){D(`Error al actualizar prote\xedna: ${e.message}`)}},disabled:u,className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium",u?"bg-gray-400 cursor-not-allowed":"dark"===t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:u?"Guardando...":"Actualizar"})]})]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nombre"}),(0,A.jsx)("input",{type:"text",value:o.name,onChange:e=>s({...o,name:e.target.value}),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),placeholder:"Ej: Pollo"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cantidad"}),(0,A.jsx)("input",{type:"number",value:o.quantity,onChange:e=>s({...o,quantity:e.target.value}),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),placeholder:"Ej: 50",min:"0"})]}),(0,A.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,A.jsx)("button",{onClick:()=>i(!1),className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium","dark"===t?"bg-gray-600 hover:bg-gray-700 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-900"),children:"Cancelar"}),(0,A.jsx)("button",{onClick:d,disabled:u,className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium",u?"bg-gray-400 cursor-not-allowed":"dark"===t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:u?"Guardando...":"Agregar"})]})]})}),(0,A.jsxs)("div",{className:"mt-6",children:[(0,A.jsxs)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Prote\xednas Registradas (Total: ",m," unidades)"]}),0===c.length?(0,A.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No hay prote\xednas registradas."}):(0,A.jsx)("ul",{className:"space-y-2",children:c.map(e=>(0,A.jsxs)("li",{className:(0,x.x)("flex justify-between items-center p-2 rounded-md","dark"===t?"bg-gray-700":"bg-gray-100"),children:[(0,A.jsxs)("span",{className:"text-sm",children:[e.name,": ",e.quantity," unidades"]}),(0,A.jsxs)("div",{className:"flex gap-2",children:[(0,A.jsx)("button",{onClick:()=>(e=>{Se(e)})(e),className:"text-blue-500 hover:text-blue-400 transition-colors duration-150 p-1 rounded-md",title:"Editar prote\xedna","aria-label":`Editar ${e.name}`,children:(0,A.jsx)(N.A,{className:"w-4 h-4"})}),(0,A.jsx)("button",{onClick:()=>(async e=>{try{await(0,l.kd)((0,l.H9)(n.db,"dailyProteins",e)),O("Prote\xedna eliminada correctamente.")}catch(t){D(`Error al eliminar prote\xedna: ${t.message}`)}})(e.id),className:"text-red-500 hover:text-red-400 transition-colors duration-150 p-1 rounded-md",title:"Eliminar prote\xedna","aria-label":`Eliminar ${e.name}`,children:(0,A.jsx)(w.A,{className:"w-4 h-4"})})]})]},e.id))})]})]})})})]})}),(0,A.jsx)(T.e,{show:null!==p,as:r.Fragment,children:(0,A.jsxs)(F.lG,{as:"div",className:"relative z-50",onClose:()=>g(null),children:[(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50"})}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,A.jsxs)(F.lG.Panel,{className:(0,x.x)("w-full max-w-2xl p-6 rounded-lg shadow-xl max-h-[80vh] overflow-y-auto","dark"===t?"bg-gray-800 text-gray-200":"bg-gray-50 text-gray-900"),children:[(0,A.jsxs)(F.lG.Title,{className:"text-lg font-medium mb-4 flex justify-between items-center",children:["Detalles del Pedido",(0,A.jsx)("button",{onClick:()=>g(null),className:"text-gray-500 hover:text-gray-400","aria-label":"Cerrar detalles",children:(0,A.jsx)(q.A,{className:"w-5 h-5"})})]}),p&&(0,A.jsxs)(A.Fragment,{children:["breakfast"===(null===p||void 0===p?void 0:p.type)?(0,A.jsx)(M.A,{items:p.breakfasts||$e,user:{role:3},statusClass:"bg-white",showSaveButton:!1}):(0,A.jsx)(L.A,{meals:$e,isTableOrder:!1,isWaiterView:!0,statusClass:"bg-white"}),(0,A.jsxs)("div",{className:"mt-3 text-xs sm:text-sm",children:[(0,A.jsxs)("p",{className:"font-medium",children:["Estado: ",p.status||"Pendiente"]}),(0,A.jsxs)("p",{className:"font-medium",children:["Domiciliario: ",p.deliveryPerson||"Sin asignar"]}),"breakfast"===(null===p||void 0===p?void 0:p.type)?(0,A.jsxs)("p",{className:"font-medium",children:["Total del pedido: $",(p.breakfasts||[]).reduce((e,t)=>e+Number((0,z.x8)(t,3,je)||0),0).toLocaleString("es-CO")]}):"number"===typeof p.total&&(0,A.jsxs)("p",{className:"font-medium",children:["Total del pedido: $",(Array.isArray(null===p||void 0===p?void 0:p.meals)?Number((0,y.N9)(p.meals)||0):Number((null===p||void 0===p?void 0:p.total)||0)).toLocaleString("es-CO")]})]})]})]})})})]})}),(0,A.jsx)(T.e,{show:null!==h,as:r.Fragment,children:(0,A.jsxs)(F.lG,{as:"div",className:"relative z-50",onClose:()=>b(null),children:[(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50"})}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,A.jsxs)(F.lG.Panel,{className:(0,x.x)("w-full max-w-2xl p-6 rounded-lg shadow-xl max-h-[80vh] overflow-y-auto","dark"===t?"bg-gray-800 text-gray-200":"bg-gray-50 text-gray-900"),children:[(0,A.jsxs)(F.lG.Title,{className:"text-lg font-medium mb-4 flex justify-between items-center",children:["Editar Pedido",(0,A.jsx)("button",{onClick:()=>b(null),className:"text-gray-500 hover:text-gray-400","aria-label":"Cerrar edici\xf3n",children:(0,A.jsx)(q.A,{className:"w-5 h-5"})})]}),("breakfast"===(null===h||void 0===h?void 0:h.type)?v.breakfasts||[]:v.meals||[]).map((e,a)=>{var r,n,l,i,o,s,d,c,m,u,p,g,y,b,v,j,N,w,k,C;return(0,A.jsxs)("div",{className:"mb-6 p-4 border rounded-md border-gray-200 dark:border-gray-600",children:[(0,A.jsx)("h3",{className:"font-medium mb-2",children:"breakfast"===(null===h||void 0===h?void 0:h.type)?`Desayuno ${a+1}`:`Bandeja ${a+1}`}),"breakfast"===(null===h||void 0===h?void 0:h.type)?(0,A.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tipo"}),(0,A.jsx)(R.A,{title:"Tipo",emoji:"\ud83e\udd5e",options:je,selected:e.type||null,multiple:!1,onImmediateSelect:e=>Ae(a,"type",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Caldo"}),(0,A.jsx)(R.A,{title:"Caldo",emoji:"\ud83e\udd63",options:pe,selected:e.broth||null,multiple:!1,onImmediateSelect:e=>Ae(a,"broth",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Huevos"}),(0,A.jsx)(R.A,{title:"Huevos",emoji:"\ud83e\udd5a",options:me,selected:e.eggs||null,multiple:!1,onImmediateSelect:e=>Ae(a,"eggs",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Arroz/Pan"}),(0,A.jsx)(R.A,{title:"Arroz/Pan",emoji:"\ud83c\udf5e",options:he,selected:e.riceBread||null,multiple:!1,onImmediateSelect:e=>Ae(a,"riceBread",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Bebida"}),(0,A.jsx)(R.A,{title:"Bebida",emoji:"\ud83e\udd64",options:ye,selected:e.drink||null,multiple:!1,onImmediateSelect:e=>Ae(a,"drink",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prote\xedna"}),(0,A.jsx)(R.A,{title:"Prote\xedna",emoji:"\ud83c\udf56",options:we,selected:e.protein||null,multiple:!1,onImmediateSelect:e=>Ae(a,"protein",e)})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Adiciones"}),(0,A.jsx)(R.A,{title:"Adiciones",emoji:"\u2795",options:ve,selected:e.additions||[],multiple:!0,onImmediateSelect:e=>Ae(a,"additions",e.map(e=>({name:e.name,quantity:e.quantity||1})))})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Cubiertos"}),(0,A.jsx)("input",{type:"checkbox",checked:!!e.cutlery,onChange:e=>Pe(a,"cutlery",e.target.checked),className:"h-4 w-4"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Hora de Entrega"}),(0,A.jsx)("input",{type:"text",value:"string"===typeof e.time?e.time:(null===(r=e.time)||void 0===r?void 0:r.name)||"",onChange:e=>Pe(a,"time",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Direcci\xf3n"}),(0,A.jsx)("input",{type:"text",value:(null===(n=e.address)||void 0===n?void 0:n.address)||"",onChange:e=>Pe(a,"address.address",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tel\xe9fono"}),(0,A.jsx)("input",{type:"text",value:(null===(l=e.address)||void 0===l?void 0:l.phoneNumber)||"",onChange:e=>Pe(a,"address.phoneNumber",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tipo de Direcci\xf3n"}),(0,A.jsxs)("select",{value:(null===(i=e.address)||void 0===i?void 0:i.addressType)||"",onChange:e=>Pe(a,"address.addressType",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,A.jsx)("option",{value:"",children:"Seleccione"}),(0,A.jsx)("option",{value:"house",children:"Casa/Apto"}),(0,A.jsx)("option",{value:"school",children:"Colegio/Oficina"}),(0,A.jsx)("option",{value:"complex",children:"Conjunto"}),(0,A.jsx)("option",{value:"shop",children:"Tienda/Local"})]})]}),"shop"===(null===(o=e.address)||void 0===o?void 0:o.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del Local"}),(0,A.jsx)("input",{type:"text",value:(null===(s=e.address)||void 0===s?void 0:s.localName)||"",onChange:e=>Pe(a,"address.localName",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),"school"===(null===(d=e.address)||void 0===d?void 0:d.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del destinatario"}),(0,A.jsx)("input",{type:"text",value:(null===(c=e.address)||void 0===c?void 0:c.recipientName)||"",onChange:e=>Pe(a,"address.recipientName",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),"complex"===(null===(m=e.address)||void 0===m?void 0:m.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Detalles (Torre/Apto)"}),(0,A.jsx)("input",{type:"text",value:(null===(u=e.address)||void 0===u?void 0:u.unitDetails)||"",onChange:e=>Pe(a,"address.unitDetails",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Notas"}),(0,A.jsx)("input",{type:"text",value:e.notes||"",onChange:e=>Pe(a,"notes",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]})]}):(0,A.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Sopa o reemplazo"}),(0,A.jsx)(R.A,{title:"Sopa",emoji:"\ud83e\udd63",options:J,selected:e.soup||null,multiple:!1,onImmediateSelect:e=>f(a,"soup",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Principio"}),(0,A.jsx)(R.A,{title:"Principio",emoji:"\ud83c\udf5a",options:X,selected:e.principle||[],multiple:!0,showConfirmButton:!0,onImmediateSelect:e=>f(a,"principle",e),onConfirm:e=>{let{selection:t}=e;return f(a,"principle",t)}})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prote\xedna"}),(0,A.jsx)(R.A,{title:"Prote\xedna",emoji:"\ud83c\udf56",options:te,selected:e.protein||null,multiple:!1,onImmediateSelect:e=>f(a,"protein",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Bebida"}),(0,A.jsx)(R.A,{title:"Bebida",emoji:"\ud83e\udd64",options:re,selected:e.drink||null,multiple:!1,onImmediateSelect:e=>f(a,"drink",e)})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Acompa\xf1amientos"}),(0,A.jsx)(R.A,{title:"Acompa\xf1amientos",emoji:"\ud83e\udd57",options:le,selected:e.sides||[],multiple:!0,onImmediateSelect:e=>f(a,"sides",e)})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Adiciones"}),(0,A.jsx)(R.A,{title:"Adiciones",emoji:"\u2795",options:oe,selected:e.additions||[],multiple:!0,onImmediateSelect:e=>f(a,"additions",e.map(e=>({id:e.id,name:e.name,price:e.price||0,protein:e.protein||"",replacement:e.replacement||"",quantity:e.quantity||1})))})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Cubiertos"}),(0,A.jsx)("input",{type:"checkbox",checked:!!e.cutlery,onChange:e=>f(a,"cutlery",e.target.checked),className:"h-4 w-4"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Hora de Entrega"}),(0,A.jsx)("input",{type:"text",value:"string"===typeof e.time?e.time:(null===(p=e.time)||void 0===p?void 0:p.name)||"",onChange:e=>f(a,"time",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Direcci\xf3n"}),(0,A.jsx)("input",{type:"text",value:(null===(g=e.address)||void 0===g?void 0:g.address)||"",onChange:e=>f(a,"address.address",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tel\xe9fono"}),(0,A.jsx)("input",{type:"text",value:(null===(y=e.address)||void 0===y?void 0:y.phoneNumber)||"",onChange:e=>f(a,"address.phoneNumber",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tipo de Direcci\xf3n"}),(0,A.jsxs)("select",{value:(null===(b=e.address)||void 0===b?void 0:b.addressType)||"",onChange:e=>f(a,"address.addressType",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,A.jsx)("option",{value:"",children:"Seleccione"}),(0,A.jsx)("option",{value:"house",children:"Casa/Apto"}),(0,A.jsx)("option",{value:"school",children:"Colegio/Oficina"}),(0,A.jsx)("option",{value:"complex",children:"Conjunto"}),(0,A.jsx)("option",{value:"shop",children:"Tienda/Local"})]})]}),"shop"===(null===(v=e.address)||void 0===v?void 0:v.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del Local"}),(0,A.jsx)("input",{type:"text",value:(null===(j=e.address)||void 0===j?void 0:j.localName)||"",onChange:e=>f(a,"address.localName",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),"school"===(null===(N=e.address)||void 0===N?void 0:N.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del destinatario"}),(0,A.jsx)("input",{type:"text",value:(null===(w=e.address)||void 0===w?void 0:w.recipientName)||"",onChange:e=>f(a,"address.recipientName",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),"complex"===(null===(k=e.address)||void 0===k?void 0:k.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Detalles (Torre/Apto)"}),(0,A.jsx)("input",{type:"text",value:(null===(C=e.address)||void 0===C?void 0:C.unitDetails)||"",onChange:e=>f(a,"address.unitDetails",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Notas"}),(0,A.jsx)("input",{type:"text",value:e.notes||"",onChange:e=>f(a,"notes",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]})]})]},a)}),(0,A.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Total"}),(0,A.jsx)("input",{type:"number",value:v.total||0,onChange:e=>j("total",Number(e.target.value)),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Estado"}),(0,A.jsxs)("select",{value:v.status||"Pendiente",onChange:e=>j("status",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,A.jsx)("option",{value:"Pendiente",children:"Pendiente"}),(0,A.jsx)("option",{value:"En Preparaci\xf3n",children:"En Preparaci\xf3n"}),(0,A.jsx)("option",{value:"En Camino",children:"En Camino"}),(0,A.jsx)("option",{value:"Entregado",children:"Entregado"}),(0,A.jsx)("option",{value:"Cancelado",children:"Cancelado"})]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"M\xe9todo de Pago"}),(0,A.jsx)(R.A,{title:"M\xe9todo de Pago",emoji:"\ud83d\udcb3",options:de,selected:de.find(e=>e.name===v.payment)||null,multiple:!1,onImmediateSelect:e=>j("payment",(null===e||void 0===e?void 0:e.name)||"")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Domiciliario"}),(0,A.jsx)("input",{type:"text",value:v.deliveryPerson||"Sin asignar",onChange:e=>j("deliveryPerson",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]})]}),(0,A.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,A.jsx)("button",{onClick:()=>b(null),className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium","dark"===t?"bg-gray-600 hover:bg-gray-700 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-900"),children:"Cancelar"}),(0,A.jsx)("button",{onClick:k,disabled:u,className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium",u?"bg-gray-400 cursor-not-allowed":"dark"===t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:u?"Guardando...":"Guardar Cambios"})]})]})})})]})}),(0,A.jsx)(T.e,{show:C,as:r.Fragment,children:(0,A.jsxs)(F.lG,{as:"div",className:"relative z-50",onClose:()=>S(!1),children:[(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50"})}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,A.jsxs)(F.lG.Panel,{className:(0,x.x)("w-full max-w-sm p-6 rounded-lg shadow-md text-center","dark"===t?"bg-gray-800 text-gray-200":"bg-gray-50 text-gray-900"),children:[(0,A.jsx)(F.lG.Title,{className:"text-lg font-medium mb-4",children:"Confirmar Eliminaci\xf3n Masiva"}),(0,A.jsxs)("p",{className:"mb-4",children:["Est\xe1s a punto de eliminar ",(0,A.jsx)("span",{className:"font-bold text-red-500",children:"TODOS"}),' los pedidos. Esta acci\xf3n es irreversible. Para confirmar, escribe "confirmar" a continuaci\xf3n:']}),(0,A.jsx)("input",{type:"text",value:P,onChange:e=>E(e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-center text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-red-500"),placeholder:"escribe 'confirmar'"}),(0,A.jsxs)("div",{className:"mt-6 flex justify-center gap-2",children:[(0,A.jsx)("button",{onClick:()=>{S(!1),E("")},className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium","dark"===t?"bg-gray-600 hover:bg-gray-700 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-900"),children:"Cancelar"}),(0,A.jsx)("button",{onClick:$,disabled:u||"confirmar"!==P.toLowerCase(),className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium",u||"confirmar"!==P.toLowerCase()?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"),children:u?"Eliminando...":"Eliminar Todos"})]})]})})})]})}),(0,A.jsx)(T.e,{show:B,as:r.Fragment,children:(0,A.jsxs)(F.lG,{as:"div",className:"relative z-50",onClose:()=>V(!1),children:[(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50"})}),(0,A.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,A.jsx)(T.e.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,A.jsxs)(F.lG.Panel,{className:(0,x.x)("w-full max-w-2xl p-6 rounded-lg shadow-xl max-h-[80vh] overflow-y-auto","dark"===t?"bg-gray-800 text-gray-200":"bg-gray-50 text-gray-900"),children:[(0,A.jsxs)(F.lG.Title,{className:"text-lg font-medium mb-4 flex justify-between items-center",children:["Generar Nueva Orden",(0,A.jsx)("button",{onClick:()=>V(!1),className:"text-gray-500 hover:text-gray-400","aria-label":"Cerrar formulario de nueva orden",children:(0,A.jsx)(q.A,{className:"w-5 h-5"})})]}),_.meals.map((e,a)=>{var r,n,l,i,o,s,d,c,m,u;return(0,A.jsxs)("div",{className:"mb-6 p-4 border rounded-md border-gray-200 dark:border-gray-600",children:[(0,A.jsxs)("h3",{className:"font-medium mb-2",children:["Bandeja ",a+1]}),(0,A.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Sopa o reemplazo"}),(0,A.jsx)(R.A,{title:"Sopa",emoji:"\ud83e\udd63",options:J,selected:"string"===typeof e.soup?J.find(t=>t.name===e.soup):e.soup,multiple:!1,onImmediateSelect:e=>K(a,"soup",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Principio"}),(0,A.jsx)(R.A,{title:"Principio",emoji:"\ud83c\udf5a",options:X,selected:Array.isArray(e.principle)?e.principle:[],multiple:!0,showConfirmButton:!0,onImmediateSelect:e=>K(a,"principle",e),onConfirm:e=>{let{selection:t}=e;return K(a,"principle",t)}})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prote\xedna"}),(0,A.jsx)(R.A,{title:"Prote\xedna",emoji:"\ud83c\udf56",options:te,selected:"string"===typeof e.protein?te.find(t=>t.name===e.protein):e.protein,multiple:!1,onImmediateSelect:e=>K(a,"protein",e)})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Bebida"}),(0,A.jsx)(R.A,{title:"Bebida",emoji:"\ud83e\udd64",options:re,selected:"string"===typeof e.drink?re.find(t=>t.name===e.drink):e.drink,multiple:!1,onImmediateSelect:e=>K(a,"drink",e)})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Acompa\xf1amientos"}),(0,A.jsx)(R.A,{title:"Acompa\xf1amientos",emoji:"\ud83e\udd57",options:le,selected:Array.isArray(e.sides)?e.sides:[],multiple:!0,onImmediateSelect:e=>K(a,"sides",e)})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Adiciones"}),(0,A.jsx)(R.A,{title:"Adiciones",emoji:"\u2795",options:oe,selected:Array.isArray(e.additions)?e.additions:[],multiple:!0,onImmediateSelect:e=>K(a,"additions",e.map(e=>({id:e.id,name:e.name,price:e.price||0,protein:e.protein||"",replacement:e.replacement||"",quantity:e.quantity||1})))})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Cubiertos"}),(0,A.jsx)("input",{type:"checkbox",checked:!!e.cutlery,onChange:e=>K(a,"cutlery",e.target.checked),className:"h-4 w-4"})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Hora de Entrega"}),(0,A.jsx)("input",{type:"text",value:"string"===typeof e.time?e.time:(null===(r=e.time)||void 0===r?void 0:r.name)||"",onChange:e=>K(a,"time",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Direcci\xf3n"}),(0,A.jsx)("input",{type:"text",value:(null===(n=e.address)||void 0===n?void 0:n.address)||"",onChange:e=>K(a,"address.address",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tel\xe9fono"}),(0,A.jsx)("input",{type:"text",value:(null===(l=e.address)||void 0===l?void 0:l.phoneNumber)||"",onChange:e=>K(a,"address.phoneNumber",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tipo de Direcci\xf3n"}),(0,A.jsxs)("select",{value:(null===(i=e.address)||void 0===i?void 0:i.addressType)||"",onChange:e=>K(a,"address.addressType",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,A.jsx)("option",{value:"",children:"Seleccione"}),(0,A.jsx)("option",{value:"house",children:"Casa/Apto"}),(0,A.jsx)("option",{value:"school",children:"Colegio/Oficina"}),(0,A.jsx)("option",{value:"complex",children:"Conjunto"}),(0,A.jsx)("option",{value:"shop",children:"Tienda/Local"})]})]}),"shop"===(null===(o=e.address)||void 0===o?void 0:o.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del Local"}),(0,A.jsx)("input",{type:"text",value:(null===(s=e.address)||void 0===s?void 0:s.localName)||"",onChange:e=>K(a,"address.localName",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),"school"===(null===(d=e.address)||void 0===d?void 0:d.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre del destinatario"}),(0,A.jsx)("input",{type:"text",value:(null===(c=e.address)||void 0===c?void 0:c.recipientName)||"",onChange:e=>K(a,"address.recipientName",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),"complex"===(null===(m=e.address)||void 0===m?void 0:m.addressType)&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Detalles (Torre/Apto)"}),(0,A.jsx)("input",{type:"text",value:(null===(u=e.address)||void 0===u?void 0:u.unitDetails)||"",onChange:e=>K(a,"address.unitDetails",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{className:"sm:col-span-2",children:[(0,A.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Notas"}),(0,A.jsx)("input",{type:"text",value:e.notes||"",onChange:e=>K(a,"notes",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]})]})]},a)}),(0,A.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Total"}),(0,A.jsx)("input",{type:"number",value:_.total||0,onChange:e=>U("total",Number(e.target.value)),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Estado"}),(0,A.jsxs)("select",{value:_.status||"Pendiente",onChange:e=>U("status",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,A.jsx)("option",{value:"Pendiente",children:"Pendiente"}),(0,A.jsx)("option",{value:"En Preparaci\xf3n",children:"En Preparaci\xf3n"}),(0,A.jsx)("option",{value:"En Camino",children:"En Camino"}),(0,A.jsx)("option",{value:"Entregado",children:"Entregado"}),(0,A.jsx)("option",{value:"Cancelado",children:"Cancelado"})]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"M\xe9todo de Pago"}),(0,A.jsxs)("select",{value:_.payment||"Efectivo",onChange:e=>U("payment",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500"),children:[(0,A.jsx)("option",{value:"Efectivo",children:"Efectivo"}),(0,A.jsx)("option",{value:"Daviplata",children:"Daviplata"}),(0,A.jsx)("option",{value:"Nequi",children:"Nequi"})]})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Domiciliario"}),(0,A.jsx)("input",{type:"text",value:_.deliveryPerson||"Sin asignar",onChange:e=>U("deliveryPerson",e.target.value),className:(0,x.x)("w-full p-2 rounded-md border text-sm","dark"===t?"border-gray-600 bg-gray-700 text-white":"border-gray-200 bg-white text-gray-900","focus:outline-none focus:ring-1 focus:ring-blue-500")})]})]}),(0,A.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,A.jsx)("button",{onClick:()=>V(!1),className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium","dark"===t?"bg-gray-600 hover:bg-gray-700 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-900"),children:"Cancelar"}),(0,A.jsx)("button",{onClick:H,disabled:u,className:(0,x.x)("px-4 py-2 rounded-md text-sm font-medium",u?"bg-gray-400 cursor-not-allowed":"dark"===t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:u?"Guardando...":"Crear Orden"})]})]})})})]})})]})},_=e=>{let{setError:t,setSuccess:a,theme:i}=e;const[o,d]=(0,r.useState)([]),[c,m]=(0,r.useState)(null),[h,x]=(0,r.useState)(""),[y,b]=(0,r.useState)({cash:0,daviplata:0,nequi:0}),[v,f]=(0,r.useState)({meals:[],total:0,status:"",payment:"",deliveryPerson:""}),[j,N]=(0,r.useState)(1),[w,k]=(0,r.useState)(10),[C,S]=(0,r.useState)(!0),[P,E]=(0,r.useState)(!1),[$,D]=(0,r.useState)(""),[T,F]=(0,r.useState)(null),[q,L]=(0,r.useState)(null),[M,R]=(0,r.useState)({}),[z,B]=(0,r.useState)("createdAt.seconds"),[I,G]=(0,r.useState)("desc"),[_,K]=(0,r.useState)([]),[U,H]=(0,r.useState)({name:"",quantity:""}),[W,J]=(0,r.useState)(!1),[Z,Y]=(0,r.useState)(!1),[Q,X]=(0,r.useState)(!1),[ee,te]=(0,r.useState)("all"),[ae,re]=(0,r.useState)({meals:[{soup:"",soupReplacement:"",principle:[{name:""}],principleReplacement:"",protein:"",drink:"",cutlery:"",sides:[],additions:[],notes:"",address:{address:"",phoneNumber:"",addressType:"",localName:"",recipientName:""},time:"",payment:"Efectivo"}],total:0,status:"Pendiente",payment:"Efectivo",deliveryPerson:"Sin asignar",type:"lunch"}),ne=(0,r.useMemo)(()=>_.reduce((e,t)=>e+Number(t.quantity||0),0),[_]),le=(0,r.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{await(0,l.gS)((0,l.rJ)(n.db,"userActivity"),{action:e,timestamp:(0,l.O5)(),details:t})}catch(a){console.error("Error al registrar actividad:",a)}},[]),ie=(0,r.useCallback)(()=>{S(!0);let e=[],a=[];const r=()=>{const t=[...e,...a];d(t);const r={cash:0,daviplata:0,nequi:0,general:0},n={};t.forEach(e=>{if("Cancelado"!==e.status){const t=e.paymentSummary||{Efectivo:0,Daviplata:0,Nequi:0};r.cash+=t.Efectivo||0,r.daviplata+=t.Daviplata||0,r.nequi+=t.Nequi||0,r.general+=e.total||0;const a=e.deliveryPerson||"Sin asignar";if("Sin asignar"!==a){n[a]||(n[a]={almuerzo:{efectivo:0,daviplata:0,nequi:0,total:0},desayuno:{efectivo:0,daviplata:0,nequi:0,total:0}});const t="breakfast"===e.type?"desayuno":"almuerzo",r=g(e.payment||"Efectivo").toLowerCase(),l=e.total||0;"efectivo"===r?n[a][t].efectivo+=l:"daviplata"===r?n[a][t].daviplata+=l:"nequi"===r&&(n[a][t].nequi+=l),n[a][t].total+=l}}}),b(r),R(n),S(!1)},i=(0,l.aQ)((0,l.rJ)(n.db,"orders"),t=>{e=t.docs.map(e=>{var t,a;const r=e.data(),n=Array.isArray(r.meals)&&r.meals.length>0?r.meals:[{address:{},payment:{name:"Efectivo"},time:{}}];return{id:e.id,type:"lunch",...r,meals:n.map(e=>({...e,address:e.address||{},payment:e.payment&&"object"===typeof e.payment&&e.payment.name?e.payment:{name:e.payment||"Efectivo"},time:e.time||{}})),payment:r.payment||(null===(t=n[0])||void 0===t||null===(a=t.payment)||void 0===a?void 0:a.name)||"Efectivo",paymentSummary:r.paymentSummary||{Efectivo:0,Daviplata:0,Nequi:0},total:r.total||0,deliveryPerson:r.deliveryPerson||"Sin asignar",status:r.status||"Pendiente"}}),r()},e=>{t(`Error al cargar almuerzos: ${e.message}`),S(!1)}),o=(0,l.aQ)((0,l.rJ)(n.db,"deliveryBreakfastOrders"),e=>{a=e.docs.map(e=>{var t,a,r;const n=e.data();return{id:e.id,type:"breakfast",...n,payment:n.payment||(null===(t=n.breakfasts)||void 0===t||null===(a=t[0])||void 0===a||null===(r=a.payment)||void 0===r?void 0:r.name)||"Efectivo",paymentSummary:n.paymentSummary||{Efectivo:0,Daviplata:0,Nequi:0},total:n.total||0,deliveryPerson:n.deliveryPerson||"Sin asignar",status:n.status||"Pendiente"}}),r()},e=>{t(`Error al cargar desayunos: ${e.message}`),S(!1)});return()=>{i(),o()}},[t]),oe=(0,r.useCallback)(()=>{const e=(new Date).toISOString().split("T")[0],a=(0,l.P)((0,l.rJ)(n.db,"dailyProteins"),(0,l._M)("date","==",e)),r=(0,l.aQ)(a,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));K(t)},e=>{t(`Error al cargar prote\xednas: ${e.message}`)});return()=>r()},[t]);(0,r.useEffect)(()=>{const e=ie(),t=oe();return()=>{e(),t()}},[ie,oe]);const se=(0,r.useMemo)(()=>o.filter(e=>{var t,a,r,n,l,i,o,s,d,c,m,u,p,x;const y=(h||"").toLowerCase(),b=(null===(t=e.meals)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.address)||(null===(r=e.breakfasts)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.address)||{},v=(b.address||"").toLowerCase(),f=(b.phoneNumber||"").toLowerCase(),j=(null===(l=e.meals)||void 0===l||null===(i=l[0])||void 0===i?void 0:i.time)||(null===(o=e.breakfasts)||void 0===o||null===(s=o[0])||void 0===s?void 0:s.time),N=("string"===typeof j?j:(null===j||void 0===j?void 0:j.name)||"").toLowerCase(),w=g(e.payment||(null===(d=e.meals)||void 0===d||null===(c=d[0])||void 0===c||null===(m=c.payment)||void 0===m?void 0:m.name)||(null===(u=e.breakfasts)||void 0===u||null===(p=u[0])||void 0===p||null===(x=p.payment)||void 0===x?void 0:x.name)||"").toLowerCase(),k=(e.deliveryPerson||"").toLowerCase(),C=(e.status||"").toLowerCase();return("all"===ee||e.type===ee)&&(v.includes(y)||f.includes(y)||N.includes(y)||w.includes(y)||k.includes(y)||C.includes(y))}),[o,h,ee]),de=(0,r.useMemo)(()=>{const e={cash:0,daviplata:0,nequi:0,general:0};return se.forEach(t=>{if("Cancelado"===t.status)return;const a=t.paymentSummary||{Efectivo:0,Daviplata:0,Nequi:0};e.cash+=a.Efectivo||0,e.daviplata+=a.Daviplata||0,e.nequi+=a.Nequi||0,e.general+=t.total||0}),e},[se]),ce=(0,r.useMemo)(()=>[...se].sort((e,t)=>{const a=(e,t,a)=>{if("orderNumber"===t)return e?a.indexOf(e):-1;if(t.startsWith("createdAt")){const t=e.createdAt;return t&&"function"===typeof t.toMillis?t.toMillis():t instanceof Date?t.getTime():t&&t.seconds?1e3*t.seconds:0}const r=(e,t)=>t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e);let n=r(e,t);if((void 0===n||null===n||""===n)&&t.startsWith("meals.0.")){n=r(e,t.replace(/^meals\.0\./,"breakfasts.0."))}var l;t.endsWith(".time.name")&&"string"!==typeof n&&(n=(null===(l=n)||void 0===l?void 0:l.name)||"");return"number"===typeof n?n:g(n)||""},r=a(e,z,se),n=a(t,z,se);return"string"===typeof r&&"string"===typeof n?"asc"===I?r.localeCompare(n):n.localeCompare(r):"asc"===I?r-n:n-r}),[se,z,I]),me=Math.ceil(ce.length/w),ue=(0,r.useMemo)(()=>{const e=(j-1)*w,t=e+w;return ce.slice(e,t)},[ce,j,w]),pe=(0,r.useCallback)(e=>{m(e);const t={address:"",phoneNumber:"",addressType:"",localName:"",recipientName:"",unitDetails:""};if("breakfast"===e.type){const a=Array.isArray(e.breakfasts)&&e.breakfasts.length>0?e.breakfasts.map(e=>({...e,address:e.address||{...t},additions:Array.isArray(e.additions)?e.additions:[],cutlery:"boolean"===typeof e.cutlery?e.cutlery:!!e.cutlery,time:e.time||"",notes:e.notes||"",type:e.type||null,eggs:e.eggs||null,broth:e.broth||null,riceBread:e.riceBread||null,drink:e.drink||null,protein:e.protein||null})):[{type:null,eggs:null,broth:null,riceBread:null,drink:null,protein:null,additions:[],notes:"",cutlery:!1,time:"",address:{...t}}];return void f({id:e.id,breakfasts:a,total:e.total||0,status:e.status||"Pendiente",payment:e.payment?g(e.payment):"Efectivo",deliveryPerson:e.deliveryPerson||"Sin asignar",type:"breakfast"})}const a=Array.isArray(e.meals)&&e.meals.length>0?e.meals.map(e=>{var a;return{...e,address:e.address||{...t},payment:e.payment?g((null===(a=e.payment)||void 0===a?void 0:a.name)||e.payment):"Efectivo",additions:Array.isArray(e.additions)?e.additions:[],principle:Array.isArray(e.principle)?e.principle:e.principle?[{name:e.principle.name||e.principle}]:[],cutlery:"boolean"===typeof e.cutlery?e.cutlery:!!e.cutlery,sides:Array.isArray(e.sides)?e.sides:[],soup:e.soup||"",soupReplacement:e.soupReplacement||"",protein:e.protein||"",drink:e.drink||"",time:e.time||"",notes:e.notes||""}}):[{soup:"",soupReplacement:"",principle:[{name:""}],principleReplacement:"",protein:"",drink:"",cutlery:!1,sides:[],additions:[],notes:"",address:{...t},time:"",payment:"Efectivo"}];f({id:e.id,meals:a,total:e.total||0,status:e.status||"Pendiente",payment:e.payment?g(e.payment):"Efectivo",deliveryPerson:e.deliveryPerson||"Sin asignar",type:"lunch"})},[]),ge=async()=>{if("confirmar"===$.toLowerCase()){S(!0);try{const e=(0,l.wP)(n.db),t=await(0,l.GG)((0,l.rJ)(n.db,"orders")),r=await(0,l.GG)((0,l.rJ)(n.db,"deliveryBreakfastOrders"));t.forEach(t=>e.delete(t.ref)),r.forEach(t=>e.delete(t.ref)),await e.commit(),E(!1),D(""),a("Todos los pedidos han sido eliminados."),le("Elimin\xf3 todos los pedidos",{count:t.size+r.size})}catch(e){t(`Error al eliminar todos los pedidos: ${e.message}`)}finally{S(!1)}}else t('Por favor, escribe "confirmar" para proceder.')},he=(0,r.useMemo)(()=>{const e={};for(const[d,c]of Object.entries(M||{})){var t,a,r,n,l,i,o,s;const m=((null===c||void 0===c||null===(t=c.almuerzo)||void 0===t?void 0:t.efectivo)||0)+((null===c||void 0===c||null===(a=c.desayuno)||void 0===a?void 0:a.efectivo)||0),u=((null===c||void 0===c||null===(r=c.almuerzo)||void 0===r?void 0:r.daviplata)||0)+((null===c||void 0===c||null===(n=c.desayuno)||void 0===n?void 0:n.daviplata)||0),p=((null===c||void 0===c||null===(l=c.almuerzo)||void 0===l?void 0:l.nequi)||0)+((null===c||void 0===c||null===(i=c.desayuno)||void 0===i?void 0:i.nequi)||0),g=((null===c||void 0===c||null===(o=c.almuerzo)||void 0===o?void 0:o.total)||0)+((null===c||void 0===c||null===(s=c.desayuno)||void 0===s?void 0:s.total)||0);e[d]={cash:m,daviplata:u,nequi:p,total:g}}return e},[M]),xe=(0,r.useMemo)(()=>Object.keys(M||{}),[M]);return(0,A.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,A.jsx)(V,{theme:i,showProteinModal:W,setShowProteinModal:J,newProtein:U,setNewProtein:H,handleAddProtein:async()=>{if(!U.name||!U.quantity||isNaN(U.quantity)||Number(U.quantity)<=0)t("Por favor, ingrese un nombre de prote\xedna v\xe1lido y una cantidad mayor a 0.");else{S(!0);try{await(0,l.gS)((0,l.rJ)(n.db,"dailyProteins"),{name:U.name.trim(),quantity:Number(U.quantity),date:(new Date).toISOString().split("T")[0],createdAt:new Date}),H({name:"",quantity:""}),J(!1),a("Prote\xedna agregada correctamente."),le(`Agreg\xf3 prote\xedna: ${U.name} (${U.quantity} unidades)`,{proteinName:U.name,quantity:Number(U.quantity)})}catch(e){t(`Error al agregar prote\xedna: ${e.message}`)}finally{S(!1)}}},proteins:_,totalProteinUnits:ne,isLoading:C,showMealDetails:T,setShowMealDetails:F,editingOrder:c,setEditingOrder:m,editForm:v,handleMealFormFieldChange:(e,t,a)=>{f(r=>{const n=[...r.meals||[]];if(n[e]||(n[e]={address:{},payment:{},time:{}}),t.includes(".")){const[r,l]=t.split(".");n[e]={...n[e],[r]:{...n[e][r]||{},[l]:a}}}else"sides"===t?Array.isArray(a)?n[e]={...n[e],sides:a}:n[e]={...n[e],sides:String(a).split(",").map(e=>({name:e.trim()})).filter(e=>e.name)}:"additions"===t?Array.isArray(a)?n[e]={...n[e],additions:a}:n[e]={...n[e],additions:String(a).split(";").map(e=>{const[t,a="",r="1"]=e.split(",");return{name:t.trim(),[a.includes("por")?"replacement":"protein"]:a.trim(),quantity:Number(r)||1}}).filter(e=>e.name)}:"principle"===t?Array.isArray(a)?n[e]={...n[e],principle:a}:n[e]={...n[e],principle:String(a).split(",").map(e=>({name:e.trim()})).filter(e=>e.name)}:n[e]={...n[e],[t]:a};return{...r,meals:n}})},handleEditFormFieldChange:(e,t)=>{f(a=>({...a,[e]:t}))},handleSaveEdit:async()=>{if(c){S(!0);try{const e=o.find(e=>e.id===c.id),t=e?{meals:e.meals,breakfasts:e.breakfasts,total:e.total,status:e.status,payment:e.payment,deliveryPerson:e.deliveryPerson,type:e.type}:{},r={Efectivo:"Efectivo"===v.payment&&Number(v.total)||0,Daviplata:"Daviplata"===v.payment&&Number(v.total)||0,Nequi:"Nequi"===v.payment&&Number(v.total)||0};let i={total:Number(v.total)||0,status:v.status||"Pendiente",payment:v.payment||"Efectivo",deliveryPerson:v.deliveryPerson||"Sin asignar",paymentSummary:r,updatedAt:new Date,type:v.type||c.type||"lunch"};if("breakfast"===(c.type||v.type)){const e=(v.breakfasts||[]).map(e=>{var t,a,r,n,l,i;return{type:e.type?{name:("string"===typeof e.type?e.type:e.type.name)||""}:null,eggs:e.eggs?{name:("string"===typeof e.eggs?e.eggs:e.eggs.name)||""}:null,broth:e.broth?{name:("string"===typeof e.broth?e.broth:e.broth.name)||""}:null,riceBread:e.riceBread?{name:("string"===typeof e.riceBread?e.riceBread:e.riceBread.name)||""}:null,drink:e.drink?{name:("string"===typeof e.drink?e.drink:e.drink.name)||""}:null,protein:e.protein?{name:("string"===typeof e.protein?e.protein:e.protein.name)||""}:null,additions:Array.isArray(e.additions)?e.additions.map(e=>({name:e.name||"",quantity:Number(e.quantity)||1})).filter(e=>e.name):[],notes:e.notes||"",cutlery:!!e.cutlery,time:e.time?{name:("string"===typeof e.time?e.time:e.time.name)||""}:null,address:{address:(null===(t=e.address)||void 0===t?void 0:t.address)||"",phoneNumber:(null===(a=e.address)||void 0===a?void 0:a.phoneNumber)||"",addressType:(null===(r=e.address)||void 0===r?void 0:r.addressType)||"",localName:(null===(n=e.address)||void 0===n?void 0:n.localName)||"",recipientName:(null===(l=e.address)||void 0===l?void 0:l.recipientName)||"",unitDetails:(null===(i=e.address)||void 0===i?void 0:i.unitDetails)||""}}});i={...i,breakfasts:e},await(0,l.mZ)((0,l.H9)(n.db,"deliveryBreakfastOrders",c.id),i),le(`Edit\xf3 (desayuno) el pedido ${c.id}`,{orderId:c.id,previousState:t,newState:{...v,breakfasts:e}})}else{const e=(v.meals||[]).map(e=>{var t,a,r,n,l,i;return{soup:e.soup?{name:("string"===typeof e.soup?e.soup:e.soup.name)||""}:null,soupReplacement:e.soupReplacement?{name:("string"===typeof e.soupReplacement?e.soupReplacement:e.soupReplacement.name)||""}:null,principle:Array.isArray(e.principle)?e.principle.map(e=>({name:("string"===typeof e?e:e.name)||""})).filter(e=>e.name):[],principleReplacement:e.principleReplacement?{name:("string"===typeof e.principleReplacement?e.principleReplacement:e.principleReplacement.name)||""}:null,protein:e.protein?{name:("string"===typeof e.protein?e.protein:e.protein.name)||""}:null,drink:e.drink?{name:("string"===typeof e.drink?e.drink:e.drink.name)||""}:null,cutlery:!!e.cutlery,time:e.time?{name:("string"===typeof e.time?e.time:e.time.name)||""}:null,payment:e.payment?{name:("string"===typeof e.payment?e.payment:e.payment.name)||"Efectivo"}:{name:"Efectivo"},sides:Array.isArray(e.sides)?e.sides.map(e=>({name:("string"===typeof e?e:e.name)||""})).filter(e=>e.name):[],additions:Array.isArray(e.additions)?e.additions.map(e=>({name:e.name||"",protein:e.protein||"",replacement:e.replacement||"",quantity:Number(e.quantity)||1})):[],notes:e.notes||"",address:{address:(null===(t=e.address)||void 0===t?void 0:t.address)||"",phoneNumber:(null===(a=e.address)||void 0===a?void 0:a.phoneNumber)||"",addressType:(null===(r=e.address)||void 0===r?void 0:r.addressType)||"",localName:(null===(n=e.address)||void 0===n?void 0:n.localName)||"",recipientName:(null===(l=e.address)||void 0===l?void 0:l.recipientName)||"",unitDetails:(null===(i=e.address)||void 0===i?void 0:i.unitDetails)||""}}});i={...i,meals:e},await(0,l.mZ)((0,l.H9)(n.db,"orders",c.id),i),le(`Edit\xf3 (almuerzo) el pedido ${c.id}`,{orderId:c.id,previousState:t,newState:{...v,meals:e}})}m(null),a("Pedido actualizado correctamente.")}catch(e){t(`Error al guardar: ${e.message}`)}finally{S(!1)}}},showConfirmDeleteAll:P,setShowConfirmDeleteAll:E,confirmText:$,setConfirmText:D,handleDeleteAllOrders:ge,setError:t,setSuccess:a,showAddOrderModal:Q,setShowAddOrderModal:X,newOrderForm:ae,handleNewOrderMealFormFieldChange:(e,t,a)=>{re(r=>{const n=[...r.meals];if(n[e]||(n[e]={address:{},payment:{},time:{}}),t.includes(".")){const[r,l]=t.split(".");n[e]={...n[e],[r]:{...n[e][r],[l]:a}}}else n[e]="sides"===t?{...n[e],sides:a.split(",").map(e=>({name:e.trim()})).filter(e=>e.name)}:"additions"===t?{...n[e],additions:a.split(";").map(e=>{const[t,a="",r="1"]=e.split(",");return{name:t.trim(),[a.includes("por")?"replacement":"protein"]:a.trim(),quantity:Number(r)||1}}).filter(e=>e.name)}:"principle"===t?{...n[e],principle:a.split(",").map(e=>({name:e.trim()})).filter(e=>e.name)}:{...n[e],[t]:a};return{...r,meals:n}})},handleNewOrderFieldChange:(e,t)=>{re(a=>({...a,[e]:t}))},handleAddOrderSubmit:async()=>{S(!0);try{const e=ae.meals.map(e=>({...e,soup:e.soup?{name:e.soup}:null,soupReplacement:e.soupReplacement?{name:e.soupReplacement}:null,principle:Array.isArray(e.principle)?e.principle.map(e=>({name:e.name||e})):e.principle?[{name:e.principle}]:[],principleReplacement:e.principleReplacement?{name:e.principleReplacement}:null,protein:e.protein?{name:e.protein}:null,drink:e.drink?{name:e.drink}:null,cutlery:e.cutlery?{name:e.cutlery}:null,time:e.time?{name:e.time}:null,payment:ae.payment?{name:ae.payment}:{name:"Efectivo"},sides:Array.isArray(e.sides)?e.sides.map(e=>({name:e.name||e})):[],additions:Array.isArray(e.additions)?e.additions.map(e=>({name:e.name||"",protein:e.protein||"",replacement:e.replacement||"",quantity:e.quantity||1})):[]})),t={Efectivo:"Efectivo"===ae.payment&&Number(ae.total)||0,Daviplata:"Daviplata"===ae.payment&&Number(ae.total)||0,Nequi:"Nequi"===ae.payment&&Number(ae.total)||0},r={...ae,meals:e,total:Number(ae.total)||0,status:ae.status||"Pendiente",payment:ae.payment||"Efectivo",deliveryPerson:ae.deliveryPerson||"Sin asignar",paymentSummary:t,createdAt:(0,l.O5)(),type:ae.type||"lunch"},i="breakfast"===ae.type?"deliveryBreakfastOrders":"orders",o=await(0,l.gS)((0,l.rJ)(n.db,i),r);a("Orden agregada correctamente."),le(`Agreg\xf3 una nueva orden (Total: $${ae.total.toLocaleString("es-CO")})`,{orderId:o.id,newOrderDetails:{...ae,meals:e}}),X(!1),re({meals:[{soup:"",soupReplacement:"",principle:[{name:""}],principleReplacement:"",protein:"",drink:"",cutlery:"",sides:[],additions:[],notes:"",address:{address:"",phoneNumber:"",addressType:"",localName:"",recipientName:""},time:"",payment:"Efectivo"}],total:0,status:"Pendiente",payment:"Efectivo",deliveryPerson:"Sin asignar",type:"lunch"})}catch(e){t(`Error al agregar orden: ${e.message}`)}finally{S(!1)}},uniqueDeliveryPersons:xe}),(0,A.jsx)(O,{theme:i,orders:o,searchTerm:h,setSearchTerm:x,totals:de,isLoading:C,paginatedOrders:ue,currentPage:j,totalPages:me,setCurrentPage:N,itemsPerPage:w,setItemsPerPage:k,deliveryPersons:he,handleEditOrder:pe,handleDeleteOrder:async e=>{S(!0);try{const t=o.find(t=>t.id===e);await(0,l.kd)((0,l.H9)(n.db,"breakfast"===t.type?"deliveryBreakfastOrders":"orders",e)),a("Pedido eliminado correctamente."),t?le(`Elimin\xf3 el pedido con ID: ${e}`,{orderId:e,deletedOrderDetails:{meals:t.meals,total:t.total,status:t.status,payment:t.payment,deliveryPerson:t.deliveryPerson,type:t.type}}):le(`Elimin\xf3 el pedido con ID: ${e} (detalles no disponibles)`)}catch(r){t(`Error al eliminar: ${r.message}`)}finally{S(!1)}},handleStatusChange:async(e,r)=>{try{const t=o.find(t=>t.id===e),i=t?t.status:"Desconocido",s="breakfast"===t.type?"deliveryBreakfastOrders":"orders";if(await(0,l.mZ)((0,l.H9)(n.db,s,e),{status:r,updatedAt:new Date}),"Cancelado"===r&&t&&"Cancelado"!==i){const e=g(t.payment||"Efectivo"),a=t.total||0,r=g(t.deliveryPerson||"");b(t=>{const r={...t};return"efectivo"===e.toLowerCase()?r.cash=Math.max(0,r.cash-a):"daviplata"===e.toLowerCase()?r.daviplata=Math.max(0,r.daviplata-a):"nequi"===e.toLowerCase()&&(r.nequi=Math.max(0,r.nequi-a)),r}),r&&"Sin asignar"!==r&&R(n=>{const l={...n};if(l[r]){var i,o;const n="breakfast"===t.type?"desayuno":"almuerzo",s={...l[r]},d={...s[n]||{efectivo:0,daviplata:0,nequi:0,total:0}},c=e.toLowerCase();"efectivo"===c?d.efectivo=Math.max(0,(d.efectivo||0)-a):"daviplata"===c?d.daviplata=Math.max(0,(d.daviplata||0)-a):"nequi"===c&&(d.nequi=Math.max(0,(d.nequi||0)-a)),d.total=Math.max(0,(d.total||0)-a),s[n]=d,l[r]=s;0===((null===(i=s.almuerzo)||void 0===i?void 0:i.total)||0)+((null===(o=s.desayuno)||void 0===o?void 0:o.total)||0)&&delete l[r]}return l})}a("Estado actualizado correctamente."),le(`Actualiz\xf3 el estado del pedido ${e} a: ${r}`,{orderId:e,previousStatus:i,newStatus:r})}catch(i){t(`Error al actualizar estado: ${i.message}`)}},handleSort:e=>{z===e?G("asc"===I?"desc":"asc"):(B(e),G("asc")),N(1)},getSortIcon:e=>z!==e?null:"asc"===I?(0,A.jsx)("svg",{className:"w-4 h-4 inline ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,A.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 15l7-7 7 7"})}):(0,A.jsx)("svg",{className:"w-4 h-4 inline ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,A.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}),setShowMealDetails:F,editingDeliveryId:q,setEditingDeliveryId:L,editForm:v,setEditForm:f,handleDeliveryChange:async(e,r)=>{try{const t=o.find(t=>t.id===e),i="breakfast"===t.type?"deliveryBreakfastOrders":"orders",s=t?t.deliveryPerson:"Desconocido";await(0,l.mZ)((0,l.H9)(n.db,i,e),{deliveryPerson:r||null,updatedAt:new Date}),L(null),a("Domiciliario actualizado correctamente."),le(`Asign\xf3/Actualiz\xf3 domiciliario para el pedido ${e} a: ${r||"Sin asignar"}`,{orderId:e,previousDeliveryPerson:s,newDeliveryPerson:r||"Sin asignar"})}catch(i){t(`Error al actualizar domiciliario: ${i.message}`)}},sortOrder:I,showProteinModal:W,setShowProteinModal:J,isMenuOpen:Z,setIsMenuOpen:Y,handleOpenPreview:()=>{const e=window.open("","_blank");e.document.write(((e,t,a)=>{var r,n,l;let i=0;const o=e.flatMap(e=>e&&Array.isArray(e.meals)&&0!==e.meals.length?e.meals.filter(e=>e).map(t=>{var a,r,n;return i+=1,[i,(null===t||void 0===t||null===(a=t.address)||void 0===a?void 0:a.address)||"",(null===t||void 0===t||null===(r=t.address)||void 0===r?void 0:r.phoneNumber)||"",`$${(null===(n=e.total)||void 0===n?void 0:n.toLocaleString("es-CO"))||"0"}`,(null===e||void 0===e?void 0:e.deliveryPerson)||""]}):[]);0===o.length&&o.push(Array(5).fill("-"));const s=Object.entries(a).map(e=>{var t,a,r,n;let[l,i]=e;return[l||"",`$${(null===(t=i.cash)||void 0===t?void 0:t.toLocaleString("es-CO"))||"0"}`,`$${(null===(a=i.daviplata)||void 0===a?void 0:a.toLocaleString("es-CO"))||"0"}`,`$${(null===(r=i.nequi)||void 0===r?void 0:r.toLocaleString("es-CO"))||"0"}`,`$${(null===(n=i.total)||void 0===n?void 0:n.toLocaleString("es-CO"))||"0"}`]}),d=new Date;return`\n    <html>\n      <head>\n        <title>Previsualizaci\xf3n de Pedidos</title>\n        <style>\n          body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }\n          h1 { text-align: center; font-size: 24px; }\n          p.date { text-align: center; font-size: 12px; }\n          table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n          th, td { padding: 8px; border: 1px solid black; }\n          th { background-color: #0066cc; color: white; font-weight: bold; }\n          td { text-align: left; }\n          td:nth-child(4) { text-align: right; }\n          tr:nth-child(even) { background-color: #f5f5f5; }\n          .totals-table { width: 50%; }\n          .delivery-table th:nth-child(n+2), .delivery-table td:nth-child(n+2) { text-align: right; }\n          .button-container { margin-top: 20px; text-align: center; }\n          .button { padding: 10px 20px; background-color: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }\n          .button.print { background-color: #28a745; }\n          @media print {\n              .button-container { display: none; }\n          }\n        </style>\n      </head>\n      <body>\n        <h1>Gesti\xf3n de Pedidos</h1>\n        <p class="date">Fecha: ${d.toLocaleDateString("es-CO")} ${d.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!0})}</p>\n        <table>\n          <thead>\n            <tr>\n              <th>N</th>\n              <th>Direcci\xf3n</th>\n              <th>Tel\xe9fono</th>\n              <th>Total</th>\n              <th>Domiciliario</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${o.map(e=>`\n              <tr>\n                <td>${e[0]}</td>\n                <td>${e[1]}</td>\n                <td>${e[2]}</td>\n                <td>${e[3]}</td>\n                <td>${e[4]}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n        <h2 style="margin-top: 20px; font-size: 18px;">Resumen de Totales</h2>\n        <table class="totals-table">\n          <tbody>\n            <tr><td style="padding: 8px;">Total Efectivo</td><td style="padding: 8px; text-align: right;">${o.length>0?`$${(null===(r=t.cash)||void 0===r?void 0:r.toLocaleString("es-CO"))||"0"}`:"$0"}</td></tr>\n            <tr><td style="padding: 8px;">Total Daviplata</td><td style="padding: 8px; text-align: right;">${o.length>0?`$${(null===(n=t.daviplata)||void 0===n?void 0:n.toLocaleString("es-CO"))||"0"}`:"$0"}</td></tr>\n            <tr><td style="padding: 8px;">Total Nequi</td><td style="padding: 8px; text-align: right;">${o.length>0?`$${(null===(l=t.nequi)||void 0===l?void 0:l.toLocaleString("es-CO"))||"0"}`:"$0"}</td></tr>\n            <tr><td style="padding: 8px;">Total General</td><td style="padding: 8px; text-align: right;">${o.length>0?`$${(t.cash+t.daviplata+t.nequi||0).toLocaleString("es-CO")}`:"$0"}</td></tr>\n          </tbody>\n        </table>\n        <h2 style="margin-top: 20px; font-size: 18px;">Resumen por Domiciliarios</h2>\n        <table class="delivery-table">\n          <thead>\n            <tr>\n              <th>Domiciliario</th>\n              <th>Efectivo</th>\n              <th>Daviplata</th>\n              <th>Nequi</th>\n              <th>Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${s.map(e=>`\n              <tr>\n                <td>${e[0]}</td>\n                <td>${e[1]}</td>\n                <td>${e[2]}</td>\n                <td>${e[3]}</td>\n                <td>${e[4]}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n        <div class="button-container">\n          <button class="button print" onclick="window.print()">Imprimir</button>\n          <button class="button" onclick="window.close()">Cerrar Previsualizaci\xf3n</button>\n        </div>\n      </body>\n    </html>\n  `})(se,de,M)),e.document.close(),le("Abri\xf3 la vista previa de pedidos (PDF)",{type:"PDF Preview"})},handleOpenExcelPreview:()=>{const e=window.open("","_blank");e.document.write(function(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],l=0;const i=e.map(e=>{var t,a,r,n,i,o;l+=1;const s=(null===(t=e.meals)||void 0===t?void 0:t[0])||{},d=(null===(a=e.payment)||void 0===a?void 0:a.name)||e.payment||(null===s||void 0===s||null===(r=s.payment)||void 0===r?void 0:r.name)||(null===s||void 0===s?void 0:s.payment)||"Efectivo";return[l,(null===s||void 0===s||null===(n=s.address)||void 0===n?void 0:n.address)||"",(null===s||void 0===s||null===(i=s.address)||void 0===i?void 0:i.phoneNumber)||"",`$${(null===(o=e.total)||void 0===o?void 0:o.toLocaleString("es-CO"))||"0"}`,d,(null===e||void 0===e?void 0:e.deliveryPerson)||""]});0===i.length&&i.push(Array(6).fill("-"));const o=Object.entries(a).map(e=>{var t,a,r,n;let[l,i]=e;return[l||"",`$${(null===(t=i.cash)||void 0===t?void 0:t.toLocaleString("es-CO"))||"0"}`,`$${(null===(a=i.daviplata)||void 0===a?void 0:a.toLocaleString("es-CO"))||"0"}`,`$${(null===(r=i.nequi)||void 0===r?void 0:r.toLocaleString("es-CO"))||"0"}`,`$${(null===(n=i.total)||void 0===n?void 0:n.toLocaleString("es-CO"))||"0"}`]}),s=0===n.length?[["-","-"]]:n.map((e,t)=>{var a;const l=t===n.length-2,i=t===n.length-1;return[e.name||"Sin nombre",(null===(a=e.quantity)||void 0===a?void 0:a.toLocaleString("es-CO"))||"0",l?"TOTAL PROTE\xcdNAS:":i?"Fecha actual:":"",l?r.toLocaleString("es-CO"):i?(new Date).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric"}):""]}),d={cash:t.cash||0,daviplata:t.daviplata||0,nequi:t.nequi||0},c=d.cash+d.daviplata+d.nequi;return`\n    <html>\n      <head>\n        <title>Previsualizaci\xf3n de Excel</title>\n        <style>\n          body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }\n          h1 { text-align: center; font-size: 24px; }\n          table { width: 100%; border-collapse: collapse; }\n          th, td { padding: 8px; border: 1px solid black; }\n          th { background-color: #0066cc; color: white; font-weight: bold; text-align: center; font-size: 16px; }\n          td { text-align: left; vertical-align: middle; }\n          td:nth-child(4), td:nth-child(6) { text-align: right; }\n          tr:nth-child(even) { background-color: #f5f5f5; }\n          .totals-table { width: 50%; margin-left: auto; margin-right: auto; }\n\n          .proteins-container { width: auto; margin: 0 auto; max-width: 700px; }\n          .proteins-table {\n            border-collapse: collapse;\n            font-size: 14px;\n            width: 100%;\n            max-width: 700px;\n          }\n          .proteins-table th, .proteins-table td {\n            padding: 6px 12px;\n            border: 1px solid black;\n            white-space: nowrap;\n          }\n          .proteins-table th:nth-child(1), .proteins-table td:nth-child(1) { width: 160px; text-align: left; }\n          .proteins-table th:nth-child(2), .proteins-table td:nth-child(2) { width: 80px; text-align: right; }\n          .proteins-table th:nth-child(3), .proteins-table td:nth-child(3) { width: 220px; text-align: left; }\n\n          .delivery-table th { background-color: #0066cc; color: white; font-weight: bold; text-align: center; font-size: 16px; }\n          .delivery-table .green-header th { background-color: #28a745; }\n          .delivery-table td:nth-child(n+2) { text-align: right; }\n\n          .spacer { height: 16px; }\n          .button-container { margin-top: 20px; text-align: center; }\n          .button { padding: 10px 20px; background-color: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }\n          .button.print { background-color: #28a745; }\n          @media print { .button-container { display: none; } }\n        </style>\n      </head>\n      <body>\n        <h1>Gesti\xf3n de Pedidos</h1>\n        <div class="spacer"></div>\n\n        <div class="proteins-container">\n          <table class="proteins-table" aria-label="Resumen de prote\xednas">\n            <thead>\n              <tr>\n                <th style="background-color: #0066cc; color: white; border: 1px solid black;">Prote\xedna</th>\n                <th style="background-color: #0066cc; color: white; border: 1px solid black;">Unidades</th>\n                <th style="background-color: #0066cc; color: white; border: 1px solid black;"></th>\n              </tr>\n            </thead>\n            <tbody>\n              ${s.map((e,t)=>{const a=e[2]?`\n                  <td style="padding: 0;">\n                    <div style="display: flex; width: 100%; height: 100%;">\n                      <div style="flex: 1; padding: 6px 12px; font-weight: bold; display: flex; align-items: center;">${e[2]}</div>\n                      <div style="width: 1px; background-color: black;"></div>\n                      <div style="flex: 1; padding: 6px 12px; display: flex; justify-content: flex-end; align-items: center; font-weight: ${"TOTAL PROTE\xcdNAS:"===e[2]?"bold":"normal"};">${e[3]}</div>\n                    </div>\n                  </td>\n                `:'<td style="border: none; background-color: white;"></td>';return`\n                  <tr>\n                    <td title="${e[0]}">${e[0]}</td>\n                    <td style="text-align: right;">${e[1]}</td>\n                    ${a}\n                  </tr>\n                `}).join("")}\n            </tbody>\n          </table>\n        </div>\n\n        <div class="spacer"></div><div class="spacer"></div>\n\n        <table>\n          <thead>\n            <tr>\n              <th>N</th>\n              <th>Direcci\xf3n</th>\n              <th>Tel\xe9fono</th>\n              <th>Total</th>\n              <th>M\xe9todo de Pago</th>\n              <th>Domiciliario</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${i.map(e=>`\n              <tr>\n                <td>${e[0]}</td>\n                <td>${e[1]}</td>\n                <td>${e[2]}</td>\n                <td>${e[3]}</td>\n                <td>${e[4]}</td>\n                <td>${e[5]}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n\n        <div class="spacer"></div><div class="spacer"></div>\n\n        <table class="totals-table">\n          <thead>\n            <tr><th colspan="2">Resumen de Totales</th></tr>\n          </thead>\n          <tbody>\n            <tr><td>Total Efectivo</td><td style="text-align: right;">$${d.cash.toLocaleString("es-CO")}</td></tr>\n            <tr><td>Total Daviplata</td><td style="text-align: right;">$${d.daviplata.toLocaleString("es-CO")}</td></tr>\n            <tr><td>Total Nequi</td><td style="text-align: right;">$${d.nequi.toLocaleString("es-CO")}</td></tr>\n            <tr><td>Total General</td><td style="text-align: right;">$${c.toLocaleString("es-CO")}</td></tr>\n          </tbody>\n        </table>\n\n        <div class="spacer"></div><div class="spacer"></div>\n\n        <table class="delivery-table">\n          <thead>\n            <tr><th colspan="5">Resumen por Domiciliarios</th></tr>\n            <tr class="green-header">\n              <th>Domiciliario</th>\n              <th>Efectivo</th>\n              <th>Daviplata</th>\n              <th>Nequi</th>\n              <th>Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${o.map(e=>`\n              <tr>\n                <td>${e[0]}</td>\n                <td>${e[1]}</td>\n                <td>${e[2]}</td>\n                <td>${e[3]}</td>\n                <td>${e[4]}</td>\n              </tr>\n            `).join("")}\n          </tbody>\n        </table>\n\n        <div class="button-container">\n          <button class="button print" onclick="window.print()">Imprimir</button>\n          <button class="button" onclick="window.close()">Cerrar Previsualizaci\xf3n</button>\n          <button class="button" onclick="window.opener.postMessage('downloadExcel', '*')">Descargar Excel</button>\n        </div>\n      </body>\n    </html>\n  `}(se,de,M,ne,_)),e.document.close(),le("Abri\xf3 la vista previa de pedidos (Excel)",{type:"Excel Preview"})},handleExport:(e,r)=>{try{e(o,y,M,ne,_),a(`Exportado correctamente como ${r}.`),le(`Export\xf3 pedidos como ${r}`,{format:r})}catch(n){console.error(`Error al exportar ${r}:`,n),t(`Error al exportar ${r}: ${n.message}`)}},handleDeleteAllOrders:ge,setShowConfirmDeleteAll:E,exportToExcel:s,exportToPDF:u,exportToCSV:p,setShowAddOrderModal:X,orderTypeFilter:ee,setOrderTypeFilter:te,uniqueDeliveryPersons:xe})]})}},6568:(e,t,a)=>{function r(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}a.d(t,{x:()=>r})}}]);
//# sourceMappingURL=734.0f5a98d7.chunk.js.map