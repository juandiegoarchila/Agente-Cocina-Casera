"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[313],{4313:(e,s,a)=>{a.r(s),a.d(s,{default:()=>c});var t=a(5043),l=a(1958),d=a(5472),r=a(5884),i=a(1283),n=a(579);const c=e=>{let{setError:s,setSuccess:a,theme:c}=e;const[o,x]=(0,t.useState)([]),[m,h]=(0,t.useState)([]),[g,p]=(0,t.useState)({cash:0,daviplata:0,nequi:0}),[j,u]=(0,t.useState)({Pending:0,Delivered:0,Cancelled:0}),[b,v]=(0,t.useState)([]),[N,y]=(0,t.useState)({labels:[],datasets:[]}),f=(0,t.useRef)(null),w=(0,i.Zp)();(0,t.useEffect)(()=>{const e=(0,d.aQ)((0,d.rJ)(l.db,"orders"),e=>{const s=e.docs.map(e=>({id:e.id,...e.data()}));x(s);const a={cash:0,daviplata:0,nequi:0},t={Pending:0,Delivered:0,Cancelled:0},l={};s.forEach(e=>{var s;const d=new Date(null===(s=e.createdAt)||void 0===s?void 0:s.toDate()).toLocaleDateString();l[d]=(l[d]||0)+1,"Efectivo"===e.payment?a.cash+=e.total||0:"DaviPlata"===e.payment?a.daviplata+=e.total||0:"Nequi"===e.payment&&(a.nequi+=e.total||0),"Pending"===e.status?t.Pending+=1:"Delivered"===e.status?t.Delivered+=1:"Cancelled"===e.status&&(t.Cancelled+=1)}),p(a),u(t),y({labels:Object.keys(l),datasets:[{label:"Pedidos Diarios",data:Object.values(l),backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]})},e=>s(`Error al cargar pedidos: ${e.message}`)),a=(0,d.aQ)((0,d.rJ)(l.db,"users"),e=>{const s=e.docs.map(e=>({id:e.id,...e.data()}));h(s)},e=>s(`Error al cargar usuarios: ${e.message}`)),t=(0,d.aQ)((0,d.rJ)(l.db,"userActivity"),e=>{const s=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,s)=>s.timestamp-e.timestamp).slice(0,5);v(s)},e=>s(`Error al cargar actividad: ${e.message}`));return()=>{e(),a(),t()}},[s]);const $=o.slice(0,5);return(0,t.useEffect)(()=>{var e;const s=null===(e=document.getElementById("ordersChart"))||void 0===e?void 0:e.getContext("2d");return s&&(f.current&&f.current.destroy(),f.current=new r.Ay(s,{type:"bar",data:N,options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{labels:{color:"dark"===c?"#fff":"#000"}}},responsive:!0,maintainAspectRatio:!1}})),()=>{f.current&&(f.current.destroy(),f.current=null)}},[N,c]),(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4",children:[(0,n.jsx)("h2",{className:"text-xl sm:text-2xl font-bold mb-6 text-gray-100",children:"Dashboard"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[(0,n.jsxs)("div",{className:`bg-${"dark"===c?"gray-800":"white"} p-4 sm:p-6 rounded-xl shadow-lg`,children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:"Resumen de Pedidos"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Total:"}),(0,n.jsx)("span",{children:o.length})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Pendientes:"}),(0,n.jsx)("span",{className:"text-yellow-400",children:j.Pending})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Entregados:"}),(0,n.jsx)("span",{className:"text-green-400",children:j.Delivered})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Cancelados:"}),(0,n.jsx)("span",{className:"text-red-400",children:j.Cancelled})]})]})]}),(0,n.jsxs)("div",{className:`bg-${"dark"===c?"gray-800":"white"} p-4 sm:p-6 rounded-xl shadow-lg`,children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:"Ingresos"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Efectivo:"}),(0,n.jsxs)("span",{children:["$",g.cash.toLocaleString()]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"DaviPlata:"}),(0,n.jsxs)("span",{children:["$",g.daviplata.toLocaleString()]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Nequi:"}),(0,n.jsxs)("span",{children:["$",g.nequi.toLocaleString()]})]})]})]}),(0,n.jsxs)("div",{className:`bg-${"dark"===c?"gray-800":"white"} p-4 sm:p-6 rounded-xl shadow-lg`,children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:"Usuarios"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Total:"}),(0,n.jsx)("span",{children:m.length})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Administradores:"}),(0,n.jsx)("span",{children:m.filter(e=>2===e.role).length})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"Clientes:"}),(0,n.jsx)("span",{children:m.filter(e=>1===e.role).length})]})]})]}),(0,n.jsxs)("div",{className:`bg-${"dark"===c?"gray-800":"white"} p-4 sm:p-6 rounded-xl shadow-lg`,children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:"Actividad Reciente"}),(0,n.jsx)("div",{className:"space-y-2 text-sm max-h-32 overflow-y-auto",children:b.map((e,s)=>{var a;return(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-400",children:e.action}),(0,n.jsx)("span",{children:new Date(null===(a=e.timestamp)||void 0===a?void 0:a.toDate()).toLocaleString()})]},s)})})]})]}),(0,n.jsxs)("div",{className:`mt-6 ${"dark"===c?"bg-gray-800":"bg-white"} p-4 sm:p-6 rounded-xl shadow-lg`,children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:"Pedidos Recientes"}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-left border-collapse text-xs sm:text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:`bg-${"dark"===c?"gray-700":"gray-300"} text-${"dark"===c?"gray-300":"gray-700"} font-semibold`,children:[(0,n.jsx)("th",{className:"p-2 border-b",children:"N\xba"}),(0,n.jsx)("th",{className:"p-2 border-b",children:"Bandeja"}),(0,n.jsx)("th",{className:"p-2 border-b hidden sm:table-cell",children:"Total"}),(0,n.jsx)("th",{className:"p-2 border-b hidden sm:table-cell",children:"Estado"}),(0,n.jsx)("th",{className:"p-2 border-b",children:"Acciones"})]})}),(0,n.jsx)("tbody",{children:0===$.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:"5",className:"p-4 text-gray-400 text-center",children:"No hay pedidos recientes."})}):$.map((e,s)=>{var a,t;const l=(null===(a=e.meals)||void 0===a?void 0:a.map(e=>`${(null===e||void 0===e?void 0:e.soup)||""} ${(null===e||void 0===e?void 0:e.principle)||""} ${(null===e||void 0===e?void 0:e.protein)||""}`).join(" | "))||"";return(0,n.jsxs)("tr",{className:"border-b "+(s%2===0?"bg-gray-750":""),children:[(0,n.jsx)("td",{className:"p-2 text-gray-300",children:$.length-s}),(0,n.jsx)("td",{className:"p-2 text-gray-300 max-w-[120px] sm:max-w-xs overflow-hidden text-ellipsis whitespace-nowrap",children:l}),(0,n.jsxs)("td",{className:"p-2 text-gray-300 hidden sm:table-cell",children:["$",(null===(t=e.total)||void 0===t?void 0:t.toLocaleString())||"0"]}),(0,n.jsx)("td",{className:"p-2 hidden sm:table-cell",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs "+("Pending"===e.status?"bg-yellow-600 text-yellow-100":"Delivered"===e.status?"bg-green-600 text-green-100":"bg-gray-600 text-gray-100"),children:e.status||"Pending"})}),(0,n.jsx)("td",{className:"p-2",children:(0,n.jsx)("button",{onClick:()=>w("/admin/orders"),className:"text-blue-400 hover:text-blue-300 text-xs sm:text-sm",title:"Ver m\xe1s",children:"Ver m\xe1s"})})]},e.id)})})]})})]}),(0,n.jsxs)("div",{className:`mt-6 ${"dark"===c?"bg-gray-800":"bg-white"} p-4 sm:p-6 rounded-xl shadow-lg`,children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:"Gr\xe1fica de Pedidos"}),(0,n.jsx)("div",{className:"w-full h-64",children:(0,n.jsx)("canvas",{id:"ordersChart",className:"w-full h-full"})})]})]})}}}]);
//# sourceMappingURL=313.f9085bdb.chunk.js.map